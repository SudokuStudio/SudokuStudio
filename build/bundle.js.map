{"version":3,"file":"bundle.js","sources":["../../../../node_modules/debounce/index.js","../../../../node_modules/lz-string/libs/lz-string.js","../../../state-manager/lib/state-manager.js","../../../board-utils/lib/board-utils.js","../../../../node_modules/svelte/internal/index.mjs","../../../../node_modules/svelte/store/index.mjs","../../src/js/board.ts","../../src/js/user.ts","../../src/js/util.ts","../../src/js/history.ts","../../src/js/input/adjacentCellPointerHandler.ts","../../src/js/input/inputHandler.ts","../../src/js/input/selectDigitInputHandler.ts","../../../../node_modules/hsluv/hsluv.js","../../src/js/input/lineInputHandler.ts","../../src/js/element/region.ts","../../src/js/element/positionNumbers.ts","../../src/js/elements.ts","../../src/js/element/digit.ts","../../src/js/element/basic.ts","../../src/js/element/lines.ts","../../src/js/element/arrow.ts","../../src/js/element/quadruple.ts","../../src/js/element/killer.ts","../../src/js/element/clone.ts","../../src/js/element/toggles.ts","../../src/js/f-puzzles.ts","../../src/js/init.ts","../../src/js/github.ts","../../../board/src/svelte/CloneRender.svelte","../../../board/src/svelte/NullRender.svelte","../../../board/src/svelte/LittleKillerRender.svelte","../../../board/src/svelte/PositionNumberRender.svelte","../../../board/src/svelte/ColorsRender.svelte","../../../board/src/svelte/CenterRender.svelte","../../../board/src/svelte/CornerRender.svelte","../../../board/src/svelte/UserRender.svelte","../../../board/src/svelte/DiagonalRender.svelte","../../../board/src/svelte/QuadrupleRender.svelte","../../../board/src/svelte/KillerRender.svelte","../../../board/src/svelte/EvenRender.svelte","../../../board/src/svelte/OddRender.svelte","../../../board/src/svelte/MaxRender.svelte","../../../board/src/svelte/MinRender.svelte","../../../board/src/svelte/LineRender.svelte","../../../board/src/svelte/ArrowRender.svelte","../../../board/src/svelte/BetweenRender.svelte","../../../board/src/svelte/ThermoRender.svelte","../../../board/src/svelte/DigitRender.svelte","../../../board/src/svelte/BoxRender.svelte","../../../board/src/svelte/GridRender.svelte","../../../board/src/Board.svelte","../../src/js/elementStores.ts","../../src/svelte/board/BoardContainer.svelte","../../src/svelte/edit/EditSection.svelte","../../src/svelte/edit/constraint/ConstraintRow.svelte","../../src/svelte/edit/constraint/SelectMenuComponent.svelte","../../src/svelte/edit/constraint/Checkbox.svelte","../../src/svelte/edit/constraint/CheckboxMenuComponent.svelte","../../src/svelte/edit/EditPanel.svelte","../../../../node_modules/@material/ripple/util.js","../../../../node_modules/tslib/tslib.es6.js","../../../../node_modules/@material/base/foundation.js","../../../../node_modules/@material/base/component.js","../../../../node_modules/@material/dom/events.js","../../../../node_modules/@material/ripple/constants.js","../../../../node_modules/@material/ripple/foundation.js","../../../../node_modules/@material/ripple/component.js","../../../../node_modules/@material/dom/ponyfill.js","../../src/svelte/entry/ButtonPad.svelte","../../src/svelte/entry/EntryPanel.svelte","../../src/App.svelte","../../src/main.ts"],"sourcesContent":["/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.4\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StateManager = exports.StateRef = void 0;\nconst objectFromEntries = 'function' === typeof Object.fromEntries\n    ? Object.fromEntries\n    : ((entries) => {\n        const obj = Object.create(null);\n        for (const [key, val] of entries) {\n            obj[key] = val;\n        }\n        return obj;\n    });\nconst WatchersKey = Symbol('watchers key');\n/// Same as Object.is except that null and undefined are considered equal.\nfunction isEq(a, b) {\n    return (null == a && null == b) || Object.is(a, b);\n}\n/// Converts undefined to null, otherwise identity.\nfunction undefToNull(val) {\n    if (null == val)\n        return null;\n    return val;\n}\nclass StateRef {\n    constructor(stateManager, path) {\n        this._path = [];\n        this._stateManager = stateManager;\n        for (const seg of path) {\n            if ('..' === seg)\n                this._path.pop();\n            else if ('.' === seg) { }\n            else\n                this._path.push(seg);\n        }\n    }\n    path() {\n        return [...this._path];\n    }\n    ref(...path) {\n        return new StateRef(this._stateManager, [...this._path, ...path]);\n    }\n    get() {\n        return this._stateManager.get(...this._path);\n    }\n    watch(watcher, triggerNow) {\n        this._stateManager.watch(watcher, triggerNow, this._path.join('/'));\n        return watcher;\n    }\n    unwatch(watcher) {\n        this._stateManager.unwatch(watcher);\n    }\n    replace(newData) {\n        return this._stateManager.update({\n            [this._path.join('/')]: newData,\n        });\n    }\n    update(update) {\n        const path = this._path.join('/') + '/';\n        const rootUpdate = objectFromEntries(Object.entries(update)\n            .map(([k, v]) => [path + k, v]));\n        return this._stateManager.update(rootUpdate);\n    }\n    // https://svelte.dev/docs#Store_contract\n    subscribe(subscription) {\n        const watch = this.watch((_path, _oldData, newData) => (subscription)(newData), true);\n        return () => this.unwatch(watch);\n    }\n    set(value) {\n        this.replace(value);\n    }\n}\nexports.StateRef = StateRef;\n/// StateManager provides an interface for updating and reacting to changes in data.\n/// Each instance stores a single JS object. Watchers can be assigned to react to changes\n/// in specified paths of the object. When updates are given to the StateManager, it will\n/// apply the changes and ensure all relevant watchers are called, and it will return a\n/// undo/redo diff to the caller.\n///\n/// This is where the magic happens.\nclass StateManager {\n    constructor() {\n        /// The data contained in and managed by this StateManager.\n        this._data = null;\n        /// Map from each watcher to the paths it's watching.\n        this._watchers = new Map();\n        this._watcherTreeRoot = Object.create(null);\n    }\n    ref(...path) {\n        return new StateRef(this, path);\n    }\n    get(...path) {\n        let target = this._data;\n        for (const seg of path) {\n            if (null == target)\n                break;\n            if (seg.includes('/'))\n                throw Error('Path cannot contain \"/\", split into varargs.');\n            target = target[seg];\n        }\n        return undefToNull(target);\n    }\n    watch(watcher, triggerNow, ...patterns) {\n        let patternSet = this._watchers.get(watcher);\n        if (null == patternSet) {\n            patternSet = new Set();\n            this._watchers.set(watcher, patternSet);\n        }\n        for (const pattern of patterns) {\n            this._watchPattern(watcher, triggerNow, pattern);\n        }\n        return watcher;\n    }\n    unwatch(watcher) {\n        if (!this._watchers.has(watcher))\n            throw Error('Cannot find watcher.');\n        const patterns = this._watchers.get(watcher);\n        this._watchers.delete(watcher);\n        for (const pattern of patterns) {\n            if (!StateManager._unwatchPattern(watcher, this._watcherTreeRoot, pattern.split('/')))\n                throw Error(`Failed to remove watcher from pattern: ${pattern}.`);\n        }\n    }\n    update(update) {\n        if ('object' !== typeof update)\n            throw Error(`Invalid update object: ${update}`);\n        let changed = false;\n        const redo = [];\n        const undo = [];\n        for (const [key, data] of Object.entries(update)) {\n            if (0 >= key.length)\n                throw Error(`Update key cannot be empty.`);\n            const segs = key.split('/');\n            const { data: newData, redo: newRedo, undo: newUndo } = StateManager._updateInternal(this._data, data, segs, [], [this._watcherTreeRoot]);\n            if (!isEq(this._data, newData)) {\n                changed = true;\n                this._data = newData;\n                redo.push(...newRedo);\n                undo.push(...newUndo);\n            }\n        }\n        if (changed) {\n            return {\n                redo: objectFromEntries(redo),\n                undo: objectFromEntries(undo),\n            };\n        }\n        return null;\n    }\n    _watchPattern(watcher, triggerNow, pattern) {\n        if (!pattern || 0 >= pattern.length) {\n            throw Error(`Pattern cannot be empty: ${pattern}.`);\n        }\n        const segs = pattern.split('/');\n        let watcherTree = this._watcherTreeRoot;\n        for (const seg of segs) {\n            if ('.' === seg)\n                continue;\n            if (!Object.prototype.hasOwnProperty.call(watcherTree, seg)) {\n                watcherTree[seg] = Object.create(null);\n            }\n            watcherTree = watcherTree[seg];\n        }\n        (watcherTree[WatchersKey] || (watcherTree[WatchersKey] = new Set())).add(watcher);\n        if (triggerNow) {\n            StateManager._triggerNow(this._data, segs, [], watcher);\n        }\n    }\n    static _unwatchPattern(watcher, watcherTree, segs) {\n        if (0 === segs.length) {\n            const watchers = watcherTree[WatchersKey];\n            if (null == watchers)\n                return false;\n            if (!watchers.delete(watcher))\n                return false;\n            if (0 >= watchers.size)\n                delete watcherTree[WatchersKey];\n            return true;\n        }\n        const [seg, ...restSegs] = segs;\n        if ('.' === seg && !this._unwatchPattern(watcher, watcherTree, restSegs))\n            return false;\n        if (!Object.prototype.hasOwnProperty.call(watcherTree, seg))\n            return false;\n        if (!this._unwatchPattern(watcher, watcherTree[seg], restSegs))\n            return false;\n        if (0 >= Object.keys(watcherTree[seg]).length && (null == watcherTree[WatchersKey]))\n            delete watcherTree[seg];\n        return true;\n    }\n    /// Triggers a newly added watcher.\n    static _triggerNow(data, segs, path, watcher) {\n        if (null == data)\n            return;\n        if (0 >= segs.length) {\n            // Base case - call watcher.\n            try {\n                (watcher)(path, null, data);\n            }\n            catch (e) {\n                console.error('Watcher threw:', e, watcher);\n            }\n            return;\n        }\n        if ('object' !== typeof data)\n            return; // If segs is not empty we can ignore primitives.\n        // Recurse.\n        const [seg, ...restSegs] = segs;\n        if ('.' === seg) {\n            this._triggerNow(data, restSegs, path, watcher);\n        }\n        else if ('*' === seg) {\n            for (const [k, v] of Object.entries(data)) {\n                this._triggerNow(v, restSegs, [...path, k], watcher);\n            }\n        }\n        else if (Object.prototype.hasOwnProperty.call(data, seg)) {\n            this._triggerNow(data[seg], restSegs, [...path, seg], watcher);\n        }\n    }\n    /// DATA - Current data we're looking at, traversed recursively. This will NOT be modified.\n    /// UPDATE - New data used to update DATA. I.e. when SEGS is empty we return UPDATE. Portions of\n    ///     this object (if it is an object) may/will be incorporated into the returned object so be\n    ///     careful of side-effects (TODO?).\n    /// SEGS - Remaining target segments for the update.\n    /// PATH - Path of DATA relative to the root.\n    /// WATCHER_TREES - WatcherTrees encountered at the current level, containing watchers for this DATA.\n    /// DIFF - A Diff object in which the changes this update makes are written into. This will contain\n    ///     pieces of DATA and UPDATE so be careful of side effects (TODO?).\n    /// Returns - The replacement value for DATA, or DATA itself if no updates occured.\n    ///\n    /// Diff logic:\n    /// 3 cases we care about:\n    /// - Delete: First depth where data gets replaced with null.\n    /// - Create: First depth where null gets replaced with update.\n    /// - Replace: First depth where data gets replaced with update.\n    /// Only trigger this at update-point level.\n    static _updateInternal(data, update, segs, path, watcherTrees) {\n        const atUpdateDepth = 0 >= segs.length;\n        // These will be an object or null, so primtives are coerced to null.\n        // This prevents trying to e.g. iterate strings as character array objects.\n        const dataObj = 'object' === typeof data ? data : null;\n        const updateObj = 'object' === typeof update ? update : null;\n        const { data: newData, redo, undo } = (() => {\n            if (atUpdateDepth) {\n                // At an update point!\n                if (null == dataObj && null == updateObj) {\n                    // We've reached a pair of primitives, this is the base case.\n                    return { data: update, undo: [], redo: [] }; // May be the same as data, or maybe not.\n                }\n                // Trigger update on every child key, not just one SEG.\n                const allKeys = new Set([\n                    ...Object.keys(dataObj || {}),\n                    ...Object.keys(updateObj || {}),\n                ]);\n                // Stores the changes (if any).\n                let dataUpdated = false;\n                const dataObjNew = Object.create(null);\n                const redo = [];\n                const undo = [];\n                // For child keys.\n                for (const key of allKeys) {\n                    const innerData = dataObj ? undefToNull(dataObj[key]) : null;\n                    const innerUpdate = updateObj ? undefToNull(updateObj[key]) : null;\n                    const nextWatcherTrees = StateManager._nextWatcherTrees(key, watcherTrees);\n                    // Recurse.\n                    const { data: newInnerData, redo: innerRedo, undo: innerUndo } = StateManager._updateInternal(innerData, innerUpdate, [], [...path, key], nextWatcherTrees);\n                    if (!isEq(innerData, newInnerData)) {\n                        dataUpdated = true;\n                        redo.push(...innerRedo);\n                        undo.push(...innerUndo);\n                        dataObjNew[key] = newInnerData;\n                    }\n                }\n                if (!dataUpdated) {\n                    // No changes.\n                    return { data, redo, undo };\n                }\n                // Yes changes.\n                const newData = Object.assign(Object.create(null), dataObj);\n                for (const [k, v] of Object.entries(dataObjNew)) { // Assign, except null deletes keys.\n                    { // Handle delete.\n                        if (null == v)\n                            delete newData[k];\n                        else\n                            newData[k] = v;\n                    }\n                }\n                // If obj is empty, return null if object, or value.\n                if (0 === Object.keys(newData).length)\n                    return { data: updateObj || update, redo, undo };\n                // Otherwise create the object.\n                return { data: newData, redo, undo };\n            }\n            // Not at an update point, just traversing the SEGS.\n            const [key, ...segsRest] = segs;\n            const innerData = dataObj ? undefToNull(dataObj[key]) : null;\n            // Do not change UPDATE... we are not at the updating depth yet.\n            const nextWatcherTrees = StateManager._nextWatcherTrees(key, watcherTrees);\n            // Recurse.\n            const { data: newInnerData, redo, undo } = StateManager._updateInternal(innerData, update, segsRest, [...path, key], nextWatcherTrees);\n            if (isEq(innerData, newInnerData)) {\n                // No changes.\n                return { data, redo, undo };\n            }\n            // Yes changes.\n            const newData = Object.assign(Object.create(null), dataObj);\n            { // Handle delete.\n                if (null == newInnerData)\n                    delete newData[key];\n                else\n                    newData[key] = newInnerData;\n            }\n            if (Object.values(newData).every(val => null == val)) {\n                // All vals null, return null.\n                return { data: null, redo, undo };\n            }\n            return { data: newData, redo, undo };\n        })();\n        if (!isEq(data, newData)) {\n            // if (0 < path.length) {\n            //     if (redo && atUpdateDepth) redo[path.join('/')] = newData;\n            //     if (undo) undo[path.join('/')] = data;\n            // }\n            {\n                // NULL.\n                if (null == data) {\n                    // NULL -> NULL.\n                    if (null == newData) {\n                        throw \"N/A\";\n                    }\n                    // NULL -> OBJECT.\n                    if ('object' === typeof newData) {\n                        // nested.\n                    }\n                    // NULL -> VALUE.\n                    else {\n                        redo.length = 0;\n                        redo.push([path.join('/'), newData]);\n                        undo.length = 0;\n                        undo.push([path.join('/'), null]);\n                    }\n                }\n                // OBJECT.\n                else if ('object' === typeof data) {\n                    // OBJECT -> NULL.\n                    if (null == newData) {\n                        // redo.length = 0;\n                        // redo.push([ path.join('/'), null ]);\n                        // (nested)\n                    }\n                    // OBJECT -> OBJECT.\n                    else if ('object' === typeof newData) {\n                        // (both nested)\n                    }\n                    // OBJECT -> VALUE.\n                    else {\n                        redo.length = 0;\n                        redo.push([path.join('/'), newData]);\n                        // (nested)\n                    }\n                }\n                // VALUE.\n                else {\n                    // VALUE -> NULL.\n                    if (null == newData) {\n                        redo.length = 0;\n                        redo.push([path.join('/'), null]);\n                        undo.length = 0;\n                        undo.push([path.join('/'), data]);\n                    }\n                    // VALUE -> OBJECT.\n                    else if ('object' === typeof newData) {\n                        // (nested)\n                        undo.length = 0;\n                        undo.push([path.join('/'), data]);\n                    }\n                    // VALUE -> VALUE.\n                    else {\n                        redo.length = 0;\n                        redo.push([path.join('/'), newData]);\n                        undo.length = 0;\n                        undo.push([path.join('/'), data]);\n                    }\n                }\n            }\n            for (const watcherTree of watcherTrees) {\n                for (const watcher of watcherTree[WatchersKey] || []) {\n                    try {\n                        (watcher)(path, data, newData);\n                    }\n                    catch (e) {\n                        console.error('Watcher threw:', e, watcher);\n                    }\n                }\n            }\n            return { data: newData, undo, redo };\n        }\n        return { data, undo, redo };\n    }\n    /// Given a list WATCHER_TREES get the next level down of watcher trees, corresponding to KEY.\n    static _nextWatcherTrees(key, watcherTrees) {\n        const nextTrees = [];\n        for (const watcherTree of watcherTrees) {\n            watcherTree['*'] && nextTrees.push(watcherTree['*']);\n            watcherTree[key] && nextTrees.push(watcherTree[key]);\n        }\n        return nextTrees;\n    }\n}\nexports.StateManager = StateManager;\n//# sourceMappingURL=state-manager.js.map","// Annoying hack to cast to `any` because Svelte doesn't support TS inside the HTML templates.\nexport function any(x) {\n    return x;\n}\nexport const GRID_THICKNESS = 0.01;\nexport const GRID_THICKNESS_HALF = 0.5 * GRID_THICKNESS;\nexport const BOX_THICKNESS = 4 * GRID_THICKNESS;\nexport const BOX_THICKNESS_HALF = 0.5 * BOX_THICKNESS;\nexport function arrayObj2array(arrayObj) {\n    const arr = [];\n    for (let i = 0; null != arrayObj[i]; i++) {\n        arr.push(arrayObj[i]);\n    }\n    return arr;\n}\nexport function cellIdx2cellCoord(idx, { width }) {\n    const x = idx % width;\n    const y = Math.floor(idx / width);\n    return [x, y];\n}\nexport function cellCoord2CellIdx([x, y], { width }) {\n    return y * width + x;\n}\n/**\n * Get the CELL coordinates from SVG coordinates.\n * @param param0 SVG coordinates.\n * @param param1 Grid size.\n * @param conservative If true only count clicks within a center area of the cell. Used to make diagonals of cells easier to select.\n * @returns The CELL coordinates, or null if the click was outside the grid or outside the circle when limitCircle is true.\n */\nexport function svgCoord2cellCoord([xf, yf], { width, height }, conservative) {\n    // Check coord is inside grid.\n    if ((xf < 0 || width <= xf) || (yf < 0 || height <= yf))\n        return null;\n    if (conservative) {\n        const xr = xf % 1 - 0.5;\n        const yr = yf % 1 - 0.5;\n        if (0.5 < Math.abs(xr) + Math.abs(yr))\n            return null;\n    }\n    return [Math.floor(xf), Math.floor(yf)];\n}\n// Same as cell fns but with width increased by 1 b/c of the one extra fencepost.\nexport function cornerCoord2cornerIdx([x, y], { width }) {\n    return y * (width + 1) + x;\n}\nexport function cornerIdx2cornerCoord(vertId, { width }) {\n    const x = vertId % (width + 1);\n    const y = Math.floor(vertId / (width + 1));\n    return [x, y];\n}\nexport function svgCoord2cornerCoord([xf, yf], { width, height }) {\n    const x = Math.round(xf);\n    const y = Math.round(yf);\n    if ((x < 0 || width < x) || (y < 0 || height < y))\n        return null;\n    return [x, y];\n}\nexport function svgCoord2edgeIdx([xf, yf], { width, height }) {\n    const d = Math.abs(yf % 1 - 0.5) >= Math.abs(xf % 1 - 0.5);\n    const w = width - (+!d);\n    const h = height - (+d);\n    const r = Math.floor(yf - 0.5 * (+d));\n    const c = Math.floor(xf - 0.5 * (+!d));\n    if (c < 0 || w <= c)\n        return null;\n    if (r < 0 || h <= r)\n        return null;\n    return 2 * (w * r + c) + (+d);\n}\nexport function edgeIdx2svgCoord(idx, grid) {\n    const [idx0, idx1] = edgeIdx2cellCoords(idx, grid);\n    const [x0, y0] = cellIdx2cellCoord(idx0, grid);\n    const [x1, y1] = cellIdx2cellCoord(idx1, grid);\n    return [0.5 * (x0 + x1 + 1), 0.5 * (y0 + y1 + 1)];\n}\nexport function edgeIdx2cellCoords(idx, grid) {\n    if (1 === idx % 2) {\n        const cellIdx = 0.5 * (idx - 1);\n        return [cellIdx, cellIdx + grid.width];\n    }\n    else {\n        const cellIdx = 0.5 * idx + Math.floor(0.5 * idx / (grid.width - 1));\n        return [cellIdx, cellIdx + 1];\n    }\n}\nexport function svgCoord2seriesIdx([xf, yf], { width, height }) {\n    const isCol = yf < 0 || height <= yf;\n    const isRow = xf < 0 || width <= xf;\n    if (isCol === isRow)\n        return null; // XOR.\n    const z = Math.floor(isCol ? xf : yf);\n    const w = 0 < (isCol ? yf : xf);\n    // Most significant bits are the position (offset from top left).\n    // Twos bit is col (0) or row (1).\n    // Ones bit is top/left (0) or bottom/right (1).\n    return (z << 2) | (+isRow << 1) | (+w);\n}\nexport function seriesIdx2seriesCoord(idx, { width, height }) {\n    const z = idx >> 2;\n    const w = 0b1 & idx;\n    if (0b10 & idx) { // Row.\n        return [w * (1 + width) - 1, z];\n    }\n    else { // Col.\n        return [z, w * (1 + height) - 1];\n    }\n}\nexport function svgCoord2diagonalIdx([xf, yf], grid) {\n    const { width, height } = grid;\n    const left = xf < 0;\n    const right = width <= xf;\n    const top = yf < 0;\n    const bot = height <= yf;\n    if (!left && !right && !top && !bot)\n        return null;\n    xf = Math.max(-0.5, Math.min(width, xf));\n    yf = Math.max(-0.5, Math.min(height, yf));\n    // Positive or negative diagonal.\n    const positive = 0b1 & (Math.floor(2 * xf) + Math.floor(2 * yf));\n    let dir;\n    if (top) { //yx\n        dir = 0b00 | positive;\n    }\n    else if (bot) {\n        dir = 0b10 | (1 - positive);\n    }\n    else if (left) {\n        dir = positive << 1 | 0b0;\n    }\n    else { // right\n        dir = (1 - positive) << 1 | 0b1;\n    }\n    const x = Math.floor(xf) + 1 - 2 * (0b01 & dir);\n    const y = Math.floor(yf) + 1 - (0b10 & dir);\n    if (x < 0 || width <= x || y < 0 || height <= y)\n        return null;\n    if (top || bot)\n        return (x << 2) | dir;\n    else {\n        return ((width + height - y - 1 - (0b1 & dir >> 1)) << 2) | dir;\n    }\n}\nexport function diagonalIdx2svgCoord(idx, { width, height }, offset = -0.75) {\n    const [x, y] = diagonalIdx2startingCellCoord(idx, { width, height });\n    const dy = 1 - 2 * (0b1 & (idx >> 1));\n    const dx = 1 - 2 * (0b1 & (idx >> 0));\n    return [0.5 + x + offset * dx, 0.5 + y + offset * dy];\n}\nexport function diagonalIdx2dirVec(idx) {\n    return [\n        (0b01 & idx) ? -1 : 1,\n        (0b10 & idx) ? -1 : 1,\n    ];\n}\nexport function diagonalIdx2startingCellCoord(idx, { width, height }) {\n    const z = idx >> 2;\n    const b = 0b1 & (idx >> 1);\n    const w = 0b1 & idx;\n    if (z < width) {\n        return [z, b * (height - 1)];\n    }\n    else {\n        const y = z - width;\n        return [w * (width - 1), height - y - 1 - b];\n    }\n}\nexport function idxMapToKeysArray(map) {\n    if (null == map)\n        return [];\n    return Object.keys(map).filter(k => null != map[k] && false != map[k]).map(Number).sort((a, b) => a - b);\n}\nexport function getMajorDiagonal(positive, grid) {\n    return Array(grid.width).fill(null)\n        .map((_, i) => cellCoord2CellIdx([i, positive ? (grid.width - 1 - i) : i], grid));\n}\nexport function getRepeatingDigits(digits, cells, output) {\n    const counts = new Map();\n    for (const cellIdx of cells) {\n        const digit = digits[cellIdx];\n        if (null == digit)\n            continue;\n        let occurances = counts.get(digit);\n        if (null == occurances) {\n            occurances = [];\n            counts.set(digit, occurances);\n        }\n        occurances.push(cellIdx);\n        if (1 < occurances.length)\n            occurances.forEach(output.add);\n    }\n}\nexport function makePath(idxArr, grid, { shortenHead, shortenTail, bezierRounding } = {}) {\n    if (0 >= idxArr.length)\n        return '';\n    const points = [];\n    for (const idx of idxArr) {\n        const [x, y] = cellIdx2cellCoord(idx, grid);\n        points.push([x + 0.5, y + 0.5]);\n    }\n    if (1 === points.length)\n        points.push(points[0]); // Double up.\n    if (shortenHead) {\n        const vec = [\n            points[1][0] - points[0][0],\n            points[1][1] - points[0][1],\n        ];\n        normalize2d(vec);\n        points[0][0] += vec[0] * shortenHead;\n        points[0][1] += vec[1] * shortenHead;\n    }\n    if (shortenTail) {\n        const len = points.length;\n        const vec = [\n            points[len - 2][0] - points[len - 1][0],\n            points[len - 2][1] - points[len - 1][1],\n        ];\n        normalize2d(vec);\n        points[len - 1][0] += vec[0] * shortenTail;\n        points[len - 1][1] += vec[1] * shortenTail;\n    }\n    if (bezierRounding) {\n        const out = ['M', points[0].join(',')];\n        for (let i = 2; i < points.length; i++) {\n            const a = points[i - 2];\n            const b = points[i - 1];\n            const c = points[i];\n            const ba = [a[0] - b[0], a[1] - b[1]];\n            const bc = [c[0] - b[0], c[1] - b[1]];\n            normalize2d(ba);\n            normalize2d(bc);\n            ba[0] *= bezierRounding;\n            ba[1] *= bezierRounding;\n            bc[0] *= bezierRounding;\n            bc[1] *= bezierRounding;\n            ba[0] += b[0];\n            ba[1] += b[1];\n            bc[0] += b[0];\n            bc[1] += b[1];\n            out.push('L', ba.join(','), 'Q', b.join(','), bc.join(','));\n        }\n        out.push('L', points[points.length - 1].join(','));\n        return out.join(' ');\n    }\n    return 'M' + points.map(xy => xy.join(',')).join('L');\n}\nexport function normalize2d(vec) {\n    const dist = Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1]);\n    vec[0] /= dist;\n    vec[1] /= dist;\n}\nexport function click2svgCoord({ offsetX, offsetY }, board) {\n    const { width: elWidth, height: elHeight } = board.getBoundingClientRect();\n    const { x: originX, y: originY, width, height } = board.viewBox.baseVal;\n    // if (offsetX < 0 || offsetY < 0) return null;\n    const x = (width * offsetX / elWidth + originX);\n    const y = (height * offsetY / elHeight + originY);\n    return [x, y];\n}\n/**\n * @param cellIdxs Cell indexes (0 to 80 for 9x9).\n * @param grid Grid width and height.\n * @param inset (Optional) Amount to inset the outline.\n * @returns SVG <path d=\"...\" /> string.\n */\nexport function getEdges(cellIdxs, grid, inset = 0) {\n    // Adjacency table representing the directed graph created by the clockwise outline(s) of the selected cells.\n    const adjList = new Map();\n    {\n        // A --> B\n        // ^     |\n        // |     V\n        // D <-- C\n        // For each cell.\n        // Consider each each clockwise edge A->B\n        // If the inverse edge B->A already exists, delete that.\n        // Otherwise create the edge A->B.\n        function add(A, B) {\n            const adjBack = adjList.get(B);\n            if (adjBack === null || adjBack === void 0 ? void 0 : adjBack.has(A)) {\n                adjBack.delete(A);\n                if (0 >= adjBack.size)\n                    adjList.delete(B);\n            }\n            else {\n                let adj = adjList.get(A);\n                if (null == adj) {\n                    adj = new Set();\n                    adjList.set(A, adj);\n                }\n                adj.add(B);\n            }\n        }\n        for (const idx of cellIdxs) {\n            const [x, y] = cellIdx2cellCoord(idx, grid);\n            const A = cornerCoord2cornerIdx([x, y], grid);\n            const B = cornerCoord2cornerIdx([1 + x, y], grid);\n            const C = cornerCoord2cornerIdx([1 + x, 1 + y], grid);\n            const D = cornerCoord2cornerIdx([x, 1 + y], grid);\n            add(A, B);\n            add(B, C);\n            add(C, D);\n            add(D, A);\n        }\n    }\n    if (0 >= adjList.size)\n        return null;\n    // Traverse each region (may be multiple disconnected regions).\n    const loops = [];\n    while (1) {\n        // Get a starting vertex that is not on or in front of a \"touching corner\".\n        // (Do not delete this first edge, we need to hit it again to complete the loop for the triples.)\n        if (0 >= adjList.size)\n            break;\n        const [firstVertId, firstAdj] = Array.from(adjList.entries()).find(([_vertId, adj]) => 1 === adj.size);\n        const secondVertId = Array.from(firstAdj)[0];\n        // Iterate in triples (a, b, c).\n        let a = cornerIdx2cornerCoord(firstVertId, grid);\n        let b = cornerIdx2cornerCoord(secondVertId, grid);\n        let vertId = secondVertId;\n        const points = [];\n        do {\n            // Find all the next edges.\n            const adj = adjList.get(vertId);\n            // Pick the most-clockwise edge to traverse.\n            let crossProd = Number.NEGATIVE_INFINITY;\n            let nextVertId = -1;\n            let c = null;\n            for (const aVertId of adj) {\n                const aC = cornerIdx2cornerCoord(aVertId, grid);\n                const aCrossProd = (b[0] - a[0]) * (aC[1] - b[1]) - (b[1] - a[1]) * (aC[0] - b[0]);\n                if (crossProd < aCrossProd) {\n                    crossProd = aCrossProd;\n                    nextVertId = aVertId;\n                    c = aC;\n                }\n            }\n            if (null == c)\n                throw \"UNREACHABLE\";\n            adj.delete(nextVertId);\n            if (0 >= adj.size)\n                adjList.delete(vertId);\n            // Calculate insets, push to list.\n            if (0 !== crossProd) {\n                let [x, y] = b;\n                y += inset * (b[0] - a[0]) + crossProd * inset * (a[1] - b[1]);\n                x += inset * (b[1] - c[1]) + crossProd * inset * (c[0] - b[0]);\n                points.push(`${x},${y}`);\n            }\n            // Rotate vars.\n            a = b;\n            b = c;\n            vertId = nextVertId;\n        } while (secondVertId !== vertId);\n        loops.push('M' + points.join('L') + 'Z');\n    }\n    return loops.join('');\n}\nexport function isOnGrid(coord, grid) {\n    return 0 <= coord[0] && coord[0] < grid.width && 0 <= coord[1] && coord[1] < grid.height;\n}\n/**\n * Linear interpolation between to points, hitting all cells in-between.\n * @param start\n * @param end\n * @returns\n */\nexport function cellLine(a, b, grid) {\n    const rx = Math.floor(b[0]) - Math.floor(a[0]);\n    const ry = Math.floor(b[1]) - Math.floor(a[1]);\n    const range = Math.max(Math.abs(rx), Math.abs(ry));\n    const out = [];\n    for (let i = 1; i <= range; i++) {\n        const lerp = i / range;\n        const x = (1 - lerp) * a[0] + lerp * b[0];\n        const y = (1 - lerp) * a[1] + lerp * b[1];\n        if (0 <= x && x < grid.width && 0 <= y && y < grid.height)\n            out.push([Math.floor(x), Math.floor(y)]);\n    }\n    return out;\n}\nexport function distSq(a, b) {\n    const dx = b[0] - a[0];\n    const dy = b[1] - a[1];\n    return dx * dx + dy * dy;\n}\nexport function cornerMarkPos(i, len) {\n    let dx, dy;\n    if (len <= 4) {\n        dx = (i % 2) * 0.6 - 0.3;\n        dy = ((i / 2) | 0) * 0.6 - 0.3;\n    }\n    else {\n        const half = (len / 2) | 0;\n        if (i < half) {\n            const d = 0.6 / (half - 1);\n            dx = i * d - 0.3;\n            dy = -0.3;\n        }\n        else {\n            const d = 0.6 / (len - half - 1);\n            dx = (i - half) * d - 0.3;\n            dy = 0.3;\n        }\n    }\n    return [dx, dy];\n}\nexport const TWO_PI = 2 * Math.PI;\nexport function makeConicalCellSlice(idx, grid, index, slices, offsetFrac = 0.2) {\n    if (index >= slices)\n        throw Error(`INDEX ${index} must be less than SLICES ${slices}.`);\n    if (0 > index)\n        throw Error(`INDEX ${index} must be positive`);\n    const [cx, cy] = cellIdx2cellCoord(idx, grid);\n    if (1 === slices) {\n        return `M${cx},${cy}L${cx + 1},${cy}L${cx + 1},${cy + 1}L${cx},${cy + 1}Z`;\n    }\n    const headFrac = ((offsetFrac + index / slices) % 1 + 1) % 1;\n    const tailFrac = ((offsetFrac + (index + 1) / slices) % 1 + 1) % 1;\n    const fracs = [\n        0.125,\n        0.375,\n        0.625,\n        0.875,\n    ];\n    let s, e;\n    for (s = 0; s < fracs.length && fracs[s] < headFrac; s++)\n        ;\n    for (e = 0; e < fracs.length && fracs[e] < tailFrac; e++)\n        ;\n    s %= fracs.length;\n    e %= fracs.length;\n    const selectedFracs = [headFrac];\n    while (s !== e) {\n        selectedFracs.push(fracs[s]);\n        s++;\n        s %= fracs.length;\n    }\n    selectedFracs.push(tailFrac);\n    return `M${cx + 0.5},${cy + 0.5}L` +\n        selectedFracs\n            .map(frac => [Math.cos(TWO_PI * frac), Math.sin(TWO_PI * frac)])\n            .map(([x, y]) => {\n            const max = Math.max(Math.abs(x), Math.abs(y));\n            return [x / max, y / max];\n        })\n            .map(([x, y]) => [cx + 0.5 * (x + 1), cy + 0.5 * (y + 1)])\n            .map(([x, y]) => `${x},${y}`)\n            .join('L') + 'Z';\n}\nexport function getDigits(elements, includeGivens = true, includeFilled = true) {\n    const out = {};\n    if (!includeGivens && !includeFilled)\n        return out;\n    for (const element of Object.values(elements)) {\n        if (includeFilled && 'filled' === element.type) {\n            Object.assign(out, element.value);\n        }\n    }\n    // Ensure that givens occlude filled.\n    for (const element of Object.values(elements)) {\n        if ('givens' === element.type) {\n            if (includeGivens) {\n                Object.assign(out, element.value);\n            }\n            else {\n                // Ensure occluded filled are ignored.\n                for (const cellIdx of Object.keys(element.value)) {\n                    delete out[cellIdx];\n                }\n            }\n        }\n    }\n    return out;\n}\nexport const num2roman = (() => {\n    // CC BY-SA 3.0.\n    // This is a modified version of code by August.\n    // https://stackoverflow.com/a/41358305/2398020\n    const ROMAN_VALUES = [\n        ['M', 1000],\n        ['CM', 900],\n        ['D', 500],\n        ['CD', 400],\n        ['C', 100],\n        ['XC', 90],\n        ['L', 50],\n        ['XL', 40],\n        ['X', 10],\n        ['IX', 9],\n        ['V', 5],\n        ['IV', 4],\n        ['I', 1],\n    ];\n    return function num2roman(num) {\n        if (0 >= num)\n            return `${num}`;\n        let str = '';\n        for (const [c, v] of ROMAN_VALUES) {\n            var q = Math.floor(num / v);\n            num -= q * v;\n            str += c.repeat(q);\n        }\n        return str;\n    };\n})();\nexport const roman2num = (() => {\n    // https://blog.stevenlevithan.com/archives/javascript-roman-numeral-converter\n    /*\n    Copyright <YEAR> <COPYRIGHT HOLDER>\n\n    Permission is hereby granted, free of charge, to any person obtaining a\n    copy of this software and associated documentation files (the \"Software\"),\n    to deal in the Software without restriction, including without limitation\n    the rights to use, copy, modify, merge, publish, distribute, sublicense,\n    and/or sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in\n    all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n    DEALINGS IN THE SOFTWARE.\n    */\n    const validator = /^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/;\n    const token = /[MDLV]|C[MD]?|X[CL]?|I[XV]?/g;\n    const key = { M: 1000, CM: 900, D: 500, CD: 400, C: 100, XC: 90, L: 50, XL: 40, X: 10, IX: 9, V: 5, IV: 4, I: 1 };\n    return function deromanize(str) {\n        str = str.toUpperCase();\n        let num = 0;\n        let m;\n        if (!(str && validator.test(str)))\n            return null;\n        while (m = token.exec(str))\n            num += key[m[0]];\n        return num;\n    };\n})();\n//# sourceMappingURL=board-utils.js.map","function noop() { }\nconst identity = x => x;\nfunction assign(tar, src) {\n    // @ts-ignore\n    for (const k in src)\n        tar[k] = src[k];\n    return tar;\n}\nfunction is_promise(value) {\n    return value && typeof value === 'object' && typeof value.then === 'function';\n}\nfunction add_location(element, file, line, column, char) {\n    element.__svelte_meta = {\n        loc: { file, line, column, char }\n    };\n}\nfunction run(fn) {\n    return fn();\n}\nfunction blank_object() {\n    return Object.create(null);\n}\nfunction run_all(fns) {\n    fns.forEach(run);\n}\nfunction is_function(thing) {\n    return typeof thing === 'function';\n}\nfunction safe_not_equal(a, b) {\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\nfunction not_equal(a, b) {\n    return a != a ? b == b : a !== b;\n}\nfunction is_empty(obj) {\n    return Object.keys(obj).length === 0;\n}\nfunction validate_store(store, name) {\n    if (store != null && typeof store.subscribe !== 'function') {\n        throw new Error(`'${name}' is not a store with a 'subscribe' method`);\n    }\n}\nfunction subscribe(store, ...callbacks) {\n    if (store == null) {\n        return noop;\n    }\n    const unsub = store.subscribe(...callbacks);\n    return unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\nfunction get_store_value(store) {\n    let value;\n    subscribe(store, _ => value = _)();\n    return value;\n}\nfunction component_subscribe(component, store, callback) {\n    component.$$.on_destroy.push(subscribe(store, callback));\n}\nfunction create_slot(definition, ctx, $$scope, fn) {\n    if (definition) {\n        const slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\n        return definition[0](slot_ctx);\n    }\n}\nfunction get_slot_context(definition, ctx, $$scope, fn) {\n    return definition[1] && fn\n        ? assign($$scope.ctx.slice(), definition[1](fn(ctx)))\n        : $$scope.ctx;\n}\nfunction get_slot_changes(definition, $$scope, dirty, fn) {\n    if (definition[2] && fn) {\n        const lets = definition[2](fn(dirty));\n        if ($$scope.dirty === undefined) {\n            return lets;\n        }\n        if (typeof lets === 'object') {\n            const merged = [];\n            const len = Math.max($$scope.dirty.length, lets.length);\n            for (let i = 0; i < len; i += 1) {\n                merged[i] = $$scope.dirty[i] | lets[i];\n            }\n            return merged;\n        }\n        return $$scope.dirty | lets;\n    }\n    return $$scope.dirty;\n}\nfunction update_slot(slot, slot_definition, ctx, $$scope, dirty, get_slot_changes_fn, get_slot_context_fn) {\n    const slot_changes = get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n    if (slot_changes) {\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n        slot.p(slot_context, slot_changes);\n    }\n}\nfunction update_slot_spread(slot, slot_definition, ctx, $$scope, dirty, get_slot_changes_fn, get_slot_spread_changes_fn, get_slot_context_fn) {\n    const slot_changes = get_slot_spread_changes_fn(dirty) | get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n    if (slot_changes) {\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n        slot.p(slot_context, slot_changes);\n    }\n}\nfunction exclude_internal_props(props) {\n    const result = {};\n    for (const k in props)\n        if (k[0] !== '$')\n            result[k] = props[k];\n    return result;\n}\nfunction compute_rest_props(props, keys) {\n    const rest = {};\n    keys = new Set(keys);\n    for (const k in props)\n        if (!keys.has(k) && k[0] !== '$')\n            rest[k] = props[k];\n    return rest;\n}\nfunction compute_slots(slots) {\n    const result = {};\n    for (const key in slots) {\n        result[key] = true;\n    }\n    return result;\n}\nfunction once(fn) {\n    let ran = false;\n    return function (...args) {\n        if (ran)\n            return;\n        ran = true;\n        fn.call(this, ...args);\n    };\n}\nfunction null_to_empty(value) {\n    return value == null ? '' : value;\n}\nfunction set_store_value(store, ret, value = ret) {\n    store.set(value);\n    return ret;\n}\nconst has_prop = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\nfunction action_destroyer(action_result) {\n    return action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\n}\n\nconst is_client = typeof window !== 'undefined';\nlet now = is_client\n    ? () => window.performance.now()\n    : () => Date.now();\nlet raf = is_client ? cb => requestAnimationFrame(cb) : noop;\n// used internally for testing\nfunction set_now(fn) {\n    now = fn;\n}\nfunction set_raf(fn) {\n    raf = fn;\n}\n\nconst tasks = new Set();\nfunction run_tasks(now) {\n    tasks.forEach(task => {\n        if (!task.c(now)) {\n            tasks.delete(task);\n            task.f();\n        }\n    });\n    if (tasks.size !== 0)\n        raf(run_tasks);\n}\n/**\n * For testing purposes only!\n */\nfunction clear_loops() {\n    tasks.clear();\n}\n/**\n * Creates a new task that runs on each raf frame\n * until it returns a falsy value or is aborted\n */\nfunction loop(callback) {\n    let task;\n    if (tasks.size === 0)\n        raf(run_tasks);\n    return {\n        promise: new Promise(fulfill => {\n            tasks.add(task = { c: callback, f: fulfill });\n        }),\n        abort() {\n            tasks.delete(task);\n        }\n    };\n}\n\n// Track which nodes are claimed during hydration. Unclaimed nodes can then be removed from the DOM\n// at the end of hydration without touching the remaining nodes.\nlet is_hydrating = false;\nfunction start_hydrating() {\n    is_hydrating = true;\n}\nfunction end_hydrating() {\n    is_hydrating = false;\n}\nfunction upper_bound(low, high, key, value) {\n    // Return first index of value larger than input value in the range [low, high)\n    while (low < high) {\n        const mid = low + ((high - low) >> 1);\n        if (key(mid) <= value) {\n            low = mid + 1;\n        }\n        else {\n            high = mid;\n        }\n    }\n    return low;\n}\nfunction init_hydrate(target) {\n    if (target.hydrate_init)\n        return;\n    target.hydrate_init = true;\n    // We know that all children have claim_order values since the unclaimed have been detached\n    const children = target.childNodes;\n    /*\n    * Reorder claimed children optimally.\n    * We can reorder claimed children optimally by finding the longest subsequence of\n    * nodes that are already claimed in order and only moving the rest. The longest\n    * subsequence subsequence of nodes that are claimed in order can be found by\n    * computing the longest increasing subsequence of .claim_order values.\n    *\n    * This algorithm is optimal in generating the least amount of reorder operations\n    * possible.\n    *\n    * Proof:\n    * We know that, given a set of reordering operations, the nodes that do not move\n    * always form an increasing subsequence, since they do not move among each other\n    * meaning that they must be already ordered among each other. Thus, the maximal\n    * set of nodes that do not move form a longest increasing subsequence.\n    */\n    // Compute longest increasing subsequence\n    // m: subsequence length j => index k of smallest value that ends an increasing subsequence of length j\n    const m = new Int32Array(children.length + 1);\n    // Predecessor indices + 1\n    const p = new Int32Array(children.length);\n    m[0] = -1;\n    let longest = 0;\n    for (let i = 0; i < children.length; i++) {\n        const current = children[i].claim_order;\n        // Find the largest subsequence length such that it ends in a value less than our current value\n        // upper_bound returns first greater value, so we subtract one\n        const seqLen = upper_bound(1, longest + 1, idx => children[m[idx]].claim_order, current) - 1;\n        p[i] = m[seqLen] + 1;\n        const newLen = seqLen + 1;\n        // We can guarantee that current is the smallest value. Otherwise, we would have generated a longer sequence.\n        m[newLen] = i;\n        longest = Math.max(newLen, longest);\n    }\n    // The longest increasing subsequence of nodes (initially reversed)\n    const lis = [];\n    // The rest of the nodes, nodes that will be moved\n    const toMove = [];\n    let last = children.length - 1;\n    for (let cur = m[longest] + 1; cur != 0; cur = p[cur - 1]) {\n        lis.push(children[cur - 1]);\n        for (; last >= cur; last--) {\n            toMove.push(children[last]);\n        }\n        last--;\n    }\n    for (; last >= 0; last--) {\n        toMove.push(children[last]);\n    }\n    lis.reverse();\n    // We sort the nodes being moved to guarantee that their insertion order matches the claim order\n    toMove.sort((a, b) => a.claim_order - b.claim_order);\n    // Finally, we move the nodes\n    for (let i = 0, j = 0; i < toMove.length; i++) {\n        while (j < lis.length && toMove[i].claim_order >= lis[j].claim_order) {\n            j++;\n        }\n        const anchor = j < lis.length ? lis[j] : null;\n        target.insertBefore(toMove[i], anchor);\n    }\n}\nfunction append(target, node) {\n    if (is_hydrating) {\n        init_hydrate(target);\n        if ((target.actual_end_child === undefined) || ((target.actual_end_child !== null) && (target.actual_end_child.parentElement !== target))) {\n            target.actual_end_child = target.firstChild;\n        }\n        if (node !== target.actual_end_child) {\n            target.insertBefore(node, target.actual_end_child);\n        }\n        else {\n            target.actual_end_child = node.nextSibling;\n        }\n    }\n    else if (node.parentNode !== target) {\n        target.appendChild(node);\n    }\n}\nfunction insert(target, node, anchor) {\n    if (is_hydrating && !anchor) {\n        append(target, node);\n    }\n    else if (node.parentNode !== target || (anchor && node.nextSibling !== anchor)) {\n        target.insertBefore(node, anchor || null);\n    }\n}\nfunction detach(node) {\n    node.parentNode.removeChild(node);\n}\nfunction destroy_each(iterations, detaching) {\n    for (let i = 0; i < iterations.length; i += 1) {\n        if (iterations[i])\n            iterations[i].d(detaching);\n    }\n}\nfunction element(name) {\n    return document.createElement(name);\n}\nfunction element_is(name, is) {\n    return document.createElement(name, { is });\n}\nfunction object_without_properties(obj, exclude) {\n    const target = {};\n    for (const k in obj) {\n        if (has_prop(obj, k)\n            // @ts-ignore\n            && exclude.indexOf(k) === -1) {\n            // @ts-ignore\n            target[k] = obj[k];\n        }\n    }\n    return target;\n}\nfunction svg_element(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\nfunction text(data) {\n    return document.createTextNode(data);\n}\nfunction space() {\n    return text(' ');\n}\nfunction empty() {\n    return text('');\n}\nfunction listen(node, event, handler, options) {\n    node.addEventListener(event, handler, options);\n    return () => node.removeEventListener(event, handler, options);\n}\nfunction prevent_default(fn) {\n    return function (event) {\n        event.preventDefault();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction stop_propagation(fn) {\n    return function (event) {\n        event.stopPropagation();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction self(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.target === this)\n            fn.call(this, event);\n    };\n}\nfunction attr(node, attribute, value) {\n    if (value == null)\n        node.removeAttribute(attribute);\n    else if (node.getAttribute(attribute) !== value)\n        node.setAttribute(attribute, value);\n}\nfunction set_attributes(node, attributes) {\n    // @ts-ignore\n    const descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\n    for (const key in attributes) {\n        if (attributes[key] == null) {\n            node.removeAttribute(key);\n        }\n        else if (key === 'style') {\n            node.style.cssText = attributes[key];\n        }\n        else if (key === '__value') {\n            node.value = node[key] = attributes[key];\n        }\n        else if (descriptors[key] && descriptors[key].set) {\n            node[key] = attributes[key];\n        }\n        else {\n            attr(node, key, attributes[key]);\n        }\n    }\n}\nfunction set_svg_attributes(node, attributes) {\n    for (const key in attributes) {\n        attr(node, key, attributes[key]);\n    }\n}\nfunction set_custom_element_data(node, prop, value) {\n    if (prop in node) {\n        node[prop] = typeof node[prop] === 'boolean' && value === '' ? true : value;\n    }\n    else {\n        attr(node, prop, value);\n    }\n}\nfunction xlink_attr(node, attribute, value) {\n    node.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\nfunction get_binding_group_value(group, __value, checked) {\n    const value = new Set();\n    for (let i = 0; i < group.length; i += 1) {\n        if (group[i].checked)\n            value.add(group[i].__value);\n    }\n    if (!checked) {\n        value.delete(__value);\n    }\n    return Array.from(value);\n}\nfunction to_number(value) {\n    return value === '' ? null : +value;\n}\nfunction time_ranges_to_array(ranges) {\n    const array = [];\n    for (let i = 0; i < ranges.length; i += 1) {\n        array.push({ start: ranges.start(i), end: ranges.end(i) });\n    }\n    return array;\n}\nfunction children(element) {\n    return Array.from(element.childNodes);\n}\nfunction claim_node(nodes, predicate, processNode, createNode, dontUpdateLastIndex = false) {\n    // Try to find nodes in an order such that we lengthen the longest increasing subsequence\n    if (nodes.claim_info === undefined) {\n        nodes.claim_info = { last_index: 0, total_claimed: 0 };\n    }\n    const resultNode = (() => {\n        // We first try to find an element after the previous one\n        for (let i = nodes.claim_info.last_index; i < nodes.length; i++) {\n            const node = nodes[i];\n            if (predicate(node)) {\n                processNode(node);\n                nodes.splice(i, 1);\n                if (!dontUpdateLastIndex) {\n                    nodes.claim_info.last_index = i;\n                }\n                return node;\n            }\n        }\n        // Otherwise, we try to find one before\n        // We iterate in reverse so that we don't go too far back\n        for (let i = nodes.claim_info.last_index - 1; i >= 0; i--) {\n            const node = nodes[i];\n            if (predicate(node)) {\n                processNode(node);\n                nodes.splice(i, 1);\n                if (!dontUpdateLastIndex) {\n                    nodes.claim_info.last_index = i;\n                }\n                else {\n                    // Since we spliced before the last_index, we decrease it\n                    nodes.claim_info.last_index--;\n                }\n                return node;\n            }\n        }\n        // If we can't find any matching node, we create a new one\n        return createNode();\n    })();\n    resultNode.claim_order = nodes.claim_info.total_claimed;\n    nodes.claim_info.total_claimed += 1;\n    return resultNode;\n}\nfunction claim_element(nodes, name, attributes, svg) {\n    return claim_node(nodes, (node) => node.nodeName === name, (node) => {\n        const remove = [];\n        for (let j = 0; j < node.attributes.length; j++) {\n            const attribute = node.attributes[j];\n            if (!attributes[attribute.name]) {\n                remove.push(attribute.name);\n            }\n        }\n        remove.forEach(v => node.removeAttribute(v));\n    }, () => svg ? svg_element(name) : element(name));\n}\nfunction claim_text(nodes, data) {\n    return claim_node(nodes, (node) => node.nodeType === 3, (node) => {\n        node.data = '' + data;\n    }, () => text(data), true // Text nodes should not update last index since it is likely not worth it to eliminate an increasing subsequence of actual elements\n    );\n}\nfunction claim_space(nodes) {\n    return claim_text(nodes, ' ');\n}\nfunction find_comment(nodes, text, start) {\n    for (let i = start; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeType === 8 /* comment node */ && node.textContent.trim() === text) {\n            return i;\n        }\n    }\n    return nodes.length;\n}\nfunction claim_html_tag(nodes) {\n    // find html opening tag\n    const start_index = find_comment(nodes, 'HTML_TAG_START', 0);\n    const end_index = find_comment(nodes, 'HTML_TAG_END', start_index);\n    if (start_index === end_index) {\n        return new HtmlTag();\n    }\n    const html_tag_nodes = nodes.splice(start_index, end_index + 1);\n    detach(html_tag_nodes[0]);\n    detach(html_tag_nodes[html_tag_nodes.length - 1]);\n    return new HtmlTag(html_tag_nodes.slice(1, html_tag_nodes.length - 1));\n}\nfunction set_data(text, data) {\n    data = '' + data;\n    if (text.wholeText !== data)\n        text.data = data;\n}\nfunction set_input_value(input, value) {\n    input.value = value == null ? '' : value;\n}\nfunction set_input_type(input, type) {\n    try {\n        input.type = type;\n    }\n    catch (e) {\n        // do nothing\n    }\n}\nfunction set_style(node, key, value, important) {\n    node.style.setProperty(key, value, important ? 'important' : '');\n}\nfunction select_option(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        if (option.__value === value) {\n            option.selected = true;\n            return;\n        }\n    }\n}\nfunction select_options(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        option.selected = ~value.indexOf(option.__value);\n    }\n}\nfunction select_value(select) {\n    const selected_option = select.querySelector(':checked') || select.options[0];\n    return selected_option && selected_option.__value;\n}\nfunction select_multiple_value(select) {\n    return [].map.call(select.querySelectorAll(':checked'), option => option.__value);\n}\n// unfortunately this can't be a constant as that wouldn't be tree-shakeable\n// so we cache the result instead\nlet crossorigin;\nfunction is_crossorigin() {\n    if (crossorigin === undefined) {\n        crossorigin = false;\n        try {\n            if (typeof window !== 'undefined' && window.parent) {\n                void window.parent.document;\n            }\n        }\n        catch (error) {\n            crossorigin = true;\n        }\n    }\n    return crossorigin;\n}\nfunction add_resize_listener(node, fn) {\n    const computed_style = getComputedStyle(node);\n    if (computed_style.position === 'static') {\n        node.style.position = 'relative';\n    }\n    const iframe = element('iframe');\n    iframe.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; ' +\n        'overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;');\n    iframe.setAttribute('aria-hidden', 'true');\n    iframe.tabIndex = -1;\n    const crossorigin = is_crossorigin();\n    let unsubscribe;\n    if (crossorigin) {\n        iframe.src = \"data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}</script>\";\n        unsubscribe = listen(window, 'message', (event) => {\n            if (event.source === iframe.contentWindow)\n                fn();\n        });\n    }\n    else {\n        iframe.src = 'about:blank';\n        iframe.onload = () => {\n            unsubscribe = listen(iframe.contentWindow, 'resize', fn);\n        };\n    }\n    append(node, iframe);\n    return () => {\n        if (crossorigin) {\n            unsubscribe();\n        }\n        else if (unsubscribe && iframe.contentWindow) {\n            unsubscribe();\n        }\n        detach(iframe);\n    };\n}\nfunction toggle_class(element, name, toggle) {\n    element.classList[toggle ? 'add' : 'remove'](name);\n}\nfunction custom_event(type, detail) {\n    const e = document.createEvent('CustomEvent');\n    e.initCustomEvent(type, false, false, detail);\n    return e;\n}\nfunction query_selector_all(selector, parent = document.body) {\n    return Array.from(parent.querySelectorAll(selector));\n}\nclass HtmlTag {\n    constructor(claimed_nodes) {\n        this.e = this.n = null;\n        this.l = claimed_nodes;\n    }\n    m(html, target, anchor = null) {\n        if (!this.e) {\n            this.e = element(target.nodeName);\n            this.t = target;\n            if (this.l) {\n                this.n = this.l;\n            }\n            else {\n                this.h(html);\n            }\n        }\n        this.i(anchor);\n    }\n    h(html) {\n        this.e.innerHTML = html;\n        this.n = Array.from(this.e.childNodes);\n    }\n    i(anchor) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert(this.t, this.n[i], anchor);\n        }\n    }\n    p(html) {\n        this.d();\n        this.h(html);\n        this.i(this.a);\n    }\n    d() {\n        this.n.forEach(detach);\n    }\n}\nfunction attribute_to_object(attributes) {\n    const result = {};\n    for (const attribute of attributes) {\n        result[attribute.name] = attribute.value;\n    }\n    return result;\n}\nfunction get_custom_elements_slots(element) {\n    const result = {};\n    element.childNodes.forEach((node) => {\n        result[node.slot || 'default'] = true;\n    });\n    return result;\n}\n\nconst active_docs = new Set();\nlet active = 0;\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n    let hash = 5381;\n    let i = str.length;\n    while (i--)\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n    const step = 16.666 / duration;\n    let keyframes = '{\\n';\n    for (let p = 0; p <= 1; p += step) {\n        const t = a + (b - a) * ease(p);\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n    }\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n    const name = `__svelte_${hash(rule)}_${uid}`;\n    const doc = node.ownerDocument;\n    active_docs.add(doc);\n    const stylesheet = doc.__svelte_stylesheet || (doc.__svelte_stylesheet = doc.head.appendChild(element('style')).sheet);\n    const current_rules = doc.__svelte_rules || (doc.__svelte_rules = {});\n    if (!current_rules[name]) {\n        current_rules[name] = true;\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n    }\n    const animation = node.style.animation || '';\n    node.style.animation = `${animation ? `${animation}, ` : ''}${name} ${duration}ms linear ${delay}ms 1 both`;\n    active += 1;\n    return name;\n}\nfunction delete_rule(node, name) {\n    const previous = (node.style.animation || '').split(', ');\n    const next = previous.filter(name\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n    );\n    const deleted = previous.length - next.length;\n    if (deleted) {\n        node.style.animation = next.join(', ');\n        active -= deleted;\n        if (!active)\n            clear_rules();\n    }\n}\nfunction clear_rules() {\n    raf(() => {\n        if (active)\n            return;\n        active_docs.forEach(doc => {\n            const stylesheet = doc.__svelte_stylesheet;\n            let i = stylesheet.cssRules.length;\n            while (i--)\n                stylesheet.deleteRule(i);\n            doc.__svelte_rules = {};\n        });\n        active_docs.clear();\n    });\n}\n\nfunction create_animation(node, from, fn, params) {\n    if (!from)\n        return noop;\n    const to = node.getBoundingClientRect();\n    if (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom)\n        return noop;\n    const { delay = 0, duration = 300, easing = identity, \n    // @ts-ignore todo: should this be separated from destructuring? Or start/end added to public api and documentation?\n    start: start_time = now() + delay, \n    // @ts-ignore todo:\n    end = start_time + duration, tick = noop, css } = fn(node, { from, to }, params);\n    let running = true;\n    let started = false;\n    let name;\n    function start() {\n        if (css) {\n            name = create_rule(node, 0, 1, duration, delay, easing, css);\n        }\n        if (!delay) {\n            started = true;\n        }\n    }\n    function stop() {\n        if (css)\n            delete_rule(node, name);\n        running = false;\n    }\n    loop(now => {\n        if (!started && now >= start_time) {\n            started = true;\n        }\n        if (started && now >= end) {\n            tick(1, 0);\n            stop();\n        }\n        if (!running) {\n            return false;\n        }\n        if (started) {\n            const p = now - start_time;\n            const t = 0 + 1 * easing(p / duration);\n            tick(t, 1 - t);\n        }\n        return true;\n    });\n    start();\n    tick(0, 1);\n    return stop;\n}\nfunction fix_position(node) {\n    const style = getComputedStyle(node);\n    if (style.position !== 'absolute' && style.position !== 'fixed') {\n        const { width, height } = style;\n        const a = node.getBoundingClientRect();\n        node.style.position = 'absolute';\n        node.style.width = width;\n        node.style.height = height;\n        add_transform(node, a);\n    }\n}\nfunction add_transform(node, a) {\n    const b = node.getBoundingClientRect();\n    if (a.left !== b.left || a.top !== b.top) {\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        node.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n    }\n}\n\nlet current_component;\nfunction set_current_component(component) {\n    current_component = component;\n}\nfunction get_current_component() {\n    if (!current_component)\n        throw new Error('Function called outside component initialization');\n    return current_component;\n}\nfunction beforeUpdate(fn) {\n    get_current_component().$$.before_update.push(fn);\n}\nfunction onMount(fn) {\n    get_current_component().$$.on_mount.push(fn);\n}\nfunction afterUpdate(fn) {\n    get_current_component().$$.after_update.push(fn);\n}\nfunction onDestroy(fn) {\n    get_current_component().$$.on_destroy.push(fn);\n}\nfunction createEventDispatcher() {\n    const component = get_current_component();\n    return (type, detail) => {\n        const callbacks = component.$$.callbacks[type];\n        if (callbacks) {\n            // TODO are there situations where events could be dispatched\n            // in a server (non-DOM) environment?\n            const event = custom_event(type, detail);\n            callbacks.slice().forEach(fn => {\n                fn.call(component, event);\n            });\n        }\n    };\n}\nfunction setContext(key, context) {\n    get_current_component().$$.context.set(key, context);\n}\nfunction getContext(key) {\n    return get_current_component().$$.context.get(key);\n}\nfunction hasContext(key) {\n    return get_current_component().$$.context.has(key);\n}\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component, event) {\n    const callbacks = component.$$.callbacks[event.type];\n    if (callbacks) {\n        // @ts-ignore\n        callbacks.slice().forEach(fn => fn.call(this, event));\n    }\n}\n\nconst dirty_components = [];\nconst intros = { enabled: false };\nconst binding_callbacks = [];\nconst render_callbacks = [];\nconst flush_callbacks = [];\nconst resolved_promise = Promise.resolve();\nlet update_scheduled = false;\nfunction schedule_update() {\n    if (!update_scheduled) {\n        update_scheduled = true;\n        resolved_promise.then(flush);\n    }\n}\nfunction tick() {\n    schedule_update();\n    return resolved_promise;\n}\nfunction add_render_callback(fn) {\n    render_callbacks.push(fn);\n}\nfunction add_flush_callback(fn) {\n    flush_callbacks.push(fn);\n}\nlet flushing = false;\nconst seen_callbacks = new Set();\nfunction flush() {\n    if (flushing)\n        return;\n    flushing = true;\n    do {\n        // first, call beforeUpdate functions\n        // and update components\n        for (let i = 0; i < dirty_components.length; i += 1) {\n            const component = dirty_components[i];\n            set_current_component(component);\n            update(component.$$);\n        }\n        set_current_component(null);\n        dirty_components.length = 0;\n        while (binding_callbacks.length)\n            binding_callbacks.pop()();\n        // then, once components are updated, call\n        // afterUpdate functions. This may cause\n        // subsequent updates...\n        for (let i = 0; i < render_callbacks.length; i += 1) {\n            const callback = render_callbacks[i];\n            if (!seen_callbacks.has(callback)) {\n                // ...so guard against infinite loops\n                seen_callbacks.add(callback);\n                callback();\n            }\n        }\n        render_callbacks.length = 0;\n    } while (dirty_components.length);\n    while (flush_callbacks.length) {\n        flush_callbacks.pop()();\n    }\n    update_scheduled = false;\n    flushing = false;\n    seen_callbacks.clear();\n}\nfunction update($$) {\n    if ($$.fragment !== null) {\n        $$.update();\n        run_all($$.before_update);\n        const dirty = $$.dirty;\n        $$.dirty = [-1];\n        $$.fragment && $$.fragment.p($$.ctx, dirty);\n        $$.after_update.forEach(add_render_callback);\n    }\n}\n\nlet promise;\nfunction wait() {\n    if (!promise) {\n        promise = Promise.resolve();\n        promise.then(() => {\n            promise = null;\n        });\n    }\n    return promise;\n}\nfunction dispatch(node, direction, kind) {\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\nconst outroing = new Set();\nlet outros;\nfunction group_outros() {\n    outros = {\n        r: 0,\n        c: [],\n        p: outros // parent group\n    };\n}\nfunction check_outros() {\n    if (!outros.r) {\n        run_all(outros.c);\n    }\n    outros = outros.p;\n}\nfunction transition_in(block, local) {\n    if (block && block.i) {\n        outroing.delete(block);\n        block.i(local);\n    }\n}\nfunction transition_out(block, local, detach, callback) {\n    if (block && block.o) {\n        if (outroing.has(block))\n            return;\n        outroing.add(block);\n        outros.c.push(() => {\n            outroing.delete(block);\n            if (callback) {\n                if (detach)\n                    block.d(1);\n                callback();\n            }\n        });\n        block.o(local);\n    }\n}\nconst null_transition = { duration: 0 };\nfunction create_in_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = false;\n    let animation_name;\n    let task;\n    let uid = 0;\n    function cleanup() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n        tick(0, 1);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        if (task)\n            task.abort();\n        running = true;\n        add_render_callback(() => dispatch(node, true, 'start'));\n        task = loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(1, 0);\n                    dispatch(node, true, 'end');\n                    cleanup();\n                    return running = false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(t, 1 - t);\n                }\n            }\n            return running;\n        });\n    }\n    let started = false;\n    return {\n        start() {\n            if (started)\n                return;\n            delete_rule(node);\n            if (is_function(config)) {\n                config = config();\n                wait().then(go);\n            }\n            else {\n                go();\n            }\n        },\n        invalidate() {\n            started = false;\n        },\n        end() {\n            if (running) {\n                cleanup();\n                running = false;\n            }\n        }\n    };\n}\nfunction create_out_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = true;\n    let animation_name;\n    const group = outros;\n    group.r += 1;\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        add_render_callback(() => dispatch(node, false, 'start'));\n        loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(0, 1);\n                    dispatch(node, false, 'end');\n                    if (!--group.r) {\n                        // this will result in `end()` being called,\n                        // so we don't need to clean up here\n                        run_all(group.c);\n                    }\n                    return false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(1 - t, t);\n                }\n            }\n            return running;\n        });\n    }\n    if (is_function(config)) {\n        wait().then(() => {\n            // @ts-ignore\n            config = config();\n            go();\n        });\n    }\n    else {\n        go();\n    }\n    return {\n        end(reset) {\n            if (reset && config.tick) {\n                config.tick(1, 0);\n            }\n            if (running) {\n                if (animation_name)\n                    delete_rule(node, animation_name);\n                running = false;\n            }\n        }\n    };\n}\nfunction create_bidirectional_transition(node, fn, params, intro) {\n    let config = fn(node, params);\n    let t = intro ? 0 : 1;\n    let running_program = null;\n    let pending_program = null;\n    let animation_name = null;\n    function clear_animation() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function init(program, duration) {\n        const d = program.b - t;\n        duration *= Math.abs(d);\n        return {\n            a: t,\n            b: program.b,\n            d,\n            duration,\n            start: program.start,\n            end: program.start + duration,\n            group: program.group\n        };\n    }\n    function go(b) {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        const program = {\n            start: now() + delay,\n            b\n        };\n        if (!b) {\n            // @ts-ignore todo: improve typings\n            program.group = outros;\n            outros.r += 1;\n        }\n        if (running_program || pending_program) {\n            pending_program = program;\n        }\n        else {\n            // if this is an intro, and there's a delay, we need to do\n            // an initial tick and/or apply CSS animation immediately\n            if (css) {\n                clear_animation();\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\n            }\n            if (b)\n                tick(0, 1);\n            running_program = init(program, duration);\n            add_render_callback(() => dispatch(node, b, 'start'));\n            loop(now => {\n                if (pending_program && now > pending_program.start) {\n                    running_program = init(pending_program, duration);\n                    pending_program = null;\n                    dispatch(node, running_program.b, 'start');\n                    if (css) {\n                        clear_animation();\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\n                    }\n                }\n                if (running_program) {\n                    if (now >= running_program.end) {\n                        tick(t = running_program.b, 1 - t);\n                        dispatch(node, running_program.b, 'end');\n                        if (!pending_program) {\n                            // we're done\n                            if (running_program.b) {\n                                // intro — we can tidy up immediately\n                                clear_animation();\n                            }\n                            else {\n                                // outro — needs to be coordinated\n                                if (!--running_program.group.r)\n                                    run_all(running_program.group.c);\n                            }\n                        }\n                        running_program = null;\n                    }\n                    else if (now >= running_program.start) {\n                        const p = now - running_program.start;\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\n                        tick(t, 1 - t);\n                    }\n                }\n                return !!(running_program || pending_program);\n            });\n        }\n    }\n    return {\n        run(b) {\n            if (is_function(config)) {\n                wait().then(() => {\n                    // @ts-ignore\n                    config = config();\n                    go(b);\n                });\n            }\n            else {\n                go(b);\n            }\n        },\n        end() {\n            clear_animation();\n            running_program = pending_program = null;\n        }\n    };\n}\n\nfunction handle_promise(promise, info) {\n    const token = info.token = {};\n    function update(type, index, key, value) {\n        if (info.token !== token)\n            return;\n        info.resolved = value;\n        let child_ctx = info.ctx;\n        if (key !== undefined) {\n            child_ctx = child_ctx.slice();\n            child_ctx[key] = value;\n        }\n        const block = type && (info.current = type)(child_ctx);\n        let needs_flush = false;\n        if (info.block) {\n            if (info.blocks) {\n                info.blocks.forEach((block, i) => {\n                    if (i !== index && block) {\n                        group_outros();\n                        transition_out(block, 1, 1, () => {\n                            if (info.blocks[i] === block) {\n                                info.blocks[i] = null;\n                            }\n                        });\n                        check_outros();\n                    }\n                });\n            }\n            else {\n                info.block.d(1);\n            }\n            block.c();\n            transition_in(block, 1);\n            block.m(info.mount(), info.anchor);\n            needs_flush = true;\n        }\n        info.block = block;\n        if (info.blocks)\n            info.blocks[index] = block;\n        if (needs_flush) {\n            flush();\n        }\n    }\n    if (is_promise(promise)) {\n        const current_component = get_current_component();\n        promise.then(value => {\n            set_current_component(current_component);\n            update(info.then, 1, info.value, value);\n            set_current_component(null);\n        }, error => {\n            set_current_component(current_component);\n            update(info.catch, 2, info.error, error);\n            set_current_component(null);\n            if (!info.hasCatch) {\n                throw error;\n            }\n        });\n        // if we previously had a then/catch block, destroy it\n        if (info.current !== info.pending) {\n            update(info.pending, 0);\n            return true;\n        }\n    }\n    else {\n        if (info.current !== info.then) {\n            update(info.then, 1, info.value, promise);\n            return true;\n        }\n        info.resolved = promise;\n    }\n}\nfunction update_await_block_branch(info, ctx, dirty) {\n    const child_ctx = ctx.slice();\n    const { resolved } = info;\n    if (info.current === info.then) {\n        child_ctx[info.value] = resolved;\n    }\n    if (info.current === info.catch) {\n        child_ctx[info.error] = resolved;\n    }\n    info.block.p(child_ctx, dirty);\n}\n\nconst globals = (typeof window !== 'undefined'\n    ? window\n    : typeof globalThis !== 'undefined'\n        ? globalThis\n        : global);\n\nfunction destroy_block(block, lookup) {\n    block.d(1);\n    lookup.delete(block.key);\n}\nfunction outro_and_destroy_block(block, lookup) {\n    transition_out(block, 1, 1, () => {\n        lookup.delete(block.key);\n    });\n}\nfunction fix_and_destroy_block(block, lookup) {\n    block.f();\n    destroy_block(block, lookup);\n}\nfunction fix_and_outro_and_destroy_block(block, lookup) {\n    block.f();\n    outro_and_destroy_block(block, lookup);\n}\nfunction update_keyed_each(old_blocks, dirty, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\n    let o = old_blocks.length;\n    let n = list.length;\n    let i = o;\n    const old_indexes = {};\n    while (i--)\n        old_indexes[old_blocks[i].key] = i;\n    const new_blocks = [];\n    const new_lookup = new Map();\n    const deltas = new Map();\n    i = n;\n    while (i--) {\n        const child_ctx = get_context(ctx, list, i);\n        const key = get_key(child_ctx);\n        let block = lookup.get(key);\n        if (!block) {\n            block = create_each_block(key, child_ctx);\n            block.c();\n        }\n        else if (dynamic) {\n            block.p(child_ctx, dirty);\n        }\n        new_lookup.set(key, new_blocks[i] = block);\n        if (key in old_indexes)\n            deltas.set(key, Math.abs(i - old_indexes[key]));\n    }\n    const will_move = new Set();\n    const did_move = new Set();\n    function insert(block) {\n        transition_in(block, 1);\n        block.m(node, next);\n        lookup.set(block.key, block);\n        next = block.first;\n        n--;\n    }\n    while (o && n) {\n        const new_block = new_blocks[n - 1];\n        const old_block = old_blocks[o - 1];\n        const new_key = new_block.key;\n        const old_key = old_block.key;\n        if (new_block === old_block) {\n            // do nothing\n            next = new_block.first;\n            o--;\n            n--;\n        }\n        else if (!new_lookup.has(old_key)) {\n            // remove old block\n            destroy(old_block, lookup);\n            o--;\n        }\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\n            insert(new_block);\n        }\n        else if (did_move.has(old_key)) {\n            o--;\n        }\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\n            did_move.add(new_key);\n            insert(new_block);\n        }\n        else {\n            will_move.add(old_key);\n            o--;\n        }\n    }\n    while (o--) {\n        const old_block = old_blocks[o];\n        if (!new_lookup.has(old_block.key))\n            destroy(old_block, lookup);\n    }\n    while (n)\n        insert(new_blocks[n - 1]);\n    return new_blocks;\n}\nfunction validate_each_keys(ctx, list, get_context, get_key) {\n    const keys = new Set();\n    for (let i = 0; i < list.length; i++) {\n        const key = get_key(get_context(ctx, list, i));\n        if (keys.has(key)) {\n            throw new Error('Cannot have duplicate keys in a keyed each');\n        }\n        keys.add(key);\n    }\n}\n\nfunction get_spread_update(levels, updates) {\n    const update = {};\n    const to_null_out = {};\n    const accounted_for = { $$scope: 1 };\n    let i = levels.length;\n    while (i--) {\n        const o = levels[i];\n        const n = updates[i];\n        if (n) {\n            for (const key in o) {\n                if (!(key in n))\n                    to_null_out[key] = 1;\n            }\n            for (const key in n) {\n                if (!accounted_for[key]) {\n                    update[key] = n[key];\n                    accounted_for[key] = 1;\n                }\n            }\n            levels[i] = n;\n        }\n        else {\n            for (const key in o) {\n                accounted_for[key] = 1;\n            }\n        }\n    }\n    for (const key in to_null_out) {\n        if (!(key in update))\n            update[key] = undefined;\n    }\n    return update;\n}\nfunction get_spread_object(spread_props) {\n    return typeof spread_props === 'object' && spread_props !== null ? spread_props : {};\n}\n\n// source: https://html.spec.whatwg.org/multipage/indices.html\nconst boolean_attributes = new Set([\n    'allowfullscreen',\n    'allowpaymentrequest',\n    'async',\n    'autofocus',\n    'autoplay',\n    'checked',\n    'controls',\n    'default',\n    'defer',\n    'disabled',\n    'formnovalidate',\n    'hidden',\n    'ismap',\n    'loop',\n    'multiple',\n    'muted',\n    'nomodule',\n    'novalidate',\n    'open',\n    'playsinline',\n    'readonly',\n    'required',\n    'reversed',\n    'selected'\n]);\n\nconst invalid_attribute_name_character = /[\\s'\">/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nfunction spread(args, classes_to_add) {\n    const attributes = Object.assign({}, ...args);\n    if (classes_to_add) {\n        if (attributes.class == null) {\n            attributes.class = classes_to_add;\n        }\n        else {\n            attributes.class += ' ' + classes_to_add;\n        }\n    }\n    let str = '';\n    Object.keys(attributes).forEach(name => {\n        if (invalid_attribute_name_character.test(name))\n            return;\n        const value = attributes[name];\n        if (value === true)\n            str += ' ' + name;\n        else if (boolean_attributes.has(name.toLowerCase())) {\n            if (value)\n                str += ' ' + name;\n        }\n        else if (value != null) {\n            str += ` ${name}=\"${value}\"`;\n        }\n    });\n    return str;\n}\nconst escaped = {\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;'\n};\nfunction escape(html) {\n    return String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\nfunction escape_attribute_value(value) {\n    return typeof value === 'string' ? escape(value) : value;\n}\nfunction escape_object(obj) {\n    const result = {};\n    for (const key in obj) {\n        result[key] = escape_attribute_value(obj[key]);\n    }\n    return result;\n}\nfunction each(items, fn) {\n    let str = '';\n    for (let i = 0; i < items.length; i += 1) {\n        str += fn(items[i], i);\n    }\n    return str;\n}\nconst missing_component = {\n    $$render: () => ''\n};\nfunction validate_component(component, name) {\n    if (!component || !component.$$render) {\n        if (name === 'svelte:component')\n            name += ' this={...}';\n        throw new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n    }\n    return component;\n}\nfunction debug(file, line, column, values) {\n    console.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`); // eslint-disable-line no-console\n    console.log(values); // eslint-disable-line no-console\n    return '';\n}\nlet on_destroy;\nfunction create_ssr_component(fn) {\n    function $$render(result, props, bindings, slots, context) {\n        const parent_component = current_component;\n        const $$ = {\n            on_destroy,\n            context: new Map(parent_component ? parent_component.$$.context : context || []),\n            // these will be immediately discarded\n            on_mount: [],\n            before_update: [],\n            after_update: [],\n            callbacks: blank_object()\n        };\n        set_current_component({ $$ });\n        const html = fn(result, props, bindings, slots);\n        set_current_component(parent_component);\n        return html;\n    }\n    return {\n        render: (props = {}, { $$slots = {}, context = new Map() } = {}) => {\n            on_destroy = [];\n            const result = { title: '', head: '', css: new Set() };\n            const html = $$render(result, props, {}, $$slots, context);\n            run_all(on_destroy);\n            return {\n                html,\n                css: {\n                    code: Array.from(result.css).map(css => css.code).join('\\n'),\n                    map: null // TODO\n                },\n                head: result.title + result.head\n            };\n        },\n        $$render\n    };\n}\nfunction add_attribute(name, value, boolean) {\n    if (value == null || (boolean && !value))\n        return '';\n    return ` ${name}${value === true ? '' : `=${typeof value === 'string' ? JSON.stringify(escape(value)) : `\"${value}\"`}`}`;\n}\nfunction add_classes(classes) {\n    return classes ? ` class=\"${classes}\"` : '';\n}\n\nfunction bind(component, name, callback) {\n    const index = component.$$.props[name];\n    if (index !== undefined) {\n        component.$$.bound[index] = callback;\n        callback(component.$$.ctx[index]);\n    }\n}\nfunction create_component(block) {\n    block && block.c();\n}\nfunction claim_component(block, parent_nodes) {\n    block && block.l(parent_nodes);\n}\nfunction mount_component(component, target, anchor, customElement) {\n    const { fragment, on_mount, on_destroy, after_update } = component.$$;\n    fragment && fragment.m(target, anchor);\n    if (!customElement) {\n        // onMount happens before the initial afterUpdate\n        add_render_callback(() => {\n            const new_on_destroy = on_mount.map(run).filter(is_function);\n            if (on_destroy) {\n                on_destroy.push(...new_on_destroy);\n            }\n            else {\n                // Edge case - component was destroyed immediately,\n                // most likely as a result of a binding initialising\n                run_all(new_on_destroy);\n            }\n            component.$$.on_mount = [];\n        });\n    }\n    after_update.forEach(add_render_callback);\n}\nfunction destroy_component(component, detaching) {\n    const $$ = component.$$;\n    if ($$.fragment !== null) {\n        run_all($$.on_destroy);\n        $$.fragment && $$.fragment.d(detaching);\n        // TODO null out other refs, including component.$$ (but need to\n        // preserve final state?)\n        $$.on_destroy = $$.fragment = null;\n        $$.ctx = [];\n    }\n}\nfunction make_dirty(component, i) {\n    if (component.$$.dirty[0] === -1) {\n        dirty_components.push(component);\n        schedule_update();\n        component.$$.dirty.fill(0);\n    }\n    component.$$.dirty[(i / 31) | 0] |= (1 << (i % 31));\n}\nfunction init(component, options, instance, create_fragment, not_equal, props, dirty = [-1]) {\n    const parent_component = current_component;\n    set_current_component(component);\n    const $$ = component.$$ = {\n        fragment: null,\n        ctx: null,\n        // state\n        props,\n        update: noop,\n        not_equal,\n        bound: blank_object(),\n        // lifecycle\n        on_mount: [],\n        on_destroy: [],\n        on_disconnect: [],\n        before_update: [],\n        after_update: [],\n        context: new Map(parent_component ? parent_component.$$.context : options.context || []),\n        // everything else\n        callbacks: blank_object(),\n        dirty,\n        skip_bound: false\n    };\n    let ready = false;\n    $$.ctx = instance\n        ? instance(component, options.props || {}, (i, ret, ...rest) => {\n            const value = rest.length ? rest[0] : ret;\n            if ($$.ctx && not_equal($$.ctx[i], $$.ctx[i] = value)) {\n                if (!$$.skip_bound && $$.bound[i])\n                    $$.bound[i](value);\n                if (ready)\n                    make_dirty(component, i);\n            }\n            return ret;\n        })\n        : [];\n    $$.update();\n    ready = true;\n    run_all($$.before_update);\n    // `false` as a special case of no DOM component\n    $$.fragment = create_fragment ? create_fragment($$.ctx) : false;\n    if (options.target) {\n        if (options.hydrate) {\n            start_hydrating();\n            const nodes = children(options.target);\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.l(nodes);\n            nodes.forEach(detach);\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.c();\n        }\n        if (options.intro)\n            transition_in(component.$$.fragment);\n        mount_component(component, options.target, options.anchor, options.customElement);\n        end_hydrating();\n        flush();\n    }\n    set_current_component(parent_component);\n}\nlet SvelteElement;\nif (typeof HTMLElement === 'function') {\n    SvelteElement = class extends HTMLElement {\n        constructor() {\n            super();\n            this.attachShadow({ mode: 'open' });\n        }\n        connectedCallback() {\n            const { on_mount } = this.$$;\n            this.$$.on_disconnect = on_mount.map(run).filter(is_function);\n            // @ts-ignore todo: improve typings\n            for (const key in this.$$.slotted) {\n                // @ts-ignore todo: improve typings\n                this.appendChild(this.$$.slotted[key]);\n            }\n        }\n        attributeChangedCallback(attr, _oldValue, newValue) {\n            this[attr] = newValue;\n        }\n        disconnectedCallback() {\n            run_all(this.$$.on_disconnect);\n        }\n        $destroy() {\n            destroy_component(this, 1);\n            this.$destroy = noop;\n        }\n        $on(type, callback) {\n            // TODO should this delegate to addEventListener?\n            const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n            callbacks.push(callback);\n            return () => {\n                const index = callbacks.indexOf(callback);\n                if (index !== -1)\n                    callbacks.splice(index, 1);\n            };\n        }\n        $set($$props) {\n            if (this.$$set && !is_empty($$props)) {\n                this.$$.skip_bound = true;\n                this.$$set($$props);\n                this.$$.skip_bound = false;\n            }\n        }\n    };\n}\n/**\n * Base class for Svelte components. Used when dev=false.\n */\nclass SvelteComponent {\n    $destroy() {\n        destroy_component(this, 1);\n        this.$destroy = noop;\n    }\n    $on(type, callback) {\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n        callbacks.push(callback);\n        return () => {\n            const index = callbacks.indexOf(callback);\n            if (index !== -1)\n                callbacks.splice(index, 1);\n        };\n    }\n    $set($$props) {\n        if (this.$$set && !is_empty($$props)) {\n            this.$$.skip_bound = true;\n            this.$$set($$props);\n            this.$$.skip_bound = false;\n        }\n    }\n}\n\nfunction dispatch_dev(type, detail) {\n    document.dispatchEvent(custom_event(type, Object.assign({ version: '3.38.3' }, detail)));\n}\nfunction append_dev(target, node) {\n    dispatch_dev('SvelteDOMInsert', { target, node });\n    append(target, node);\n}\nfunction insert_dev(target, node, anchor) {\n    dispatch_dev('SvelteDOMInsert', { target, node, anchor });\n    insert(target, node, anchor);\n}\nfunction detach_dev(node) {\n    dispatch_dev('SvelteDOMRemove', { node });\n    detach(node);\n}\nfunction detach_between_dev(before, after) {\n    while (before.nextSibling && before.nextSibling !== after) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction detach_before_dev(after) {\n    while (after.previousSibling) {\n        detach_dev(after.previousSibling);\n    }\n}\nfunction detach_after_dev(before) {\n    while (before.nextSibling) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction listen_dev(node, event, handler, options, has_prevent_default, has_stop_propagation) {\n    const modifiers = options === true ? ['capture'] : options ? Array.from(Object.keys(options)) : [];\n    if (has_prevent_default)\n        modifiers.push('preventDefault');\n    if (has_stop_propagation)\n        modifiers.push('stopPropagation');\n    dispatch_dev('SvelteDOMAddEventListener', { node, event, handler, modifiers });\n    const dispose = listen(node, event, handler, options);\n    return () => {\n        dispatch_dev('SvelteDOMRemoveEventListener', { node, event, handler, modifiers });\n        dispose();\n    };\n}\nfunction attr_dev(node, attribute, value) {\n    attr(node, attribute, value);\n    if (value == null)\n        dispatch_dev('SvelteDOMRemoveAttribute', { node, attribute });\n    else\n        dispatch_dev('SvelteDOMSetAttribute', { node, attribute, value });\n}\nfunction prop_dev(node, property, value) {\n    node[property] = value;\n    dispatch_dev('SvelteDOMSetProperty', { node, property, value });\n}\nfunction dataset_dev(node, property, value) {\n    node.dataset[property] = value;\n    dispatch_dev('SvelteDOMSetDataset', { node, property, value });\n}\nfunction set_data_dev(text, data) {\n    data = '' + data;\n    if (text.wholeText === data)\n        return;\n    dispatch_dev('SvelteDOMSetData', { node: text, data });\n    text.data = data;\n}\nfunction validate_each_argument(arg) {\n    if (typeof arg !== 'string' && !(arg && typeof arg === 'object' && 'length' in arg)) {\n        let msg = '{#each} only iterates over array-like objects.';\n        if (typeof Symbol === 'function' && arg && Symbol.iterator in arg) {\n            msg += ' You can use a spread to convert this iterable into an array.';\n        }\n        throw new Error(msg);\n    }\n}\nfunction validate_slots(name, slot, keys) {\n    for (const slot_key of Object.keys(slot)) {\n        if (!~keys.indexOf(slot_key)) {\n            console.warn(`<${name}> received an unexpected slot \"${slot_key}\".`);\n        }\n    }\n}\n/**\n * Base class for Svelte components with some minor dev-enhancements. Used when dev=true.\n */\nclass SvelteComponentDev extends SvelteComponent {\n    constructor(options) {\n        if (!options || (!options.target && !options.$$inline)) {\n            throw new Error(\"'target' is a required option\");\n        }\n        super();\n    }\n    $destroy() {\n        super.$destroy();\n        this.$destroy = () => {\n            console.warn('Component was already destroyed'); // eslint-disable-line no-console\n        };\n    }\n    $capture_state() { }\n    $inject_state() { }\n}\n/**\n * Base class to create strongly typed Svelte components.\n * This only exists for typing purposes and should be used in `.d.ts` files.\n *\n * ### Example:\n *\n * You have component library on npm called `component-library`, from which\n * you export a component called `MyComponent`. For Svelte+TypeScript users,\n * you want to provide typings. Therefore you create a `index.d.ts`:\n * ```ts\n * import { SvelteComponentTyped } from \"svelte\";\n * export class MyComponent extends SvelteComponentTyped<{foo: string}> {}\n * ```\n * Typing this makes it possible for IDEs like VS Code with the Svelte extension\n * to provide intellisense and to use the component like this in a Svelte file\n * with TypeScript:\n * ```svelte\n * <script lang=\"ts\">\n * \timport { MyComponent } from \"component-library\";\n * </script>\n * <MyComponent foo={'bar'} />\n * ```\n *\n * #### Why not make this part of `SvelteComponent(Dev)`?\n * Because\n * ```ts\n * class ASubclassOfSvelteComponent extends SvelteComponent<{foo: string}> {}\n * const component: typeof SvelteComponent = ASubclassOfSvelteComponent;\n * ```\n * will throw a type error, so we need to seperate the more strictly typed class.\n */\nclass SvelteComponentTyped extends SvelteComponentDev {\n    constructor(options) {\n        super(options);\n    }\n}\nfunction loop_guard(timeout) {\n    const start = Date.now();\n    return () => {\n        if (Date.now() - start > timeout) {\n            throw new Error('Infinite loop detected');\n        }\n    };\n}\n\nexport { HtmlTag, SvelteComponent, SvelteComponentDev, SvelteComponentTyped, SvelteElement, action_destroyer, add_attribute, add_classes, add_flush_callback, add_location, add_render_callback, add_resize_listener, add_transform, afterUpdate, append, append_dev, assign, attr, attr_dev, attribute_to_object, beforeUpdate, bind, binding_callbacks, blank_object, bubble, check_outros, children, claim_component, claim_element, claim_html_tag, claim_space, claim_text, clear_loops, component_subscribe, compute_rest_props, compute_slots, createEventDispatcher, create_animation, create_bidirectional_transition, create_component, create_in_transition, create_out_transition, create_slot, create_ssr_component, current_component, custom_event, dataset_dev, debug, destroy_block, destroy_component, destroy_each, detach, detach_after_dev, detach_before_dev, detach_between_dev, detach_dev, dirty_components, dispatch_dev, each, element, element_is, empty, end_hydrating, escape, escape_attribute_value, escape_object, escaped, exclude_internal_props, fix_and_destroy_block, fix_and_outro_and_destroy_block, fix_position, flush, getContext, get_binding_group_value, get_current_component, get_custom_elements_slots, get_slot_changes, get_slot_context, get_spread_object, get_spread_update, get_store_value, globals, group_outros, handle_promise, hasContext, has_prop, identity, init, insert, insert_dev, intros, invalid_attribute_name_character, is_client, is_crossorigin, is_empty, is_function, is_promise, listen, listen_dev, loop, loop_guard, missing_component, mount_component, noop, not_equal, now, null_to_empty, object_without_properties, onDestroy, onMount, once, outro_and_destroy_block, prevent_default, prop_dev, query_selector_all, raf, run, run_all, safe_not_equal, schedule_update, select_multiple_value, select_option, select_options, select_value, self, setContext, set_attributes, set_current_component, set_custom_element_data, set_data, set_data_dev, set_input_type, set_input_value, set_now, set_raf, set_store_value, set_style, set_svg_attributes, space, spread, start_hydrating, stop_propagation, subscribe, svg_element, text, tick, time_ranges_to_array, to_number, toggle_class, transition_in, transition_out, update_await_block_branch, update_keyed_each, update_slot, update_slot_spread, validate_component, validate_each_argument, validate_each_keys, validate_slots, validate_store, xlink_attr };\n","import { noop, safe_not_equal, subscribe, run_all, is_function } from '../internal/index.mjs';\nexport { get_store_value as get } from '../internal/index.mjs';\n\nconst subscriber_queue = [];\n/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */\nfunction readable(value, start) {\n    return {\n        subscribe: writable(value, start).subscribe\n    };\n}\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */\nfunction writable(value, start = noop) {\n    let stop;\n    const subscribers = [];\n    function set(new_value) {\n        if (safe_not_equal(value, new_value)) {\n            value = new_value;\n            if (stop) { // store is ready\n                const run_queue = !subscriber_queue.length;\n                for (let i = 0; i < subscribers.length; i += 1) {\n                    const s = subscribers[i];\n                    s[1]();\n                    subscriber_queue.push(s, value);\n                }\n                if (run_queue) {\n                    for (let i = 0; i < subscriber_queue.length; i += 2) {\n                        subscriber_queue[i][0](subscriber_queue[i + 1]);\n                    }\n                    subscriber_queue.length = 0;\n                }\n            }\n        }\n    }\n    function update(fn) {\n        set(fn(value));\n    }\n    function subscribe(run, invalidate = noop) {\n        const subscriber = [run, invalidate];\n        subscribers.push(subscriber);\n        if (subscribers.length === 1) {\n            stop = start(set) || noop;\n        }\n        run(value);\n        return () => {\n            const index = subscribers.indexOf(subscriber);\n            if (index !== -1) {\n                subscribers.splice(index, 1);\n            }\n            if (subscribers.length === 0) {\n                stop();\n                stop = null;\n            }\n        };\n    }\n    return { set, update, subscribe };\n}\nfunction derived(stores, fn, initial_value) {\n    const single = !Array.isArray(stores);\n    const stores_array = single\n        ? [stores]\n        : stores;\n    const auto = fn.length < 2;\n    return readable(initial_value, (set) => {\n        let inited = false;\n        const values = [];\n        let pending = 0;\n        let cleanup = noop;\n        const sync = () => {\n            if (pending) {\n                return;\n            }\n            cleanup();\n            const result = fn(single ? values[0] : values, set);\n            if (auto) {\n                set(result);\n            }\n            else {\n                cleanup = is_function(result) ? result : noop;\n            }\n        };\n        const unsubscribers = stores_array.map((store, i) => subscribe(store, (value) => {\n            values[i] = value;\n            pending &= ~(1 << i);\n            if (inited) {\n                sync();\n            }\n        }, () => {\n            pending |= (1 << i);\n        }));\n        inited = true;\n        sync();\n        return function stop() {\n            run_all(unsubscribers);\n            cleanup();\n        };\n    });\n}\n\nexport { derived, readable, writable };\n","import type { Geometry, IdxMap, schema } from \"@sudoku-studio/schema\";\nimport { StateManager } from '@sudoku-studio/state-manager';\nimport { getDigits as getDigitsHelper } from '@sudoku-studio/board-utils';\nimport { writable } from \"svelte/store\";\n\nexport const boardSvg = writable<SVGSVGElement>();\nexport const boardDiv = writable<HTMLDivElement>();\n\nexport const boardState = (window as any).boardState = new StateManager();\nexport const boardGridRef = boardState.ref('grid');\n\nexport function getDigits(includeGivens: boolean = true, includeFilled: boolean = true): IdxMap<Geometry.CELL, number> {\n    return getDigitsHelper(boardState.get<schema.Board['elements']>('elements') || {}, includeGivens, includeFilled);\n}\n","import { StateManager } from '@sudoku-studio/state-manager';\n\nexport const MARK_TYPES = [\n    'filled', 'corner', 'center', 'colors',\n] as const;\n\nexport const userState = (window as any).userState = new StateManager();\nuserState.update({\n    select: {},\n    cursor: null,\n\n    tool: '120', // TODO magic numbers.\n    prevTool: '120',\n    marks: {\n        filled: '120', // TODO magic numbers.\n        corner: '130',\n        center: '140',\n        colors: '150',\n    },\n    history: {},\n    historyUndone: {},\n});\n\nexport const userSelectState = userState.ref('select');\nexport const userCursorState = userState.ref('cursor');\n\nexport const userPrevToolState = userState.ref('prevTool');\nexport const userToolState = userState.ref('tool');\nexport const TOOL_INPUT_NAME = 'tool';\n","export function makeUid(): string {\n    return `${(31 * Math.floor(0xFFFFFFFF * Math.random()) + Date.now()) % 0xFFFFFFFF}`;\n}\n\nexport function makeA1Column(x: number) {\n    x++;\n\n    const out: string[] = [];\n    while (0 < x) {\n        x--;\n        const mod = x % 26;\n        x = Math.floor(x / 26);\n        out.unshift(String.fromCharCode(65 + mod));\n    }\n    return out.join('');\n}\n","import type { Diff } from \"@sudoku-studio/state-manager\";\nimport { boardState } from \"./board\";\nimport { userState } from \"./user\";\n\nexport function pushHistory(history: Diff | null): boolean {\n    if (!history) return false;\n    if (0 === Object.keys(history.redo).length && 0 === Object.keys(history.undo).length) return false;\n    userState.update({\n        [`history/${Date.now()}`]: JSON.stringify(history),\n        historyUndone: null,\n    });\n    return true;\n}\n\nexport function changeHistory(redo: boolean): boolean {\n    const historyObject = userState.get<Record<string, string>>(redo ? 'historyUndone' : 'history') || {};\n    const historyTimestampKeys = Object.keys(historyObject);\n    if (0 === historyTimestampKeys.length) return false;\n\n    const histKey = historyTimestampKeys.reduce((a, b) => (redo !== (+a > +b)) ? a : b);\n    const histVal = historyObject[`${histKey}`];\n\n    // Ignore empty entries (bug).\n    if (null == histVal) {\n        console.warn('EMPTY HISTORY ENTRY', histKey, histVal);\n        userState.update({\n            [`${redo ? 'historyUndone' : 'history'}/${histKey}`]: null,\n        });\n        changeHistory(redo);\n    }\n\n    const diffData: Diff = JSON.parse(histVal);\n    // Update board changes.\n    // TODO: USE OTHER TO RESOLVE CONFLICTS.\n    boardState.update(redo ? diffData.redo : diffData.undo);\n    // Remove entry from historyUndone.\n    // Add entry to history.\n    userState.update({\n      [`history/${histKey}`]: redo ? histVal : null,\n      [`historyUndone/${histKey}`]: redo ? null : histVal,\n    });\n    return true;\n}\n(window as any).changeHistory = changeHistory;\n\nwindow.addEventListener('keydown', (event: KeyboardEvent) => {\n    if ('KeyZ' === event.code && event.ctrlKey) {\n        changeHistory(event.shiftKey);\n    }\n    else if ('KeyY' === event.code && event.ctrlKey) {\n        changeHistory(true);\n    }\n    else {\n        return;\n    }\n    event.preventDefault();\n    event.stopImmediatePropagation();\n});\n","import type { Grid, Coord, Geometry, Idx } from \"@sudoku-studio/schema\";\nimport { click2svgCoord, cellCoord2CellIdx, svgCoord2cellCoord, distSq, cellLine, isOnGrid } from \"@sudoku-studio/board-utils\";\n\nexport type CellDragTapEvent = {\n    event: MouseEvent,\n    coord: Coord<Geometry.CELL>,\n    grid: Grid,\n};\n\nexport class AdjacentCellPointerHandler {\n    onTap: null | ((event: CellDragTapEvent) => void) = null;\n    onDrag: null | ((event: CellDragTapEvent) => void) = null;\n    onDragStart: null | ((event: MouseEvent) => void) = null;\n    onDragEnd: null | (() => void) = null;\n\n    private readonly _interpolateOnReender: boolean;\n\n    private _prevPos: Coord<Geometry.SVG> | null = null;\n    private _prevCell: Idx<Geometry.CELL> | null = null;\n    private _isDown = false;\n    private _isTap: boolean = false;\n\n    constructor(interpolateOnReenter: boolean) {\n        this._interpolateOnReender = interpolateOnReenter;\n    }\n\n    down(event: MouseEvent): void {\n        this.onDragStart && this.onDragStart(event);\n        this._isDown = true;\n        this._isTap = true;\n    }\n\n    move(event: MouseEvent, grid: Grid, svg: SVGSVGElement) {\n        if (this._isDown) {\n            this._handle(event, grid, svg);\n        }\n    }\n\n    up(): void {\n        if (this._isDown) {\n            this.onDragEnd && this.onDragEnd();\n            this._prevPos = null;\n            this._prevCell = null;\n            this._isDown = false;\n        }\n    }\n\n    leave(event: MouseEvent, grid: Grid, svg: SVGSVGElement): void {\n        if (this._isDown) {\n            this._handle(event, grid, svg);\n        }\n    }\n\n    // For special single-selected-cell deselect click.\n    click(event: MouseEvent, grid: Grid, svg: SVGSVGElement) {\n        if (this._isTap) {\n            const coord = svgCoord2cellCoord(click2svgCoord(event, svg), grid, false);\n            if (null != coord) {\n                this.onTap && this.onTap({ event, coord, grid });\n            }\n        }\n    }\n\n    private _handle(event: MouseEvent, grid: Grid, svg: SVGSVGElement): void {\n        const pos = click2svgCoord(event, svg);\n\n        // Interpolate if mouse jumped cells within the board.\n        if (null != this._prevPos && 1 < distSq(this._prevPos, pos)) {\n            for (const coord of cellLine(this._prevPos, pos, grid)) {\n                this.onDrag && this.onDrag({ event, coord, grid });\n                this._prevCell = cellCoord2CellIdx(coord, grid);\n            }\n            this._prevPos = (this._interpolateOnReender || isOnGrid(pos, grid)) ? pos : null;\n            this._isTap = false; // Cancel tap (jumped cells).\n        }\n        // Otherwise select the current cell.\n        else {\n            const isFirstClick = null == this._prevPos;\n            const coord = svgCoord2cellCoord(pos, grid, !isFirstClick);\n            if (null != coord) {\n                if (this._prevCell !== cellCoord2CellIdx(coord, grid)) {\n                    if (null != this._prevCell)\n                        this._isTap = false; // Cancel tap as soon as moved one cell.\n\n                    this.onDrag && this.onDrag({ event, coord, grid });\n                    this._prevCell = cellCoord2CellIdx(coord, grid);\n                }\n                this._prevPos = pos;\n            }\n            // Otherwise otherwise reset prevPos if pointer's off the grid.\n            else if (!(this._interpolateOnReender || isOnGrid(pos, grid))) {\n                this._prevCell = null;\n                this._prevPos = null;\n                this._isTap = false; // Cancel tap -- off grid.\n            }\n        }\n    }\n}\n","export interface InputHandler {\n    load(): void,\n    unload(): void,\n\n    blur(event: FocusEvent): void,\n\n    keydown(event: KeyboardEvent): void;\n    keyup(event: KeyboardEvent): void;\n    padClick(event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void;\n\n    down(event: MouseEvent): void;\n    move(event: MouseEvent): void;\n    up(event: MouseEvent): void;\n    leave(event: MouseEvent): void;\n    click(event: MouseEvent): void;\n}\n\nconst DIGIT_REGEX = /^(?:Digit|Numpad)?(\\d)$/;\nconst NULL_KEYCODES = {\n    Delete: null,\n    Backspace: null,\n    NumpadDecimal: null,\n} as const;\n\nexport function parseDigit(code: string): undefined | null | number {\n    if (code in NULL_KEYCODES) {\n        return NULL_KEYCODES[code as keyof typeof NULL_KEYCODES];\n    }\n\n    const match = DIGIT_REGEX.exec(code);\n    if (match) return Number(match[1]);\n\n    return undefined;\n}\n","import { idxMapToKeysArray, cellCoord2CellIdx, cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\nimport type { Geometry, Grid, IdxBitset } from \"@sudoku-studio/schema\";\nimport type { StateRef, Update } from \"@sudoku-studio/state-manager\";\nimport { boardState, getDigits } from \"../board\";\nimport { pushHistory } from \"../history\";\nimport { userToolState, userSelectState, userState, userPrevToolState, userCursorState } from \"../user\";\nimport { AdjacentCellPointerHandler, CellDragTapEvent } from \"./adjacentCellPointerHandler\";\nimport { InputHandler, parseDigit } from \"./inputHandler\";\n\nconst selectPointerHandler = new AdjacentCellPointerHandler(false);\n\nexport type DigitInputHandlerOptions = {\n    multipleDigits: boolean,\n    blockedByGivens: boolean,\n    blockedByFilled: boolean,\n    nextMode: string,\n    digitMapping?: null | (string | number)[],\n};\n\nexport function getSelectDigitInputHandler(stateRef: StateRef, grid: Grid, svg: SVGSVGElement, options: DigitInputHandlerOptions): InputHandler {\n    const { multipleDigits, blockedByGivens, blockedByFilled, digitMapping, nextMode } = options;\n\n    const DELETE_ORDER = [ 'filled', 'corner', 'center', 'colors' ];\n\n    function onDigitInput(code: string): boolean {\n        let digit: undefined | null | number | string = parseDigit(code);\n\n        if (digitMapping && (null != digit) && digit in digitMapping)\n            digit = digitMapping[digit];\n\n        if (undefined === digit) return false;\n\n        const shouldDelegate = onDigitInputHelper(stateRef, digit);\n        if (shouldDelegate) {\n            for (const type of DELETE_ORDER) {\n                const elementId = userState.get('marks', type);\n                if (null == elementId) continue;\n\n                const otherRef = boardState.ref('elements', `${elementId}`, 'value');\n                if (!onDigitInputHelper(otherRef, digit)) break;\n            }\n        }\n        return true;\n    }\n\n    function onDigitInputHelper(stateRef: StateRef, digit: null | number | string): boolean {\n        const blockingDigits = getDigits(blockedByGivens, blockedByFilled);\n\n        const update: Update = {};\n        // Keep track of if all marks are already set, and if so delete them instead of adding them.\n        let allAlreadySet = true;\n\n        for (const cellIdx of idxMapToKeysArray(userSelectState.get<IdxBitset<Geometry.CELL>>())) {\n            // Ignore filled/given digits as needed.\n            if (null != blockingDigits[cellIdx]) continue;\n\n            // Null (delete) case can fall through.\n            if (multipleDigits && null != digit) {\n                update[`${cellIdx}/${digit}`] = true;\n                allAlreadySet &&= !!stateRef.ref(`${cellIdx}`, `${digit}`).get();\n            }\n            else {\n                update[`${cellIdx}`] = digit;\n                // Use `==` so `null == undefined`.\n                allAlreadySet &&= digit == stateRef.ref(`${cellIdx}`).get();\n            }\n        }\n\n        if (allAlreadySet) {\n            if (null == digit) {\n                // Everything we wanted to delete is already deleted, so delete something else.\n                return true;\n            }\n            else {\n                // All already set, so we need to delete instead of add.\n                for (const key of Object.keys(update)) {\n                    update[key] = null;\n                }\n            }\n        }\n\n        const diff = stateRef.update(update);\n        pushHistory(diff);\n\n        return false;\n    }\n\n    const MODE_KEYS = new Set([\n        'Shift',\n        'Control',\n        'Alt',\n        'Meta',\n    ]);\n\n    function onQuickshift(event: KeyboardEvent): boolean {\n        if ('Space' === event.code) {\n            if ('keydown' === event.type) {\n                userToolState.replace(userState.get('marks', nextMode));\n            }\n            return true;\n        }\n        if (!MODE_KEYS.has(event.key))\n            return false;\n\n        const oldTool = userToolState.get();\n        if (event.shiftKey) {\n            if (event.ctrlKey || event.metaKey) {\n                userToolState.replace(userState.get('marks', 'colors'));\n            }\n            else {\n                userToolState.replace(userState.get('marks', 'corner'));\n            }\n        }\n        else if (event.ctrlKey || event.metaKey) {\n            userToolState.replace(userState.get('marks', 'center'));\n        }\n        else if (event.altKey) {\n            userToolState.replace(userState.get('marks', 'colors'));\n        }\n        else {\n            // Only keyup case.\n            userToolState.replace(userPrevToolState.get());\n            return true;\n        }\n\n        // Any mode key down case.\n        if (null == userPrevToolState.get()) {\n            userPrevToolState.replace(oldTool);\n            return true;\n        }\n        return false;\n    }\n\n    const ARROW_KEYS = {\n        ArrowLeft: [ -1, 0 ],\n        ArrowUp: [ 0, -1 ],\n        ArrowRight: [ 1, 0 ],\n        ArrowDown: [ 0, 1 ],\n    } as const;\n\n    function onArrowKey(event: KeyboardEvent) {\n        if (!(event.code in ARROW_KEYS)) return false;\n\n        const [ dx, dy ] = ARROW_KEYS[event.code as keyof typeof ARROW_KEYS];\n        let [ x, y ] = cellIdx2cellCoord(userCursorState.get() || 0, grid);\n        x += dx + grid.width;\n        y += dy + grid.height;\n        x %= grid.width;\n        y %= grid.height;\n\n        const idx = cellCoord2CellIdx([ x, y ], grid);\n        userCursorState.replace(idx);\n\n        if (event.shiftKey) {\n            userSelectState.ref(`${idx}`).replace(true);\n        }\n        else if (event.ctrlKey) {\n            userSelectState.ref(`${idx}`).replace(null);\n        }\n        else {\n            userSelectState.replace({\n                [idx]: true,\n            });\n        }\n    }\n\n    return {\n        load(): void {\n        },\n        unload(): void {\n            selectPointerHandler.up();\n        },\n\n        blur(_event: FocusEvent): void {\n            // Reset any tool toggles.\n            userToolState.replace(userPrevToolState.get());\n        },\n\n        keydown(event: KeyboardEvent): void {\n            if (onDigitInput(event.code) || onQuickshift(event) || onArrowKey(event)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n        keyup(event: KeyboardEvent): void {\n            if (onQuickshift(event)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n        padClick(event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n            onDigitInput(event.currentTarget.value);\n        },\n\n        down(event: MouseEvent): void {\n            selectPointerHandler.down(event);\n        },\n        move(event: MouseEvent): void {\n            selectPointerHandler.move(event, grid, svg);\n        },\n        up(_event: MouseEvent): void {\n            selectPointerHandler.up();\n        },\n        leave(event: MouseEvent): void {\n            selectPointerHandler.leave(event, grid, svg);\n        },\n        click(event: MouseEvent): void {\n            selectPointerHandler.click(event, grid, svg);\n        },\n    } as const;\n}\n\n(() => {\n    enum Mode {\n        // Mode when starting a *NEW* selection.\n        RESETTING,\n        // Mode when we are either selecting or deselecting based on the\n        // opposite of the first cell hit.\n        DYNAMIC,\n\n        // Mode when user is selecting.\n        SELECTING,\n        // Mode when user is deselecting.\n        DESELCTING,\n    }\n\n    // The selecting mode.\n    let mode = Mode.RESETTING;\n\n    function getMode(mouseEvent: MouseEvent): Mode {\n        if (mouseEvent.shiftKey) {\n            // Shift: always select.\n            return Mode.SELECTING;\n        }\n        else if (mouseEvent.ctrlKey || mouseEvent.metaKey) {\n            // Ctrl: deselect if clicked cell is selected, otherwise select.\n            return Mode.DYNAMIC;\n        }\n        else if (mouseEvent.altKey) {\n            // Alt: always deselect.\n            return Mode.DESELCTING;\n        }\n        else {\n            // No modifier: reset and select only this cell.\n            return Mode.RESETTING;\n        }\n    }\n\n    function handle(event: CellDragTapEvent, isClick: boolean): void {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n        userCursorState.replace(idx);\n\n        if (Mode.RESETTING === mode) {\n            // Special: Resetting *tap* acts as toggle.\n            const select = isClick && userSelectState.get<Record<string, true>>() || {};\n            if (isClick && 1 === Object.keys(select).length && select[`${idx}`]) {\n                userSelectState.replace({})\n            }\n            // Normal:\n            else {\n                userSelectState.replace({ [`${idx}`]: true });\n            }\n            mode = Mode.SELECTING;\n            return;\n        }\n\n        if (Mode.DYNAMIC === mode) {\n            mode = userSelectState.ref(`${idx}`).get() ? Mode.DESELCTING : Mode.SELECTING;\n        }\n        userSelectState.ref(`${idx}`).replace(Mode.SELECTING === mode || null);\n    }\n\n    selectPointerHandler.onDragStart = (event: MouseEvent) => {\n        mode = getMode(event);\n    };\n    selectPointerHandler.onDrag = (event: CellDragTapEvent) => {\n        handle(event, false);\n    };\n    // selectPointerHandler.onDragEnd = (event: MouseEvent) => {\n    //     // mode = Mode.;\n    // };\n\n    selectPointerHandler.onTap = (event: CellDragTapEvent) => {\n        handle(event, true);\n    };\n})();\n","// Generated by Haxe 3.4.4\nvar hsluv = hsluv || {};\nhsluv.Geometry = function() { };\nhsluv.Geometry.intersectLineLine = function(a,b) {\n\tvar x = (a.intercept - b.intercept) / (b.slope - a.slope);\n\tvar y = a.slope * x + a.intercept;\n\treturn { x : x, y : y};\n};\nhsluv.Geometry.distanceFromOrigin = function(point) {\n\treturn Math.sqrt(Math.pow(point.x,2) + Math.pow(point.y,2));\n};\nhsluv.Geometry.distanceLineFromOrigin = function(line) {\n\treturn Math.abs(line.intercept) / Math.sqrt(Math.pow(line.slope,2) + 1);\n};\nhsluv.Geometry.perpendicularThroughPoint = function(line,point) {\n\tvar slope = -1 / line.slope;\n\tvar intercept = point.y - slope * point.x;\n\treturn { slope : slope, intercept : intercept};\n};\nhsluv.Geometry.angleFromOrigin = function(point) {\n\treturn Math.atan2(point.y,point.x);\n};\nhsluv.Geometry.normalizeAngle = function(angle) {\n\tvar m = 2 * Math.PI;\n\treturn (angle % m + m) % m;\n};\nhsluv.Geometry.lengthOfRayUntilIntersect = function(theta,line) {\n\treturn line.intercept / (Math.sin(theta) - line.slope * Math.cos(theta));\n};\nhsluv.Hsluv = function() { };\nhsluv.Hsluv.getBounds = function(L) {\n\tvar result = [];\n\tvar sub1 = Math.pow(L + 16,3) / 1560896;\n\tvar sub2 = sub1 > hsluv.Hsluv.epsilon ? sub1 : L / hsluv.Hsluv.kappa;\n\tvar _g = 0;\n\twhile(_g < 3) {\n\t\tvar c = _g++;\n\t\tvar m1 = hsluv.Hsluv.m[c][0];\n\t\tvar m2 = hsluv.Hsluv.m[c][1];\n\t\tvar m3 = hsluv.Hsluv.m[c][2];\n\t\tvar _g1 = 0;\n\t\twhile(_g1 < 2) {\n\t\t\tvar t = _g1++;\n\t\t\tvar top1 = (284517 * m1 - 94839 * m3) * sub2;\n\t\t\tvar top2 = (838422 * m3 + 769860 * m2 + 731718 * m1) * L * sub2 - 769860 * t * L;\n\t\t\tvar bottom = (632260 * m3 - 126452 * m2) * sub2 + 126452 * t;\n\t\t\tresult.push({ slope : top1 / bottom, intercept : top2 / bottom});\n\t\t}\n\t}\n\treturn result;\n};\nhsluv.Hsluv.maxSafeChromaForL = function(L) {\n\tvar bounds = hsluv.Hsluv.getBounds(L);\n\tvar min = Infinity;\n\tvar _g = 0;\n\twhile(_g < bounds.length) {\n\t\tvar bound = bounds[_g];\n\t\t++_g;\n\t\tvar length = hsluv.Geometry.distanceLineFromOrigin(bound);\n\t\tmin = Math.min(min,length);\n\t}\n\treturn min;\n};\nhsluv.Hsluv.maxChromaForLH = function(L,H) {\n\tvar hrad = H / 360 * Math.PI * 2;\n\tvar bounds = hsluv.Hsluv.getBounds(L);\n\tvar min = Infinity;\n\tvar _g = 0;\n\twhile(_g < bounds.length) {\n\t\tvar bound = bounds[_g];\n\t\t++_g;\n\t\tvar length = hsluv.Geometry.lengthOfRayUntilIntersect(hrad,bound);\n\t\tif(length >= 0) {\n\t\t\tmin = Math.min(min,length);\n\t\t}\n\t}\n\treturn min;\n};\nhsluv.Hsluv.dotProduct = function(a,b) {\n\tvar sum = 0;\n\tvar _g1 = 0;\n\tvar _g = a.length;\n\twhile(_g1 < _g) {\n\t\tvar i = _g1++;\n\t\tsum += a[i] * b[i];\n\t}\n\treturn sum;\n};\nhsluv.Hsluv.fromLinear = function(c) {\n\tif(c <= 0.0031308) {\n\t\treturn 12.92 * c;\n\t} else {\n\t\treturn 1.055 * Math.pow(c,0.416666666666666685) - 0.055;\n\t}\n};\nhsluv.Hsluv.toLinear = function(c) {\n\tif(c > 0.04045) {\n\t\treturn Math.pow((c + 0.055) / 1.055,2.4);\n\t} else {\n\t\treturn c / 12.92;\n\t}\n};\nhsluv.Hsluv.xyzToRgb = function(tuple) {\n\treturn [hsluv.Hsluv.fromLinear(hsluv.Hsluv.dotProduct(hsluv.Hsluv.m[0],tuple)),hsluv.Hsluv.fromLinear(hsluv.Hsluv.dotProduct(hsluv.Hsluv.m[1],tuple)),hsluv.Hsluv.fromLinear(hsluv.Hsluv.dotProduct(hsluv.Hsluv.m[2],tuple))];\n};\nhsluv.Hsluv.rgbToXyz = function(tuple) {\n\tvar rgbl = [hsluv.Hsluv.toLinear(tuple[0]),hsluv.Hsluv.toLinear(tuple[1]),hsluv.Hsluv.toLinear(tuple[2])];\n\treturn [hsluv.Hsluv.dotProduct(hsluv.Hsluv.minv[0],rgbl),hsluv.Hsluv.dotProduct(hsluv.Hsluv.minv[1],rgbl),hsluv.Hsluv.dotProduct(hsluv.Hsluv.minv[2],rgbl)];\n};\nhsluv.Hsluv.yToL = function(Y) {\n\tif(Y <= hsluv.Hsluv.epsilon) {\n\t\treturn Y / hsluv.Hsluv.refY * hsluv.Hsluv.kappa;\n\t} else {\n\t\treturn 116 * Math.pow(Y / hsluv.Hsluv.refY,0.333333333333333315) - 16;\n\t}\n};\nhsluv.Hsluv.lToY = function(L) {\n\tif(L <= 8) {\n\t\treturn hsluv.Hsluv.refY * L / hsluv.Hsluv.kappa;\n\t} else {\n\t\treturn hsluv.Hsluv.refY * Math.pow((L + 16) / 116,3);\n\t}\n};\nhsluv.Hsluv.xyzToLuv = function(tuple) {\n\tvar X = tuple[0];\n\tvar Y = tuple[1];\n\tvar Z = tuple[2];\n\tvar divider = X + 15 * Y + 3 * Z;\n\tvar varU = 4 * X;\n\tvar varV = 9 * Y;\n\tif(divider != 0) {\n\t\tvarU /= divider;\n\t\tvarV /= divider;\n\t} else {\n\t\tvarU = NaN;\n\t\tvarV = NaN;\n\t}\n\tvar L = hsluv.Hsluv.yToL(Y);\n\tif(L == 0) {\n\t\treturn [0,0,0];\n\t}\n\tvar U = 13 * L * (varU - hsluv.Hsluv.refU);\n\tvar V = 13 * L * (varV - hsluv.Hsluv.refV);\n\treturn [L,U,V];\n};\nhsluv.Hsluv.luvToXyz = function(tuple) {\n\tvar L = tuple[0];\n\tvar U = tuple[1];\n\tvar V = tuple[2];\n\tif(L == 0) {\n\t\treturn [0,0,0];\n\t}\n\tvar varU = U / (13 * L) + hsluv.Hsluv.refU;\n\tvar varV = V / (13 * L) + hsluv.Hsluv.refV;\n\tvar Y = hsluv.Hsluv.lToY(L);\n\tvar X = 0 - 9 * Y * varU / ((varU - 4) * varV - varU * varV);\n\tvar Z = (9 * Y - 15 * varV * Y - varV * X) / (3 * varV);\n\treturn [X,Y,Z];\n};\nhsluv.Hsluv.luvToLch = function(tuple) {\n\tvar L = tuple[0];\n\tvar U = tuple[1];\n\tvar V = tuple[2];\n\tvar C = Math.sqrt(U * U + V * V);\n\tvar H;\n\tif(C < 0.00000001) {\n\t\tH = 0;\n\t} else {\n\t\tvar Hrad = Math.atan2(V,U);\n\t\tH = Hrad * 180.0 / Math.PI;\n\t\tif(H < 0) {\n\t\t\tH = 360 + H;\n\t\t}\n\t}\n\treturn [L,C,H];\n};\nhsluv.Hsluv.lchToLuv = function(tuple) {\n\tvar L = tuple[0];\n\tvar C = tuple[1];\n\tvar H = tuple[2];\n\tvar Hrad = H / 360.0 * 2 * Math.PI;\n\tvar U = Math.cos(Hrad) * C;\n\tvar V = Math.sin(Hrad) * C;\n\treturn [L,U,V];\n};\nhsluv.Hsluv.hsluvToLch = function(tuple) {\n\tvar H = tuple[0];\n\tvar S = tuple[1];\n\tvar L = tuple[2];\n\tif(L > 99.9999999) {\n\t\treturn [100,0,H];\n\t}\n\tif(L < 0.00000001) {\n\t\treturn [0,0,H];\n\t}\n\tvar max = hsluv.Hsluv.maxChromaForLH(L,H);\n\tvar C = max / 100 * S;\n\treturn [L,C,H];\n};\nhsluv.Hsluv.lchToHsluv = function(tuple) {\n\tvar L = tuple[0];\n\tvar C = tuple[1];\n\tvar H = tuple[2];\n\tif(L > 99.9999999) {\n\t\treturn [H,0,100];\n\t}\n\tif(L < 0.00000001) {\n\t\treturn [H,0,0];\n\t}\n\tvar max = hsluv.Hsluv.maxChromaForLH(L,H);\n\tvar S = C / max * 100;\n\treturn [H,S,L];\n};\nhsluv.Hsluv.hpluvToLch = function(tuple) {\n\tvar H = tuple[0];\n\tvar S = tuple[1];\n\tvar L = tuple[2];\n\tif(L > 99.9999999) {\n\t\treturn [100,0,H];\n\t}\n\tif(L < 0.00000001) {\n\t\treturn [0,0,H];\n\t}\n\tvar max = hsluv.Hsluv.maxSafeChromaForL(L);\n\tvar C = max / 100 * S;\n\treturn [L,C,H];\n};\nhsluv.Hsluv.lchToHpluv = function(tuple) {\n\tvar L = tuple[0];\n\tvar C = tuple[1];\n\tvar H = tuple[2];\n\tif(L > 99.9999999) {\n\t\treturn [H,0,100];\n\t}\n\tif(L < 0.00000001) {\n\t\treturn [H,0,0];\n\t}\n\tvar max = hsluv.Hsluv.maxSafeChromaForL(L);\n\tvar S = C / max * 100;\n\treturn [H,S,L];\n};\nhsluv.Hsluv.rgbToHex = function(tuple) {\n\tvar h = \"#\";\n\tvar _g = 0;\n\twhile(_g < 3) {\n\t\tvar i = _g++;\n\t\tvar chan = tuple[i];\n\t\tvar c = Math.round(chan * 255);\n\t\tvar digit2 = c % 16;\n\t\tvar digit1 = (c - digit2) / 16 | 0;\n\t\th += hsluv.Hsluv.hexChars.charAt(digit1) + hsluv.Hsluv.hexChars.charAt(digit2);\n\t}\n\treturn h;\n};\nhsluv.Hsluv.hexToRgb = function(hex) {\n\thex = hex.toLowerCase();\n\tvar ret = [];\n\tvar _g = 0;\n\twhile(_g < 3) {\n\t\tvar i = _g++;\n\t\tvar digit1 = hsluv.Hsluv.hexChars.indexOf(hex.charAt(i * 2 + 1));\n\t\tvar digit2 = hsluv.Hsluv.hexChars.indexOf(hex.charAt(i * 2 + 2));\n\t\tvar n = digit1 * 16 + digit2;\n\t\tret.push(n / 255.0);\n\t}\n\treturn ret;\n};\nhsluv.Hsluv.lchToRgb = function(tuple) {\n\treturn hsluv.Hsluv.xyzToRgb(hsluv.Hsluv.luvToXyz(hsluv.Hsluv.lchToLuv(tuple)));\n};\nhsluv.Hsluv.rgbToLch = function(tuple) {\n\treturn hsluv.Hsluv.luvToLch(hsluv.Hsluv.xyzToLuv(hsluv.Hsluv.rgbToXyz(tuple)));\n};\nhsluv.Hsluv.hsluvToRgb = function(tuple) {\n\treturn hsluv.Hsluv.lchToRgb(hsluv.Hsluv.hsluvToLch(tuple));\n};\nhsluv.Hsluv.rgbToHsluv = function(tuple) {\n\treturn hsluv.Hsluv.lchToHsluv(hsluv.Hsluv.rgbToLch(tuple));\n};\nhsluv.Hsluv.hpluvToRgb = function(tuple) {\n\treturn hsluv.Hsluv.lchToRgb(hsluv.Hsluv.hpluvToLch(tuple));\n};\nhsluv.Hsluv.rgbToHpluv = function(tuple) {\n\treturn hsluv.Hsluv.lchToHpluv(hsluv.Hsluv.rgbToLch(tuple));\n};\nhsluv.Hsluv.hsluvToHex = function(tuple) {\n\treturn hsluv.Hsluv.rgbToHex(hsluv.Hsluv.hsluvToRgb(tuple));\n};\nhsluv.Hsluv.hpluvToHex = function(tuple) {\n\treturn hsluv.Hsluv.rgbToHex(hsluv.Hsluv.hpluvToRgb(tuple));\n};\nhsluv.Hsluv.hexToHsluv = function(s) {\n\treturn hsluv.Hsluv.rgbToHsluv(hsluv.Hsluv.hexToRgb(s));\n};\nhsluv.Hsluv.hexToHpluv = function(s) {\n\treturn hsluv.Hsluv.rgbToHpluv(hsluv.Hsluv.hexToRgb(s));\n};\nhsluv.Hsluv.m = [[3.240969941904521,-1.537383177570093,-0.498610760293],[-0.96924363628087,1.87596750150772,0.041555057407175],[0.055630079696993,-0.20397695888897,1.056971514242878]];\nhsluv.Hsluv.minv = [[0.41239079926595,0.35758433938387,0.18048078840183],[0.21263900587151,0.71516867876775,0.072192315360733],[0.019330818715591,0.11919477979462,0.95053215224966]];\nhsluv.Hsluv.refY = 1.0;\nhsluv.Hsluv.refU = 0.19783000664283;\nhsluv.Hsluv.refV = 0.46831999493879;\nhsluv.Hsluv.kappa = 903.2962962;\nhsluv.Hsluv.epsilon = 0.0088564516;\nhsluv.Hsluv.hexChars = \"0123456789abcdef\";\nvar root = {\n    \"hsluvToRgb\": hsluv.Hsluv.hsluvToRgb,\n    \"rgbToHsluv\": hsluv.Hsluv.rgbToHsluv,\n    \"hpluvToRgb\": hsluv.Hsluv.hpluvToRgb,\n    \"rgbToHpluv\": hsluv.Hsluv.rgbToHpluv,\n    \"hsluvToHex\": hsluv.Hsluv.hsluvToHex,\n    \"hexToHsluv\": hsluv.Hsluv.hexToHsluv,\n    \"hpluvToHex\": hsluv.Hsluv.hpluvToHex,\n    \"hexToHpluv\": hsluv.Hsluv.hexToHpluv,\n    \"lchToHpluv\": hsluv.Hsluv.lchToHpluv,\n    \"hpluvToLch\": hsluv.Hsluv.hpluvToLch,\n    \"lchToHsluv\": hsluv.Hsluv.lchToHsluv,\n    \"hsluvToLch\": hsluv.Hsluv.hsluvToLch,\n    \"lchToLuv\": hsluv.Hsluv.lchToLuv,\n    \"luvToLch\": hsluv.Hsluv.luvToLch,\n    \"xyzToLuv\": hsluv.Hsluv.xyzToLuv,\n    \"luvToXyz\": hsluv.Hsluv.luvToXyz,\n    \"xyzToRgb\": hsluv.Hsluv.xyzToRgb,\n    \"rgbToXyz\": hsluv.Hsluv.rgbToXyz,\n    \"lchToRgb\": hsluv.Hsluv.lchToRgb,\n    \"rgbToLch\": hsluv.Hsluv.rgbToLch\n};\n\nmodule.exports = root;\n","import { arrayObj2array, cellCoord2CellIdx } from \"@sudoku-studio/board-utils\";\nimport type { ArrayObj, Geometry, Grid, Idx } from \"@sudoku-studio/schema\";\nimport type { Diff, StateRef } from \"@sudoku-studio/state-manager\";\nimport { pushHistory } from \"../history\";\nimport { userSelectState, userCursorState } from \"../user\";\nimport { makeUid } from \"../util\";\nimport { AdjacentCellPointerHandler, CellDragTapEvent } from \"./adjacentCellPointerHandler\";\nimport type { InputHandler } from \"./inputHandler\";\n\nexport type LineInputHandlerOptions = {\n    deletePrioritizeHead: boolean,\n    deletePrioritizeTail: boolean,\n    allowSelfIntersection: boolean,\n};\n\nexport function getLineInputHandler(stateRef: StateRef, grid: Grid, svg: SVGSVGElement, options: LineInputHandlerOptions): InputHandler {\n    const { deletePrioritizeHead, deletePrioritizeTail, allowSelfIntersection } = options;\n\n    const pointerHandler = new AdjacentCellPointerHandler(true);\n\n    let lineRef: null | StateRef = null;\n    const lineCells: Idx<Geometry.CELL>[] = [];\n\n    pointerHandler.onDragStart = (_event: MouseEvent) => {\n        lineCells.length = 0;\n        lineRef = stateRef.ref(makeUid());\n    };\n\n    pointerHandler.onDrag = (event: CellDragTapEvent) => {\n        if (null == lineRef) throw 'UNREACHABLE';\n\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        const selfHit = lineCells.indexOf(idx, allowSelfIntersection ? lineCells.length - 2 : 0);\n        if (0 <= selfHit) {\n            lineCells.length = selfHit + 1;\n        }\n        else {\n            lineCells.push(idx);\n        }\n\n        lineRef.replace(1 < lineCells.length ? lineCells : null);\n    };\n\n    pointerHandler.onDragEnd = () => {\n        if (null == lineRef) {\n            throw new Error('Line handler, onDragEnd NULL lineRef.');\n        }\n\n        if (1 >= lineCells.length) {\n            lineRef.replace(null);\n        }\n        else {\n            const path = lineRef.path().join('/');\n            const diff: Diff = {\n                redo: {},\n                undo: { [path]: null },\n            };\n            for (let i = 0; i < lineCells.length; i++) {\n                diff.redo[`${path}/${i}`] = lineCells[i];\n            }\n            pushHistory(diff);\n        }\n        lineRef = null;\n    };\n\n    pointerHandler.onTap = (event: CellDragTapEvent) => {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        let lineIdToDelete: null | string = null;\n        for (const [ lineId, lineValArrObj ] of Object.entries(stateRef.get<Record<string, ArrayObj<Idx<Geometry.CELL>>>>() || {})) {\n            const lineValCells = arrayObj2array(lineValArrObj);\n            if (deletePrioritizeHead && idx === lineValCells[0]) {\n                lineIdToDelete = lineId;\n                break;\n            }\n            if (deletePrioritizeTail && idx === lineValCells[lineValCells.length - 1]) {\n                lineIdToDelete = lineId;\n                break;\n            }\n            if (lineValCells.includes(idx)) {\n                lineIdToDelete = lineId\n            }\n        }\n        if (null != lineIdToDelete) {\n            pushHistory(stateRef.ref(`${lineIdToDelete}`).replace(null));\n        }\n    };\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n            pointerHandler.up();\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(_event: KeyboardEvent): void {\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(_event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n        },\n\n        down(event: MouseEvent): void {\n            pointerHandler.down(event);\n        },\n        move(event: MouseEvent): void {\n            pointerHandler.move(event, grid, svg);\n        },\n        up(_event: MouseEvent): void {\n            pointerHandler.up();\n        },\n        leave(event: MouseEvent): void {\n            pointerHandler.leave(event, grid, svg);\n        },\n        click(event: MouseEvent): void {\n            pointerHandler.click(event, grid, svg);\n        },\n    } as const;\n}\n","import type { Geometry, Grid, Idx } from \"@sudoku-studio/schema\";\nimport type { Diff, StateRef } from \"@sudoku-studio/state-manager\";\nimport { AdjacentCellPointerHandler, CellDragTapEvent } from \"../input/adjacentCellPointerHandler\";\nimport type { InputHandler } from \"../input/inputHandler\";\nimport { cellCoord2CellIdx } from \"@sudoku-studio/board-utils\";\nimport { pushHistory } from \"../history\";\nimport { userCursorState, userSelectState } from \"../user\";\nimport type { ElementInfo } from \"./element\";\n\nexport const minInfo: ElementInfo = {\n    getInputHandler,\n    order: 20,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Min',\n        icon: 'min',\n    },\n};\n\nexport const maxInfo: ElementInfo = {\n    getInputHandler,\n    order: 21,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Max',\n        icon: 'max',\n    },\n};\n\nexport const evenInfo: ElementInfo = {\n    getInputHandler,\n    order: 40,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Even',\n        icon: 'odd-even',\n    },\n};\n\nexport const oddInfo: ElementInfo = {\n    getInputHandler,\n    order: 41,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Odd',\n        icon: 'odd-even',\n    },\n};\n\nfunction getInputHandler(stateRef: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n    const pointerHandler = new AdjacentCellPointerHandler(true);\n\n    // Undefined for none, true for adding, null for removing.\n    let mode: undefined | true | null = undefined;\n    function getMode(idx: Idx<Geometry.CELL>): typeof mode {\n        if (undefined === mode) {\n            mode = !stateRef.ref(`${idx}`).get<true>() || null;\n        }\n        return mode;\n    }\n\n    const fullDiff: Diff = {\n        redo: {},\n        undo: {},\n    };\n\n    pointerHandler.onDragStart = (_event: MouseEvent) => {\n        mode = undefined;\n    };\n\n    pointerHandler.onDrag = (event: CellDragTapEvent) => {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        const diff = stateRef.ref(`${idx}`).replace(getMode(idx));\n        if (null != diff) {\n            Object.assign(fullDiff.redo, diff.redo);\n            Object.assign(fullDiff.undo, diff.undo);\n        }\n    };\n\n    pointerHandler.onDragEnd = () => {\n        pushHistory(fullDiff);\n        fullDiff.redo = {};\n        fullDiff.undo = {};\n    };\n\n    pointerHandler.onTap = (event: CellDragTapEvent) => {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        const diff = stateRef.ref(`${idx}`).replace(getMode(idx));\n        pushHistory(diff);\n    };\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n            pointerHandler.up();\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(_event: KeyboardEvent): void {\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(_event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n        },\n\n        down(event: MouseEvent): void {\n            pointerHandler.down(event);\n        },\n        move(event: MouseEvent): void {\n            pointerHandler.move(event, grid, svg);\n        },\n        up(_event: MouseEvent): void {\n            pointerHandler.up();\n        },\n        leave(event: MouseEvent): void {\n            pointerHandler.leave(event, grid, svg);\n        },\n        click(event: MouseEvent): void {\n            pointerHandler.click(event, grid, svg);\n        },\n    } as const;\n}\n","import type { Coord, Geometry, Grid, Idx } from \"@sudoku-studio/schema\";\nimport type { StateRef } from \"@sudoku-studio/state-manager\";\nimport { click2svgCoord, svgCoord2diagonalIdx, svgCoord2edgeIdx, svgCoord2seriesIdx } from \"@sudoku-studio/board-utils\";\nimport { InputHandler, parseDigit } from \"../input/inputHandler\";\nimport { userCursorState, userSelectState } from \"../user\";\nimport type { ElementInfo } from \"./element\";\nimport { pushHistory } from \"../history\";\n\nexport const differenceInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2edgeIdx,\n            max: 10,\n        });\n    },\n    order: 140,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Difference',\n        icon: 'kropki',\n    },\n};\n\nexport const ratioInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2edgeIdx,\n            max: 10,\n        });\n    },\n    order: 141,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Ratio',\n        icon: 'kropki',\n    },\n};\n\nexport const xvInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2edgeIdx,\n            keymap: {\n                // TODO this is jank.\n                'KeyX': 10,\n                'KeyV': 5,\n            },\n            max: 100,\n        });\n    },\n    order: 142,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'XV Sum',\n        icon: 'xv',\n    },\n};\n\nexport const littleKillerInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2diagonalIdx,\n            max: 100,\n        });\n    },\n    order: 160,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Little Killer',\n        icon: 'little-killer',\n    },\n};\n\nexport const sandwichInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2seriesIdx,\n            max: 100,\n        });\n    },\n    order: 150,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Sandwich',\n        icon: 'sandwich',\n    },\n};\n\nexport const skyscraperInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2seriesIdx,\n            max: Math.max(grid.width, grid.height),\n        });\n    },\n    order: 151,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Skyscraper',\n        icon: 'skyscraper',\n    },\n};\n\nexport const xsumsInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getInputHandler(ref, grid, svg, {\n            svgCoord2idx: svgCoord2seriesIdx,\n            max: 100,\n        });\n    },\n    order: 152,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'X-Sums',\n        icon: 'xv',\n    },\n};\n\n\n\n\ntype PositionNumberInputHandlerOptions<TAG extends Geometry> = {\n    svgCoord2idx: (coord: Coord<Geometry.SVG>, grid: Grid) => null | Idx<TAG>,\n    max: number,\n\n    keymap?: Record<string, number | null>,\n};\n\nfunction getInputHandler<TAG extends Geometry>(ref: StateRef, grid: Grid, svg: SVGSVGElement, options: PositionNumberInputHandlerOptions<TAG>): InputHandler {\n    const keymap = options.keymap || {};\n    const { max, svgCoord2idx } = options;\n\n    let idxRef: null | StateRef = null;\n\n    function onDigitInput(code: string): boolean {\n        if (null == idxRef) return false;\n\n        let digit = undefined;\n        if (code in keymap) {\n            digit = keymap[code];\n        }\n        else {\n            digit = parseDigit(code)\n        };\n        if (undefined === digit) return false;\n\n        const oldVal = idxRef.get<true | number>();\n        if (null != digit && 'number' === typeof oldVal) {\n            const multiDigit = oldVal * 10 + digit;\n            if (multiDigit < max)\n                digit = multiDigit;\n        }\n\n        const diff = idxRef.replace(digit ?? (true !== oldVal || null));\n        pushHistory(diff);\n\n        return true;\n    }\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(event: KeyboardEvent): void {\n            if (onDigitInput(event.code)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n            if (onDigitInput(event.currentTarget.value)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n\n        down(_event: MouseEvent): void {\n        },\n        move(_event: MouseEvent): void {\n        },\n        up(_event: MouseEvent): void {\n        },\n        leave(_event: MouseEvent): void {\n        },\n        click(event: MouseEvent): void {\n            const idx = svgCoord2idx(click2svgCoord(event, svg), grid);\n            if (null == idx) return;\n            const clickedIdxRef = ref.ref(`${idx}`);\n\n            if (true === clickedIdxRef.get()) {\n                // Delete empty.\n                clickedIdxRef.replace(null);\n                return;\n            }\n            // Otherwise clear or create new.\n            idxRef = clickedIdxRef;\n            onDigitInput('Delete');\n        },\n    }\n}\n","import type { ElementInfo } from \"./element/element\";\n\nimport { centerInfo, colorsInfo, cornerInfo, filledInfo, givensInfo } from \"./element/digit\";\nimport { betweenInfo, palindromeInfo, renbanInfo, thermoInfo, whisperInfo } from \"./element/lines\";\nimport { consecutiveInfo, disjointGroupsInfo, diagonalInfo, knightInfo, kingInfo, selfTaxicabInfo } from \"./element/toggles\";\nimport { evenInfo, maxInfo, minInfo, oddInfo } from \"./element/region\";\nimport { quadrupleInfo } from \"./element/quadruple\";\nimport { differenceInfo, ratioInfo, xvInfo, sandwichInfo, skyscraperInfo, xsumsInfo, littleKillerInfo } from \"./element/positionNumbers\";\nimport type { schema } from \"@sudoku-studio/schema\";\nimport { boxInfo, gridInfo } from \"./element/basic\";\nimport { arrowInfo } from \"./element/arrow\";\nimport { killerInfo } from \"./element/killer\";\nimport { cloneInfo } from \"./element/clone\";\n\nexport const ELEMENT_HANDLERS = {\n    ['givens']: givensInfo,\n    ['filled']: filledInfo,\n    ['center']: centerInfo,\n    ['corner']: cornerInfo,\n    ['colors']: colorsInfo,\n\n    ['grid']: gridInfo,\n    ['box']: boxInfo,\n\n    ['thermo']: thermoInfo,\n    ['between']: betweenInfo,\n    ['palindrome']: palindromeInfo,\n    ['whisper']: whisperInfo,\n    ['renban']: renbanInfo,\n    ['arrow']: arrowInfo,\n\n    ['min']: minInfo,\n    ['max']: maxInfo,\n    ['odd']: oddInfo,\n    ['even']: evenInfo,\n\n    ['quadruple']: quadrupleInfo,\n    ['killer']: killerInfo,\n    ['clone']: cloneInfo,\n\n    ['difference']: differenceInfo,\n    ['ratio']: ratioInfo,\n    ['xv']: xvInfo,\n\n    ['littleKiller']: littleKillerInfo,\n    ['sandwich']: sandwichInfo,\n    ['skyscraper']: skyscraperInfo,\n    ['xsums']: xsumsInfo,\n\n    ['diagonal']: diagonalInfo,\n    ['knight']: knightInfo,\n    ['king']: kingInfo,\n    ['disjointGroups']: disjointGroupsInfo,\n    ['consecutive']: consecutiveInfo,\n    ['selfTaxicab']: selfTaxicabInfo,\n} as Record<schema.ElementType, null | ElementInfo>;\n\nexport function createElement<E extends schema.Element>(type: E['type'], value?: E['value']): E {\n    if (!(type in ELEMENT_HANDLERS)) throw Error(`Cannot add unknown element type: ${type}.`);\n    const handler = ELEMENT_HANDLERS[type];\n    if (null == handler) throw Error(`Cannot add unimplmeneted element type: ${type}.`);\n\n    return {\n        type,\n        order: handler.order,\n        value: value,\n    } as E; // Technically the type variance for \"E extends schema.Element\" is backwards.\n}\n\nexport function createNewBoard(boxWidth: number = 3, boxHeight: number = 3): schema.Board {\n    const size = boxWidth * boxHeight;\n\n    const board: schema.Board = {\n        grid: {\n            width: size,\n            height: size,\n        },\n        meta: {\n            title: null,\n            author: null,\n            description: null,\n        },\n        elements: {}\n    };\n\n    board.elements['1'] = createElement<schema.GridElement>('grid');\n    board.elements['2'] = createElement<schema.BoxElement>('box', {\n        width: boxWidth,\n        height: boxHeight,\n    });\n    board.elements['10'] = createElement<schema.DigitElement>('givens', {});\n    board.elements['11'] = createElement<schema.DigitElement>('filled', {});\n    board.elements['12'] = createElement<schema.PencilMarksElement>('corner', {});\n    board.elements['13'] = createElement<schema.PencilMarksElement>('center', {});\n    board.elements['14'] = createElement<schema.ColorsElement>('colors', {});\n\n    return board;\n}\n","import type { StateRef } from \"@sudoku-studio/state-manager\";\nimport type { Grid } from \"@sudoku-studio/schema\";\nimport type { InputHandler } from \"../input/inputHandler\";\nimport { getSelectDigitInputHandler } from \"../input/selectDigitInputHandler\";\nimport hsluv from \"hsluv\";\n\nimport type { ElementInfo } from \"./element\";\n\nexport const givensInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getSelectDigitInputHandler(ref, grid, svg, {\n            multipleDigits: false,\n            blockedByGivens: false,\n            blockedByFilled: false,\n            nextMode: 'corner',\n        });\n    },\n    order: 220,\n    permanent: true,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Given',\n        icon: 'given',\n    },\n} as const;\nexport const filledInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getSelectDigitInputHandler(ref, grid, svg, {\n            multipleDigits: false,\n            blockedByGivens: true,\n            blockedByFilled: false,\n            nextMode: 'corner',\n        });\n    },\n    order: 210,\n} as const;\n\nexport const cornerInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getSelectDigitInputHandler(ref, grid, svg, {\n            multipleDigits: true,\n            blockedByGivens: true,\n            blockedByFilled: true,\n            nextMode: 'center',\n        });\n    },\n    order: 200,\n} as const;\nexport const centerInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getSelectDigitInputHandler(ref, grid, svg, {\n            multipleDigits: true,\n            blockedByGivens: true,\n            blockedByFilled: true,\n            nextMode: 'colors',\n        });\n    },\n    order: 200,\n} as const;\n\nexport const colorsInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getSelectDigitInputHandler(ref, grid, svg, {\n            multipleDigits: true,\n            blockedByGivens: false,\n            blockedByFilled: false,\n            nextMode: 'filled',\n            digitMapping: [\n                \"#111111\",\n                \"#666666\",\n                \"#b2b2b2\",\n                hsluv.hsluvToHex([  10, 100, 60 ]),\n                hsluv.hsluvToHex([  40, 100, 65 ]),\n                hsluv.hsluvToHex([  70, 100, 92 ]),\n                hsluv.hsluvToHex([ 120, 100, 80 ]),\n                hsluv.hsluvToHex([ 230, 100, 85 ]),\n                hsluv.hsluvToHex([ 260, 100, 55 ]),\n                hsluv.hsluvToHex([ 300, 100, 70 ]),\n            ],\n        });\n    },\n    order: 10,\n} as const;\n","import type { ElementInfo } from \"./element\";\n\nexport const gridInfo: ElementInfo = {\n    order: 101,\n    permanent: true,\n} as const;\n\nexport const boxInfo: ElementInfo = {\n    order: 100,\n    permanent: true,\n} as const;\n","import type { Grid } from \"@sudoku-studio/schema\";\nimport type { StateRef } from \"@sudoku-studio/state-manager\";\nimport type { InputHandler } from \"../input/inputHandler\";\nimport type { ElementInfo } from \"./element\";\nimport { getLineInputHandler } from \"../input/lineInputHandler\";\n\nexport const thermoInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getLineInputHandler(ref, grid, svg, {\n            deletePrioritizeHead: true,\n            deletePrioritizeTail: false,\n            allowSelfIntersection: false,\n        });\n    },\n    order: 30,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Thermo',\n        icon: 'thermo',\n    },\n};\n\nexport const betweenInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getLineInputHandler(ref, grid, svg, {\n            deletePrioritizeHead: true,\n            deletePrioritizeTail: true,\n            allowSelfIntersection: true,\n        });\n    },\n    order: 50,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Between',\n        icon: 'between',\n    },\n};\n\nexport const palindromeInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getLineInputHandler(ref, grid, svg, {\n            deletePrioritizeHead: false,\n            deletePrioritizeTail: false,\n            allowSelfIntersection: true,\n        });\n    },\n    order: 60,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Palindrome',\n        icon: 'palindrome',\n    },\n};\n\nexport const whisperInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getLineInputHandler(ref, grid, svg, {\n            deletePrioritizeHead: false,\n            deletePrioritizeTail: false,\n            allowSelfIntersection: true,\n        });\n    },\n    order: 70,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Whisper',\n        icon: 'whisper',\n    },\n};\n\nexport const renbanInfo: ElementInfo = {\n    getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n        return getLineInputHandler(ref, grid, svg, {\n            deletePrioritizeHead: false,\n            deletePrioritizeTail: false,\n            allowSelfIntersection: false,\n        });\n    },\n    order: 80,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Renban',\n        icon: 'renban',\n    },\n};\n","import type { Geometry, Grid, Idx, schema } from \"@sudoku-studio/schema\";\nimport type { Diff, StateRef } from \"@sudoku-studio/state-manager\";\nimport { arrayObj2array, cellCoord2CellIdx, cellIdx2cellCoord } from \"../../../../board-utils/lib/board-utils\";\nimport { pushHistory } from \"../history\";\nimport { AdjacentCellPointerHandler, CellDragTapEvent } from \"../input/adjacentCellPointerHandler\";\nimport type { InputHandler } from \"../input/inputHandler\";\nimport { userCursorState, userSelectState } from \"../user\";\nimport { makeUid } from \"../util\";\nimport type { ElementInfo } from \"./element\";\n\nexport const arrowInfo: ElementInfo = {\n    getInputHandler: getArrowInputHandler,\n    order: 90,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Arrow',\n        icon: 'arrow',\n    },\n};\n\n/**\n * Ensures that are sorted in row-major order, and fills in any row gaps.\n * @param cells\n * @param grid\n */\nfunction reorderArrowBulb(cells: Idx<Geometry.CELL>[], grid: Grid): void {\n    let prevX = -1;\n    let prevY = Number.POSITIVE_INFINITY;\n    cells.sort((a, b) => a - b);\n\n    const addedRowCells: Idx<Geometry.CELL>[] = [];\n    for (const idx of cells) {\n        const [ x, y ] = cellIdx2cellCoord(idx, grid);\n        if (y === prevY) {\n            // If we are in the same row as the previous cell, add all between cells (if any).\n            for (let betweenX = prevX + 1; betweenX < x; betweenX++) {\n                addedRowCells.push(cellCoord2CellIdx([ betweenX, y ], grid));\n            }\n        }\n        prevX = x;\n        prevY = y;\n    };\n\n    // Add added row cells and resort.\n    cells.push(...addedRowCells);\n    cells.sort((a, b) => a - b);\n}\n\nexport function getArrowInputHandler(stateRef: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n\n    const pointerHandler = new AdjacentCellPointerHandler(true);\n\n    enum Mode {\n        DYNAMIC = '',\n        BULB = 'bulb',\n        BODY = 'body',\n    }\n\n    let mode: Mode = Mode.DYNAMIC;\n    let arrowRef: null | StateRef = null;\n    let bulbCells: Idx<Geometry.CELL>[] = [];\n    let bodyCells: Idx<Geometry.CELL>[] = [];\n\n    function handleDragStart(idx: Idx<Geometry.CELL>): void {\n        const existingArrows = stateRef.get<schema.ArrowElement['value']>() || {};\n        for (const [ arrowId, { bulb, body } ] of Object.entries(existingArrows)) {\n            const bulbArr = arrayObj2array(bulb || {});\n            if (bulbArr.includes(idx)) {\n                // Adding body to existing arrow.\n                const bodyEmpty = 0 >= arrayObj2array(body || {}).length;\n                // If body is empty, use existing arrow entry. Otherwise create new with same bulb.\n                arrowRef = bodyEmpty ? stateRef.ref(arrowId) : stateRef.ref(makeUid());\n                mode = Mode.BODY;\n                bulbCells = bulbArr;\n                bodyCells = [ idx ];\n\n                arrowRef.ref(Mode.BULB).replace(bulbArr);\n                return;\n            }\n        }\n        // Making bulb.\n        arrowRef = stateRef.ref(makeUid());\n        mode = Mode.BULB;\n        bulbCells = [ idx ];\n        bodyCells = [];\n    }\n\n    function handle(event: CellDragTapEvent) {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        if (Mode.DYNAMIC === mode)\n            handleDragStart(idx);\n\n        if (null == arrowRef) throw 'UNREACHABLE';\n\n        const lineCells = (Mode.BULB === mode) ? bulbCells : bodyCells;\n        const selfHit = lineCells.lastIndexOf(idx);\n        if (0 <= selfHit) {\n            if (Mode.BODY === mode && 0 === selfHit && 2 < lineCells.length) {\n                // Allow crossing the start of the line in special situations.\n                lineCells.push(idx);\n            }\n            else {\n                lineCells.length = selfHit + 1;\n            }\n        }\n        else {\n            lineCells.push(idx);\n        }\n\n        if (Mode.BULB === mode)\n            reorderArrowBulb(lineCells, grid);\n\n        const minLength = (Mode.BULB === mode) ? 1 : 2;\n        arrowRef.ref(mode).replace(minLength <= lineCells.length ? lineCells : null);\n    }\n\n    pointerHandler.onDragStart = (_event: MouseEvent) => {\n        mode = Mode.DYNAMIC;\n    };\n\n    pointerHandler.onDrag = (event: CellDragTapEvent) => {\n        handle(event);\n    };\n\n    pointerHandler.onDragEnd = () => {\n        if (Mode.DYNAMIC === mode) return;\n        if (null == arrowRef) throw 'UNREACHABLE';\n\n        if (0 >= bulbCells.length || 1 === bodyCells.length) {\n            // If 0 === bodyCells.length that means we've placed a bulb -- do not delete.\n            // But if 1 === bodyCells.length then we've added empty to a bulb -- delete.\n            arrowRef.replace(null);\n        }\n        else {\n            const path = arrowRef.path().join('/');\n            const diff: Diff = {\n                redo: {},\n                undo: { [path]: null },\n            };\n            bulbCells.forEach((val, i) => diff.redo[`${path}/bulb/${i}`] = val);\n            bodyCells.forEach((val, i) => diff.redo[`${path}/body/${i}`] = val);\n            pushHistory(diff);\n        }\n        arrowRef = null;\n    };\n\n    pointerHandler.onTap = (event: CellDragTapEvent) => {\n        if (Mode.DYNAMIC !== mode) return;\n\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        let arrowIdToDelete: null | string = null;\n        for (const [ arrowId, { bulb, body } ] of Object.entries(stateRef.get<schema.ArrowElement['value']>() || {})) {\n            if (arrayObj2array(body || {}).includes(idx)) {\n                arrowIdToDelete = arrowId;\n                break; // Prioritize body over bulb for deleting.\n            }\n            if (arrayObj2array(bulb || {}).includes(idx)) {\n                arrowIdToDelete = arrowId;\n            }\n        }\n        if (null != arrowIdToDelete) {\n            pushHistory(stateRef.ref(`${arrowIdToDelete}`).replace(null));\n        }\n        else {\n            handle(event);\n        }\n    };\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n            pointerHandler.up();\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(_event: KeyboardEvent): void {\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(_event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n        },\n\n        down(event: MouseEvent): void {\n            pointerHandler.down(event);\n        },\n        move(event: MouseEvent): void {\n            pointerHandler.move(event, grid, svg);\n        },\n        up(_event: MouseEvent): void {\n            pointerHandler.up();\n        },\n        leave(event: MouseEvent): void {\n            pointerHandler.leave(event, grid, svg);\n        },\n        click(event: MouseEvent): void {\n            pointerHandler.click(event, grid, svg);\n        },\n    } as const;\n}\n\n","import type { ArrayObj, Grid } from \"@sudoku-studio/schema\";\nimport type { StateRef } from \"@sudoku-studio/state-manager\";\nimport { click2svgCoord, cornerCoord2cornerIdx, svgCoord2cornerCoord } from \"@sudoku-studio/board-utils\";\nimport { InputHandler, parseDigit } from \"../input/inputHandler\";\nimport { userCursorState, userSelectState } from \"../user\";\nimport type { ElementInfo } from \"./element\";\nimport { pushHistory } from \"../history\";\n\nexport const quadrupleInfo: ElementInfo = {\n    getInputHandler,\n    order: 110,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Quadruple',\n        icon: 'quadruple',\n    },\n};\n\nfunction getInputHandler(ref: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n    const digits: number[] = [];\n    let cornerRef: null | StateRef = null;\n\n    function onDigitInput(code: string): boolean {\n        if (null == cornerRef) return false;\n\n        const digit = parseDigit(code);\n        if (undefined === digit) return false;\n\n        if (null == digit) {\n            if (true === cornerRef.get<true | ArrayObj<number>>()) {\n                // Already empty -> delete.\n                const diff = cornerRef.replace(null);\n                pushHistory(diff);\n                return true;\n            }\n            digits.length = 0;\n        }\n        else {\n            if (4 <= digits.length) return false;\n            digits.push(digit);\n            digits.sort();\n        }\n\n        const diff = cornerRef.replace(0 < digits.length ? digits : true);\n        pushHistory(diff);\n\n        return true;\n    }\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(event: KeyboardEvent): void {\n            if (onDigitInput(event.code)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n            if (onDigitInput(event.currentTarget.value)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n\n        down(_event: MouseEvent): void {\n        },\n        move(_event: MouseEvent): void {\n        },\n        up(_event: MouseEvent): void {\n        },\n        leave(_event: MouseEvent): void {\n        },\n        click(event: MouseEvent): void {\n            const coord = svgCoord2cornerCoord(click2svgCoord(event, svg), grid);\n            if (null == coord) return;\n\n            const idx = cornerCoord2cornerIdx(coord, grid);\n            const clickedCornerRef = ref.ref(`${idx}`);\n\n            if (true === clickedCornerRef.get()) {\n                // Delete empty.\n                clickedCornerRef.replace(null);\n                return;\n            }\n            // Otherwise clear or create new.\n            cornerRef = clickedCornerRef;\n            onDigitInput('Delete');\n        },\n    }\n}\n","import type { Geometry, Grid, Idx, schema } from \"@sudoku-studio/schema\";\nimport type { Diff, StateRef } from \"@sudoku-studio/state-manager\";\nimport { AdjacentCellPointerHandler, CellDragTapEvent } from \"../input/adjacentCellPointerHandler\";\nimport type { InputHandler } from \"../input/inputHandler\";\nimport { parseDigit } from \"../input/inputHandler\";\nimport { cellCoord2CellIdx } from \"@sudoku-studio/board-utils\";\nimport { userCursorState, userSelectState } from \"../user\";\nimport type { ElementInfo } from \"./element\";\nimport { makeUid } from \"../util\";\nimport { pushHistory } from \"../history\";\n\nexport const killerInfo: ElementInfo = {\n    getInputHandler,\n    order: 120,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Killer',\n        icon: 'killer',\n    },\n};\n\nfunction getInputHandler(stateRef: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n    const pointerHandler = new AdjacentCellPointerHandler(true);\n\n    let cageRef: null | StateRef = null;\n\n    // Undefined for none, true for adding, null for removing.\n    let mode: undefined | true | null = undefined;\n\n    const max = 100;\n    function onDigitInput(code: string): boolean {\n        if (null == cageRef) return false;\n\n        let digit = parseDigit(code)\n        if (undefined === digit) return false;\n\n        const oldVal = cageRef.ref('sum').get<true | number>();\n        if (null != digit && 'number' === typeof oldVal) {\n            const multiDigit = oldVal * 10 + digit;\n            if (multiDigit < max)\n                digit = multiDigit;\n        }\n\n        if (null === digit && null == oldVal) {\n            // If delete on empty, delete the whole cage.\n            const diff = cageRef.replace(null);\n            pushHistory(diff);\n        }\n        else {\n            const diff = cageRef.ref('sum').replace(digit);\n            pushHistory(diff);\n        }\n        return true;\n    }\n\n    function getExistingCageAtIdx(idx: Idx<Geometry.CELL>): null | string {\n        for (const [ cageId, { sum: _, cells } ] of Object.entries(stateRef.get<schema.KillerElement['value']>() || {})) {\n            if (cells[idx]) {\n                return cageId;\n            }\n        }\n        return null;\n    }\n\n    function startDrag(idx: Idx<Geometry.CELL>): void {\n        if (undefined === mode) {\n            const cageId = getExistingCageAtIdx(idx);\n            cageRef = stateRef.ref(cageId || makeUid());\n            mode = true;\n        }\n    }\n\n    const fullDiff: Diff = {\n        redo: {},\n        undo: {},\n    };\n\n    pointerHandler.onDragStart = (_event: MouseEvent) => {\n        mode = undefined;\n    };\n\n    pointerHandler.onDrag = (event: CellDragTapEvent) => {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        if (undefined === mode) {\n            startDrag(idx);\n        }\n        if (null == cageRef) throw 'UNREACHABLE';\n\n        const diff = cageRef.ref('cells', `${idx}`).replace(mode);\n        if (null != diff) {\n            Object.assign(fullDiff.redo, diff.redo);\n            Object.assign(fullDiff.undo, diff.undo);\n        }\n    };\n\n    pointerHandler.onDragEnd = () => {\n        pushHistory(fullDiff);\n        fullDiff.redo = {};\n        fullDiff.undo = {};\n    };\n\n    pointerHandler.onTap = (event: CellDragTapEvent) => {\n        // Ensure this is a tap and not a drag.\n        if (undefined !== mode) return;\n\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        const cageId = getExistingCageAtIdx(idx);\n        if (null != cageId) {\n            // Delete\n            const diff = stateRef.ref(cageId).replace(null);\n            pushHistory(diff);\n        }\n    };\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n            pointerHandler.up();\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(event: KeyboardEvent): void {\n            if (onDigitInput(event.code)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n            if (onDigitInput(event.currentTarget.value)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n\n        down(event: MouseEvent): void {\n            pointerHandler.down(event);\n        },\n        move(event: MouseEvent): void {\n            pointerHandler.move(event, grid, svg);\n        },\n        up(_event: MouseEvent): void {\n            pointerHandler.up();\n        },\n        leave(event: MouseEvent): void {\n            pointerHandler.leave(event, grid, svg);\n        },\n        click(event: MouseEvent): void {\n            pointerHandler.click(event, grid, svg);\n        },\n    } as const;\n}\n","import type { Coord, Geometry, Grid, Idx, schema } from \"@sudoku-studio/schema\";\nimport type { Diff, StateRef } from \"@sudoku-studio/state-manager\";\nimport { AdjacentCellPointerHandler, CellDragTapEvent } from \"../input/adjacentCellPointerHandler\";\nimport type { InputHandler } from \"../input/inputHandler\";\nimport { parseDigit } from \"../input/inputHandler\";\nimport { arrayObj2array, cellCoord2CellIdx, cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\nimport { userCursorState, userSelectState } from \"../user\";\nimport type { ElementInfo } from \"./element\";\nimport { pushHistory } from \"../history\";\nimport { hsluvToHex } from \"hsluv\";\nimport { makeA1Column, makeUid } from \"../util\";\n\nexport const cloneInfo: ElementInfo = {\n    getInputHandler,\n    order: 10,\n    inGlobalMenu: false,\n    menu: {\n        type: 'select',\n        name: 'Clone',\n        icon: 'clone',\n    },\n};\n\nfunction getInputHandler(stateRef: StateRef, grid: Grid, svg: SVGSVGElement): InputHandler {\n    const pointerHandler = new AdjacentCellPointerHandler(true);\n\n    let cloneRef: null | StateRef = null;\n    let moveStart: null | Coord<Geometry.CELL> = null;\n    let cloneEntry = {\n        label: null as null | string,\n        color: null as null | string,\n        a: [] as Idx<Geometry.CELL>[],\n        b: [] as Idx<Geometry.CELL>[],\n    };\n\n    enum Mode {\n        DYNAMIC, // Wait to see: SELECT if on blank, MOVING if on existing.\n        SELECTING,\n        MOVING,\n    }\n\n    // Undefined for none, true for adding, null for removing.\n    let mode: Mode = Mode.DYNAMIC;\n\n    const max = 100;\n    function onDigitInput(code: string): boolean {\n        if (null == cloneRef) return false;\n\n        let digit = parseDigit(code)\n        if (undefined === digit) return false;\n\n        const oldVal = cloneRef.ref('sum').get<true | number>();\n        if (null != digit && 'number' === typeof oldVal) {\n            const multiDigit = oldVal * 10 + digit;\n            if (multiDigit < max)\n                digit = multiDigit;\n        }\n\n        // if (null === digit && null == oldVal) {\n        //     // If delete on empty, delete the whole cage.\n        //     const diff = cloneRef.replace(null);\n        //     pushHistory(diff);\n        // }\n        // else {\n        //     const diff = cloneRef.ref('sum').replace(digit);\n        //     pushHistory(diff);\n        // }\n        return true;\n    }\n\n    function getExistingCloneAtIdx(idx: Idx<Geometry.CELL>): null | [ string, 'a' | 'b' ] {\n        for (const [ cloneId, { a, b } ] of Object.entries(stateRef.get<schema.CloneElement['value']>() || {})) {\n            if (arrayObj2array(a || {}).includes(idx)) {\n                return [ cloneId, 'a' ];\n            }\n            if (arrayObj2array(b || {}).includes(idx)) {\n                return [ cloneId, 'b']\n            }\n        }\n        return null;\n    }\n\n    function makeNewClone(): typeof cloneEntry {\n        const existingLabels = new Set();\n        for (const { label } of Object.values(stateRef.get<schema.CloneElement['value']>() || {})) {\n            if (null != label) existingLabels.add(label);\n        }\n        for (let i = 0;; i++) {\n            const label = makeA1Column(i);\n            if (!existingLabels.has(label)) {\n                return {\n                    label,\n                    color: hsluvToHex([ (127 * i) % 360, 50, 50 ]),\n                    a: [],\n                    b: [],\n                };\n            }\n        }\n    }\n\n    function startDrag(idx: Idx<Geometry.CELL>): void {\n        const existingClone = getExistingCloneAtIdx(idx);\n        if (null != existingClone) {\n            const [ cloneId, clickedAB ] = existingClone;\n            const unclickedAB = 'a' === clickedAB ? 'b' : 'a';\n\n            cloneRef = stateRef.ref(cloneId);\n            mode = Mode.MOVING;\n            cloneEntry = Object.assign({}, cloneRef.get<typeof cloneEntry>());\n\n            if (null != cloneEntry[unclickedAB]) {\n                const clickedArr = arrayObj2array(cloneEntry[clickedAB]);\n                const clickedI = clickedArr.indexOf(idx);\n                moveStart = cellIdx2cellCoord(cloneEntry[unclickedAB][clickedI], grid);\n\n                cloneEntry.a = arrayObj2array(cloneEntry[unclickedAB]);\n                cloneEntry.b = [];\n            }\n            else {\n                moveStart = cellIdx2cellCoord(idx, grid);\n                cloneEntry.a = arrayObj2array(cloneEntry[clickedAB]);\n                cloneEntry.b = [];\n            }\n        }\n        else {\n            cloneRef = stateRef.ref(makeUid());\n            mode = Mode.SELECTING;\n            cloneEntry = makeNewClone();\n        }\n    }\n\n    const fullDiff: Diff = {\n        redo: {},\n        undo: {},\n    };\n\n    pointerHandler.onDragStart = (_event: MouseEvent) => {\n        mode = Mode.DYNAMIC;\n        moveStart = null;\n        cloneRef = null;\n    };\n\n    pointerHandler.onDrag = (event: CellDragTapEvent) => {\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        if (Mode.DYNAMIC === mode) {\n            startDrag(idx);\n        }\n        if (null == cloneRef) throw 'UNREACHABLE';\n\n        if (Mode.SELECTING === mode) {\n            const selfHit = cloneEntry.a.indexOf(idx);\n            if (0 <= selfHit) {\n                return; // No redundant stuffs.\n            }\n            else {\n                cloneEntry.a.push(idx);\n            }\n        }\n        else if (Mode.MOVING === mode) {\n            if (null == moveStart) throw 'UNREACHABLE';\n\n            const offset = cellIdx2cellCoord(idx, grid);\n            offset[0] -= moveStart[0];\n            offset[1] -= moveStart[1];\n\n            const newB: Idx<Geometry.CELL>[] = [];\n            for (let i = 0; i < cloneEntry.a.length; i++) {\n                const aIdx = cloneEntry.a[i];\n\n                const offsetIdx = cellIdx2cellCoord(aIdx, grid);\n                offsetIdx[0] += offset[0];\n                offsetIdx[1] += offset[1];\n                if (offsetIdx[0] < 0 || grid.width <= offsetIdx[0] ||\n                    offsetIdx[1] < 0 || grid.height <= offsetIdx[1])\n                {\n                    return; // Invalid location.\n                }\n\n                const bIdx = cellCoord2CellIdx(offsetIdx, grid);\n                newB.push(bIdx);\n            }\n\n            cloneEntry.b = newB;\n        }\n        else throw 'UNREACHABLE';\n\n        const diff = cloneRef.replace(cloneEntry);\n        pushHistory(diff);\n    };\n\n    pointerHandler.onDragEnd = () => {\n        pushHistory(fullDiff);\n        fullDiff.redo = {};\n        fullDiff.undo = {};\n    };\n\n    pointerHandler.onTap = (event: CellDragTapEvent) => {\n        // Ensure this is a tap and not a drag.\n        if (Mode.DYNAMIC !== mode) return;\n\n        const { coord, grid } = event;\n        const idx = cellCoord2CellIdx(coord, grid);\n\n        const existingClone = getExistingCloneAtIdx(idx);\n        if (null != existingClone) {\n            const [ cloneId, _ ] = existingClone; \n            // Delete\n            const diff = stateRef.ref(cloneId).replace(null);\n            pushHistory(diff);\n        }\n    };\n\n    return {\n        load(): void {\n            // TODO: not really that great of a way of doing this.\n            userSelectState.replace(null);\n            userCursorState.replace(null);\n        },\n        unload(): void {\n            pointerHandler.up();\n        },\n\n        blur(_event: FocusEvent): void {\n        },\n\n        keydown(event: KeyboardEvent): void {\n            if (onDigitInput(event.code)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n        keyup(_event: KeyboardEvent): void {\n        },\n        padClick(event: MouseEvent & { currentTarget: EventTarget & HTMLButtonElement }): void {\n            if (onDigitInput(event.currentTarget.value)) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n            }\n        },\n\n        down(event: MouseEvent): void {\n            pointerHandler.down(event);\n        },\n        move(event: MouseEvent): void {\n            pointerHandler.move(event, grid, svg);\n        },\n        up(_event: MouseEvent): void {\n            pointerHandler.up();\n        },\n        leave(event: MouseEvent): void {\n            pointerHandler.leave(event, grid, svg);\n        },\n        click(event: MouseEvent): void {\n            pointerHandler.click(event, grid, svg);\n        },\n    } as const;\n}\n","import type { ElementInfo } from \"./element\";\n\nexport const diagonalInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Diagonals',\n        checkbox: [\n            {\n                name: 'Positive Diagonal',\n                icon: 'positive-diagonal',\n                refPath: 'positive',\n            },\n            {\n                name: 'Negative Diagonal',\n                icon: 'negative-diagonal',\n                refPath: 'negative',\n            },\n        ],\n    },\n};\n\nexport const disjointGroupsInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Disjoint Groups',\n        checkbox: {\n            name: 'Disjoint Groups',\n            icon: 'disjoint',\n        },\n    },\n};\n\nexport const consecutiveInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Nonconsecutive',\n        checkbox: [\n            {\n                name: 'Nonconsecutive Orthogonal Neighbors',\n                icon: 'consec-orth',\n                refPath: 'orth',\n            },\n            {\n                name: 'Nonconsecutive Diagonal Neighbors',\n                icon: 'consec-diag',\n                refPath: 'diag',\n            },\n        ],\n    },\n};\n\nexport const consecutiveDiagonalInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Nonconsecutive Diag.',\n        checkbox: {\n            name: 'Nonconsecutive',\n            icon: 'nonconsecutive',\n        },\n    },\n};\n\nexport const kingInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Antiking',\n        checkbox: {\n            name: 'Antiking',\n            icon: 'king',\n        },\n    },\n};\n\nexport const knightInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Antiknight',\n        checkbox: {\n            name: 'Antiknight',\n            icon: 'knight',\n        },\n    },\n};\n\nexport const selfTaxicabInfo: ElementInfo = {\n    inGlobalMenu: true,\n    order: 0,\n    menu: {\n        type: 'checkbox',\n        name: 'Self-Taxicab',\n        checkbox: {\n            name: 'Self-Taxicab',\n            icon: 'cityblock',\n        },\n    },\n};\n","import LZString from \"lz-string\";\nimport { cellCoord2CellIdx, svgCoord2diagonalIdx, svgCoord2edgeIdx, roman2num, svgCoord2seriesIdx, cellIdx2cellCoord, svgCoord2cornerCoord, cornerCoord2cornerIdx } from \"@sudoku-studio/board-utils\";\nimport type { Coord, Geometry, Grid, Idx, IdxBitset, schema } from \"@sudoku-studio/schema\";\nimport { makeUid } from \"./util\";\nimport { createElement, createNewBoard } from \"./elements\";\nimport { hexToHsluv, hsluvToHex } from \"hsluv\";\n\ntype FPuzzlesBoard = {\n    size: number,\n    title?: string,\n    author?: string,\n    ruleset?: string,\n    grid: FPuzzlesGridEntry[][],\n    'diagonal+'?: boolean,\n    'diagonal-'?: boolean,\n    antiknight?: boolean,\n    antiking?: boolean,\n    disjointgroups?: boolean,\n    nonconsecutive?: boolean,\n    negative?: string[],\n    arrow?: FPuzzlesArrowEntry[],\n    killercage?: FPuzzlesCells[],\n    littlekillersum?: FPuzzlesLittleKillerSumEntry[],\n    odd?: FPuzzlesCell[],\n    even?: FPuzzlesCell[],\n    minimum?: FPuzzlesCell[],\n    maximum?: FPuzzlesCell[],\n    extraregion?: FPuzzlesCells[],\n    thermometer?: FPuzzlesLines[],\n    palindrome?: FPuzzlesLines[],\n    renban?: FPuzzlesLines[],\n    whispers?: FPuzzlesLines[],\n    difference?: FPuzzlesCells[],\n    xv?: FPuzzlesCells[],\n    ratio?: FPuzzlesCells[],\n    clone?: FPuzzlesClone[],\n    quadruple?: FPuzzlesQuadruple[],\n    betweenline?: FPuzzlesLines[],\n    sandwichsum?: FPuzzlesCell[],\n    // disabledlogic?: string[],\n    // truecandidatesoptions?: string[],\n};\n\ntype FPuzzlesGridEntry = {\n    value?: number,\n    given?: boolean,\n    centerPencilMarks?: number[],\n    cornerPencilMarks?: number[],\n    givenPencilMarks?: number[],\n    highlight?: string,\n    c?: string,\n    region?: number,\n}\n\ntype FPuzzlesArrowEntry = {\n    cells: string[],\n    lines?: string[][],\n};\n\ntype FPuzzlesLittleKillerSumEntry = {\n    cell: string,\n    direction: string,\n    cells?: string[],\n    value?: string,\n};\n\ntype FPuzzlesCell = {\n    cell: string,\n    value?: string,\n};\n\ntype FPuzzlesCells = {\n    cells: string[],\n    value?: string,\n};\n\ntype FPuzzlesLines = {\n    lines: string[][],\n};\n\ntype FPuzzlesClone = {\n    cells: string[],\n    cloneCells: string[],\n};\n\ntype FPuzzlesQuadruple = {\n    cells: string[],\n    values?: [ number?, number?, number?, number? ],\n};\n\n\n\nconst fpuzzlesSizes = {\n    3:  [  3, 1 ],\n    4:  [  2, 2 ],\n    5:  [  5, 1 ],\n    6:  [  3, 2 ],\n    7:  [  7, 1 ],\n    8:  [  4, 2 ],\n    9:  [  3, 3 ],\n    10: [  5, 2 ],\n    11: [ 11, 1 ],\n    12: [  4, 3 ],\n    13: [ 13, 1 ],\n    14: [  7, 2 ],\n    15: [  5, 3 ],\n    16: [  4, 4 ],\n} as const;\n\nconst RC_REGEX = /R(\\d+)C(\\d+)/i;\nfunction parseRCNotation(rc: string): Coord<Geometry.CELL> {\n    const match = RC_REGEX.exec(rc);\n    if (null == match) throw Error(`Failed to parse RC string: ${rc}.`);\n    const row = Number(match[1]);\n    const col = Number(match[2]);\n    const x = col - 1;\n    const y = row - 1;\n    return [ x, y ];\n}\n\n\nexport function parseFpuzzles(b64: string): schema.Board {\n    (window as any).LZString = LZString;\n    const json = LZString.decompressFromBase64(b64);\n    if (null == json) throw Error('Failed to LZString decompress fpuzzles board.');\n    const fBoard: FPuzzlesBoard = JSON.parse(json);\n\n    const size = fBoard.size as undefined | keyof typeof fpuzzlesSizes;\n    if (null == size || !(size in fpuzzlesSizes)) throw Error(`Unknown size: ${size})`);\n\n    const board = createNewBoard(...fpuzzlesSizes[size]);\n    const grid: Grid = { width: size, height: size };\n\n\n    function findOrAddElement<E extends schema.Element>(type: E['type'], value: E['value']): E {\n        if (null == board.elements) board.elements  = {};\n        for (const elem of Object.values(board.elements)) {\n            if (type === elem.type) {\n                Object.assign(elem.value, value);\n                return elem as E;\n            }\n        }\n        const elem = createElement<E>(type, value);\n        board.elements[makeUid()] = elem;\n        return elem;\n    }\n    function addRegionElement(type: schema.RegionElement['type'], fRegionConstraint: FPuzzlesCell[]): void {\n        const elem: schema.RegionElement = findOrAddElement(type, {});\n        for (const fRegionObj of fRegionConstraint) {\n            const cellIdx = cellCoord2CellIdx(parseRCNotation(fRegionObj.cell), grid);\n            elem.value[cellIdx] = true;\n        }\n    }\n    function addLineElement(type: schema.LineElement['type'], fLinesConstraint: FPuzzlesLines[]): void {\n        const elem: schema.LineElement = findOrAddElement(type, {});\n        for (const fLinesObj of fLinesConstraint) {\n            for (const fLine of fLinesObj.lines) {\n                const cellArr: Idx<Geometry.CELL>[] = elem.value[makeUid()] = [];\n                for (const rc of fLine) {\n                    const cellIdx = cellCoord2CellIdx(parseRCNotation(rc), grid);\n                    cellArr.push(cellIdx);\n                }\n            }\n        }\n    }\n    function addEdgeElement(\n        type: schema.EdgeNumberElement['type'],\n        fLinesConstraint: FPuzzlesCells[],\n        parse: (val: string) => null |number = Number): void\n    {\n        const elem: schema.EdgeNumberElement = findOrAddElement(type, {});\n        for (const fCellsObj of fLinesConstraint) {\n            if (2 !== fCellsObj.cells.length) {\n                console.error('Cannot parse difference not between two cells.');\n                continue;\n            }\n            const coordA = parseRCNotation(fCellsObj.cells[0]);\n            const coordB = parseRCNotation(fCellsObj.cells[1]);\n            const average = [\n                0.5 * (coordA[0] + coordB[0] + 1),\n                0.5 * (coordA[1] + coordB[1] + 1),\n            ] as [ number, number ];\n            const edgeIdx = svgCoord2edgeIdx(average, grid);\n\n            if (null == edgeIdx) {\n                console.error(`Cannot parse difference between two nonadjacent cells: ${fCellsObj.cells.join(', ')}.`);\n                continue;\n            }\n\n            const val = (null != fCellsObj.value) ? parse(fCellsObj.value) : null;\n            elem.value[edgeIdx] = (null != val) ? val : true;\n        }\n    }\n    function addSeriesElement(type: schema.SeriesNumberElement['type'], fConstraint: FPuzzlesCell[]):void {\n        const elem: schema.SeriesNumberElement = findOrAddElement(type, {});\n        for (const fCellValue of fConstraint) {\n            // Find the equivalent click location.\n            // Cell is outside the grid.\n            const coord = parseRCNotation(fCellValue.cell) as [ number, number ];\n            coord[0] += 0.5;\n            coord[1] += 0.5;\n\n            const seriesIdx = svgCoord2seriesIdx(coord, grid);\n            if (null == seriesIdx) {\n                console.error('Cannot handle this series.', fCellValue);\n                continue;\n            }\n            elem.value[seriesIdx] = (null != fCellValue.value) ? Number(fCellValue.value) : true;\n        }\n    }\n    function addKillerElement(fConstraint: FPuzzlesCells[]): void {\n        const elem: schema.KillerElement = findOrAddElement('killer', {});\n        for (const fKillerEntry of fConstraint) {\n            const killerItem = elem.value[makeUid()] = {\n                cells: {} as IdxBitset<Geometry.CELL>,\n                sum: (null != fKillerEntry.value) ? Number(fKillerEntry.value) : undefined,\n            };\n            for (const rc of fKillerEntry.cells) {\n                const cellIdx = cellCoord2CellIdx(parseRCNotation(rc), grid);\n                killerItem.cells[cellIdx] = true;\n            }\n        }\n    }\n\n    if (fBoard.title) board.meta.title = fBoard.title;\n    if (fBoard.author) board.meta.author = fBoard.author;\n    if (fBoard.ruleset) board.meta.description = fBoard.ruleset;\n\n    for (let y = 0; y < size; y++) {\n        const gridRow = fBoard.grid[y];\n        for (let x = 0; x < size; x++) {\n            const gridEntry = gridRow[x];\n            const cellIdx = cellCoord2CellIdx([ x, y ], grid);\n\n            if (null != gridEntry.region) {\n                // TODO\n                console.error('Cannot handle f-puzzles regions.');\n            }\n\n            if (null != gridEntry.value) {\n                let elem: schema.DigitElement;\n                if (gridEntry.given) {\n                    elem = findOrAddElement('givens', {});\n                }\n                else {\n                    elem = findOrAddElement('filled', {});\n                }\n                console.log(elem);\n                elem.value[cellIdx] = gridEntry.value;\n            }\n\n            if (gridEntry.cornerPencilMarks) {\n                const elem = findOrAddElement<schema.PencilMarksElement>('corner', {});\n                const cellMarks = elem.value[cellIdx] = {} as Record<number, true>;\n                gridEntry.cornerPencilMarks.forEach(x => cellMarks[x] = true);\n            }\n            if (gridEntry.centerPencilMarks) {\n                const elem = findOrAddElement<schema.PencilMarksElement>('center', {});\n                const cellMarks = elem.value[cellIdx] = {} as Record<number, true>;\n                gridEntry.centerPencilMarks.forEach(x => cellMarks[x] = true);\n            }\n            if (gridEntry.highlight) {\n                const elem = findOrAddElement<schema.ColorsElement>('colors', {});\n                const cellMarks = elem.value[cellIdx] = {} as Record<string, true>;\n                cellMarks[gridEntry.highlight] = true;\n            }\n        }\n    }\n\n    if (fBoard['diagonal+']) findOrAddElement('diagonal', { positive: true });\n    if (fBoard['diagonal-']) findOrAddElement('diagonal', { negative: true });\n    if (fBoard.antiknight) findOrAddElement('knight', true);\n    if (fBoard.antiking) findOrAddElement('king', true);\n    if (fBoard.disjointgroups) findOrAddElement('disjointGroups', true);\n    if (fBoard.nonconsecutive) findOrAddElement('consecutive', { orth: true });\n\n    if (fBoard.thermometer) addLineElement('thermo', fBoard.thermometer);\n    if (fBoard.betweenline) addLineElement('between', fBoard.betweenline);\n    if (fBoard.whispers) addLineElement('whisper', fBoard.whispers);\n    if (fBoard.renban) addLineElement('renban', fBoard.renban);\n    if (fBoard.palindrome) addLineElement('palindrome', fBoard.palindrome);\n\n    if (fBoard.arrow) {\n        const elem: schema.ArrowElement = findOrAddElement('arrow', {});\n        for (const fArrowEntry of fBoard.arrow) {\n            for (const fLine of fArrowEntry.lines || []) {\n                const arrowItem = elem.value[makeUid()] = {\n                    bulb: [] as Idx<Geometry.CELL>[],\n                    body: [] as Idx<Geometry.CELL>[],\n                };\n                for (const rc of fArrowEntry.cells) {\n                    const cellIdx = cellCoord2CellIdx(parseRCNotation(rc), grid);\n                    arrowItem.bulb.push(cellIdx);\n                }\n                for (const rc of fLine) {\n                    const cellIdx = cellCoord2CellIdx(parseRCNotation(rc), grid);\n                    arrowItem.body.push(cellIdx);\n                }\n            }\n        }\n    }\n\n    if (fBoard.sandwichsum) addSeriesElement('sandwich', fBoard.sandwichsum);\n\n    if (fBoard.killercage) addKillerElement(fBoard.killercage);\n    if (fBoard.extraregion) {\n        // TODO: this uses killer cages for now.\n        console.warn('Extra region import uses killer cage.');\n        addKillerElement(fBoard.extraregion);\n    }\n\n    if (fBoard.littlekillersum) {\n        const elem: schema.LittleKillerElement = findOrAddElement('littleKiller', {});\n        for (const fLkEntry of fBoard.littlekillersum) {\n            // Find the equivalent click location.\n            // Cell is outside the grid.\n            const coord = parseRCNotation(fLkEntry.cell) as [ number, number ];\n            if      ('DR' === fLkEntry.direction) { coord[0] += 0.75; coord[1] += 0.75 }\n            else if ('DL' === fLkEntry.direction) { coord[0] += 0.25; coord[1] += 0.75 }\n            else if ('UR' === fLkEntry.direction) { coord[0] += 0.75; coord[1] += 0.25 }\n            else if ('UL' === fLkEntry.direction) { coord[0] += 0.25; coord[1] += 0.25 }\n\n            const diagIdx = svgCoord2diagonalIdx(coord, grid);\n            if (null == diagIdx) {\n                console.error('Cannot handle this diagonal.', fLkEntry);\n                continue;\n            }\n            elem.value[diagIdx] = (null != fLkEntry.value) ? Number(fLkEntry.value) : true;\n        }\n    }\n\n    if (fBoard.difference) addEdgeElement('difference', fBoard.difference);\n    if (fBoard.ratio) addEdgeElement('ratio', fBoard.ratio);\n    if (fBoard.xv) addEdgeElement('xv', fBoard.xv, roman2num);\n\n    if (fBoard.odd) addRegionElement('odd', fBoard.odd);\n    if (fBoard.even) addRegionElement('even', fBoard.even);\n    if (fBoard.minimum) addRegionElement('min', fBoard.minimum);\n    if (fBoard.maximum) addRegionElement('max', fBoard.maximum);\n\n    if (fBoard.quadruple) {\n        console.log('QUADRUPLE!');\n        const elem: schema.QuadrupleElement = findOrAddElement('quadruple', {});\n        for (const fQuadEntry of fBoard.quadruple) {\n            if (4 !== fQuadEntry.cells.length) {\n                // Luckily, f-puzzles doesn't allow quadruples on edges.\n                console.error('Cannot parse quadruple not between four cells.');\n                continue;\n            }\n            const coord = fQuadEntry.cells\n                .map(parseRCNotation)\n                .reduce<[ number, number ]>(([ x0, y0 ], [ x1, y1 ]) => [ x0 + x1, y0 + y1 ], [ 0, 0 ]);\n            coord[0] *= 0.25;\n            coord[1] *= 0.25;\n\n            const cornerCoord = svgCoord2cornerCoord(coord, grid);\n            if (null == cornerCoord) {\n                console.error('Cannot handle this quadruple.', fQuadEntry);\n                continue;\n            }\n\n            const cornerIdx = cornerCoord2cornerIdx(cornerCoord, grid);\n            elem.value[cornerIdx] = (null != fQuadEntry.values) ? fQuadEntry.values : true;\n        }\n    }\n\n    if (fBoard.clone) {\n        const elem: schema.CloneElement = findOrAddElement('clone', {});\n        outer:\n        for (const fCloneEntry of fBoard.clone) {\n            const cloneItem = elem.value[makeUid()] = {\n                color: undefined as undefined | string,\n                a: fCloneEntry.cells     .map (rc => cellCoord2CellIdx(parseRCNotation(rc), grid)),\n                b: fCloneEntry.cloneCells.map(rc => cellCoord2CellIdx(parseRCNotation(rc), grid)),\n            };\n\n            // Try to find color from cells.\n            let color = null;\n            for (const idx of cloneItem.a.concat(cloneItem.b)) {\n                const [ x, y ] = cellIdx2cellCoord(idx, grid);\n                const { c } = fBoard.grid[y][x];\n                if (null == c) continue outer;\n                if (!c.startsWith('#')) continue outer;\n\n                if (null == color) color = c;\n                else if (color !== c) continue outer;\n            }\n            if (null == color) continue;\n            // All have same color.\n            const [ h, s, l ] = hexToHsluv(color);\n            cloneItem.color = hsluvToHex([ h, s, 0.5 * l ]);\n        }\n    }\n\n    if (fBoard.negative) {\n        // TODO\n        console.error(`Cannot handle f-puzzles negative constraints: ${fBoard.negative.join(', ')}.`);\n    }\n\n    return board;\n}\n","import { debounce } from \"debounce\";\nimport LZString from \"lz-string\";\nimport type { schema } from \"@sudoku-studio/schema\";\nimport { boardState } from \"./board\";\nimport { MARK_TYPES, userState } from \"./user\";\nimport { parseFpuzzles } from \"./f-puzzles\";\nimport { createNewBoard } from \"./elements\";\n\n/** Load tools and pencil marks for the user. */\nfunction setupUserState(board: schema.Board) {\n    for (const [ id, { type }] of Object.entries(board.elements)) {\n        if ((MARK_TYPES as readonly string[]).includes(type)) {\n            userState.ref('marks', type).replace(id);\n            if ('filled' === type) {\n                userState.ref('tool').replace(id);\n                userState.ref('prevTool').replace(id);\n            }\n        }\n    }\n}\n\nexport function initUserAndBoard(): void {\n    boardState.watch(debounce((_path, _oldVal, newVal) => {\n        const newUrl = new URL(window.location.href);\n        newUrl.searchParams.set('b', LZString.compressToBase64(JSON.stringify(newVal)));\n        window.history.replaceState(null, '', newUrl.href);\n    }, 200), false, '.');\n\n    const thisUrl = new URL(window.location.href);\n\n    if (thisUrl.searchParams.has('f')) {\n        try {\n            const b64 = thisUrl.searchParams.get('f')!.replace(/ /g, '+');\n            const newBoardState = parseFpuzzles(b64);\n            setupUserState(newBoardState);\n            boardState.update(newBoardState as any);\n\n            thisUrl.searchParams.delete('f');\n            window.history.replaceState(null, '', thisUrl.href);\n\n            return;\n        }\n        catch (e) {\n            console.error('Failed to parse f-puzzles board', e);\n        }\n    }\n\n    if (thisUrl.searchParams.has('b')) {\n        const boardString = thisUrl.searchParams.get('b')!;\n        try {\n            const json = LZString.decompressFromBase64(boardString);\n            if (null != json) {\n                const newBoardState = JSON.parse(json);\n                setupUserState(newBoardState);\n                boardState.update(newBoardState);\n                return;\n            }\n        }\n        catch (e) {\n            console.error('Failed to update board from `b` param.');\n        }\n    }\n    const newBoardState = createNewBoard();\n    setupUserState(newBoardState);\n    boardState.update(newBoardState as any);\n};","export const SUDOKU_STUDIO_VERSION = process.env.SUDOKU_STUDIO_VERSION || 'DEV';\n\nexport const URL_NEW_ISSUE = 'https://github.com/SudokuStudio/SudokuStudio/issues/new';\nexport const URL_REPORT_BUG = URL_NEW_ISSUE\n    + '?labels=bug&template=bug_report.yml&title=%F0%9F%90%9E+Bug%3A+';\nexport const URL_REQUEST_FEATURE = URL_NEW_ISSUE\n    + '?labels=enhancement&template=feature_request.yml&title=%E2%9C%A8+Feature%3A+';\n","<script lang=\"ts\">\n    import { getEdges, cellIdx2cellCoord, arrayObj2array } from \"@sudoku-studio/board-utils\";\n    import type { schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const inset = 0.05;\n    const fontSize = 0.2;\n    const strokeWidth = 0.03;\n\n    type Item = { cloneAbId: string, label: string, labelPos: { x: number, y: number }, d: string, color: string };\n    function each(value: schema.CloneElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const [ cloneId, { label, color, a, b } ] of Object.entries(value)) {\n            for (let i = 0; i < 2; i++) {\n                const cells = [ a, b ][i];\n                if (null == cells) continue;\n                const cellsArr = arrayObj2array(cells);\n                cellsArr.sort((a, b) => a - b);\n                if (0 >= cellsArr.length) continue;\n                const lastIdx = cellsArr[cellsArr.length - 1];\n                const d = getEdges(cellsArr, grid, inset);\n                if (null == d) continue;\n                const lastCoord = cellIdx2cellCoord(lastIdx, grid);\n                const labelPos = {\n                    x: lastCoord[0] + 1 - inset - strokeWidth,\n                    y: lastCoord[1] + 1 - inset - strokeWidth,\n                };\n                const cloneAbId = `${cloneId}_${i}`;\n                out.push({\n                    cloneAbId, labelPos, d,\n                    label: label || '',\n                    color: color || '#222',\n                });\n            }\n        }\n        return out;\n    }\n</script>\n\n\n<g {id}>\n    {#each each($ref || {}) as { cloneAbId, label, labelPos, d, color } (cloneAbId)}\n        <path {d} fill=\"none\" stroke={color} stroke-width={strokeWidth} mask=\"url(#clone-{id}-mask)\" />\n        <text x={labelPos.x} y={labelPos.y} text-anchor=\"end\" dominant-baseline=\"auto\" fill={color} font-size={fontSize} font-weight=\"800\">{label}</text>\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    // @ts-ignore\n    const _ = [ id, ref, grid ]; // Unused.\n</script>\n","<script lang=\"ts\">\nimport { diagonalIdx2dirVec, diagonalIdx2svgCoord } from \"@sudoku-studio/board-utils\";\n\n    import type { Idx, Geometry, schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const color: string = \"#000\";\n    const fontSize = 0.275;\n    const fontWeight = 800;\n    const strokeWidth = 0.025;\n\n    type Item = { idx: Idx<Geometry.EDGE>, x: number, y: number, text: string, d: string };\n    function each(value: schema.SeriesNumberElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const [ diagIdx, digitOrTrue ] of Object.entries(value)) {\n            const text = true !== digitOrTrue ? `${digitOrTrue}` : '_';\n            const [ x, y ] = diagonalIdx2svgCoord(+diagIdx, grid, -0.8);\n            const vec = diagonalIdx2dirVec(+diagIdx);\n            out.push({\n                idx: +diagIdx,\n                x, y, text,\n                d: `M${x + 0.125 * vec[0]},${y + 0.125 * vec[1]}L${x + 0.25 * vec[0]},${y + 0.25 * vec[1]}`,\n            });\n        }\n        return out;\n    }\n</script>\n\n<marker id=\"lk-arrow-{id}\"\n    viewBox=\"0 0 1 1\" refX=\"0.5\" refY=\"0.5\"\n    markerUnits=\"userSpaceOnUse\"\n    markerWidth=\"1\" markerHeight=\"1\"\n    orient=\"auto\"\n>\n    <path d=\"M 0.4,0.425 L 0.5,0.5 L 0.4,0.575\" fill=\"none\" stroke={color} stroke-width={strokeWidth} />\n</marker>\n<g {id}>\n    {#each each($ref || {}) as { idx, x, y, text, d } (idx)}\n        <path {d} stroke={color} stroke-width={strokeWidth} marker-end=\"url(#lk-arrow-{id})\" />\n        <text {x} {y} text-anchor=\"middle\" dominant-baseline=\"central\"\n            fill={color} font-size={fontSize} font-weight={fontWeight}\n            textLength={text.length > 2 ? 1.2 * fontSize : undefined} lengthAdjust=\"spacingAndGlyphs\">{text}</text>\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { Idx, Geometry, schema, Grid, Coord } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    export let idx2coord: (idx: Idx<Geometry>, grid: Grid) => Coord<any>;\n\n    export let stroke: string = \"#242424\";\n    export let fill: string = \"#fff\";\n    export let textColor: string = \"#000\";\n\n    export let radius = 0.15;\n    export let strokeWidth = 0.02;\n    export let fontSize = 0.25;\n    export let fontWeight = 600;\n\n    export let mapDigits = (num: true | number): string => true !== num ? `${num}` : '';\n\n\n    type Item = { idx: Idx<Geometry>, x: number, y: number, text: string };\n    function each(value: schema.SeriesNumberElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const [ idx, digitOrTrue ] of Object.entries(value)) {\n            const text = mapDigits(digitOrTrue!);\n            const [ x, y ] = idx2coord(+idx, grid);\n            out.push({\n                idx: +idx,\n                x, y, text,\n            });\n        }\n        return out;\n    }\n</script>\n\n<g {id}>\n    {#each each($ref || {}) as { idx, x, y, text } (idx)}\n        {#if 0 < radius}\n            <circle cx={x} cy={y} r={radius} {fill} {stroke} stroke-width={strokeWidth} />\n        {/if}\n        <text {x} {y} text-anchor=\"middle\" dominant-baseline=\"central\" fill={textColor} font-size={fontSize} font-weight={fontWeight}>{text}</text>\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { Geometry, IdxMap } from \"@sudoku-studio/schema\";\n    import { makeConicalCellSlice } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n    import hsluv from \"hsluv\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    type Item = { idx: number, slices: { d: string, fill: string }[] };\n    function getMarks(cells: IdxMap<Geometry.CELL, Record<string, boolean>>): Item[] {\n        const out: Item[] = [];\n        for (const [ idx, colorsBitset ] of Object.entries(cells)) {\n            const colors = Object.keys(colorsBitset || {});\n            colors.sort((a, b) => {\n                const hsluvA = hsluv.hexToHsluv(a);\n                const hsluvB = hsluv.hexToHsluv(b);\n                return Math.round(0.06 * (hsluvA[0] - hsluvB[0])) || hsluvA[2] - hsluvB[2];\n            });\n\n            const slices = colors.map((color, i, arr) => ({\n                fill: color,\n                d: makeConicalCellSlice(+idx, grid, i, arr.length),\n            }));\n\n            out.push({ idx: +idx, slices })\n        }\n        return out;\n    }\n</script>\n\n<g {id}>\n    {#each getMarks($ref || {}) as { idx, slices } (idx)}\n        <g id=\"colors-{id}-{idx}\">\n            {#each slices as { d, fill }}\n                <path {d} {fill} fill-opacity=\"0.6\" stroke=\"none\" />\n            {/each}\n        </g>\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { Geometry, Idx, IdxMap } from \"@sudoku-studio/schema\";\n    import { idxMapToKeysArray, cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    function getMarks(cells: IdxMap<Geometry.CELL, Record<string, boolean>>): { idx: number, x: number, y: number, nums: Idx<Geometry.CELL>[] }[] {\n        const out: { idx: number, x: number, y: number, nums: Idx<Geometry.CELL>[] }[] = [];\n        for (const [ idx, nums ] of Object.entries(cells)) {\n            const [ x, y ] = cellIdx2cellCoord(+idx, grid).map(x => x + 0.5);\n            out.push({\n                idx: +idx, x, y,\n                nums: idxMapToKeysArray(nums),\n            })\n        }\n\n        return out;\n    }\n</script>\n\n<g {id} mask=\"url(#SUDOKU_MASK_GIVENS_FILLED)\">\n    {#each getMarks($ref || {}) as { idx, x, y, nums } (idx)}\n        <text {x} {y} fill=\"#4e72b0\" text-anchor=\"middle\" dominant-baseline=\"central\" font-size=\"0.3\" font-weight=\"600\"\n                textLength={nums.length > 5 ? '0.9' : undefined} lengthAdjust=\"spacingAndGlyphs\">\n            {nums.join('')}\n        </text>\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { Geometry, IdxMap } from \"@sudoku-studio/schema\";\n    import { idxMapToKeysArray, cellIdx2cellCoord, cornerMarkPos } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    function getMarks(cells: IdxMap<Geometry.CELL, true | Record<string, boolean>>): { idx: number, nums: { x: number, y: number, num: number }[] }[] {\n        const out: { idx: number, nums: { x: number, y: number, num: number }[] }[] = [];\n        for (const [ idx, numsBitset ] of Object.entries(cells)) {\n            const x = cellIdx2cellCoord(+idx, grid)[0] + 0.5;\n            const y = cellIdx2cellCoord(+idx, grid)[1] + 0.5;\n            const nums = (true === numsBitset) ? [] : idxMapToKeysArray(numsBitset).map((num, i, arr) => {\n                const [ dx, dy ] = cornerMarkPos(i, arr.length)\n                return {\n                    x: x + dx,\n                    y: y + dy,\n                    num,\n                };\n            });\n            out.push({ idx: +idx, nums });\n        }\n        return out;\n    }\n</script>\n\n<g {id} mask=\"url(#SUDOKU_MASK_GIVENS_FILLED)\">\n    {#each getMarks($ref || {}) as { idx, nums } (idx)}\n        {#each nums as { x, y, num }}\n            <text {x} {y} fill=\"#4e72b0\" text-anchor=\"middle\" dominant-baseline=\"central\" font-size=\"0.3\" font-weight=\"600\">\n                {num}\n            </text>\n        {/each}\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { derived } from \"svelte/store\";\n\n    import { getEdges, idxMapToKeysArray, cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n\n    const fill = \"#08f\";\n    const inset = 0.075;\n    const innerRadius = 0.05;\n    const outlineOpacity = '#b2b2b2';\n    const innerOpacity = '#080808';\n    const cursorSize = 0.2;\n\n    const cursorRef = ref.ref('cursor');\n    const dCursor = derived(cursorRef, cursorIdx => {\n        if (null == cursorIdx) return '';\n        const [ x, y ] = cellIdx2cellCoord(cursorIdx, grid);\n        return `M${x},${y}L${x + cursorSize},${y}L${x},${y + cursorSize}Z`;\n    });\n\n    const selectRef = ref.ref('select');\n    const dMask = derived(selectRef, select => getEdges(idxMapToKeysArray(select), grid, inset) || undefined);\n    const dFill = derived(selectRef, select => getEdges(idxMapToKeysArray(select), grid, 0) || undefined);\n</script>\n\n<filter id=\"select-{id}-blur\">\n    <feGaussianBlur in=\"SourceGraphic\" stdDeviation={innerRadius} />\n    <feComponentTransfer>\n        <feFuncR type=\"identity\" />\n        <feFuncG type=\"identity\" />\n        <feFuncB type=\"identity\" />\n        <feFuncA type=\"linear\" slope=\"20\" intercept=\"-9.5\" />\n    </feComponentTransfer>\n</filter>\n<mask id=\"select-{id}-mask\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width={grid.width} height={grid.height}>\n    <rect x=\"0\" y=\"0\" width={grid.width} height={grid.height} fill={outlineOpacity} />\n    <path d={$dMask} fill={innerOpacity} stroke=\"none\" filter=\"url(#select-{id}-blur)\" />\n</mask>\n<g {id}>\n    <path d={$dCursor} {fill} stroke=\"none\" />\n    <path d={$dFill} {fill} stroke=\"none\" mask=\"url(#select-{id}-mask)\" />\n</g>\n","<script lang=\"ts\">\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const positive = ref.ref('positive');\n    const negative = ref.ref('negative');\n</script>\n\n<g {id}>\n    <line class:hide={!$positive} x1=\"0\" y1={grid.height} x2={grid.width} y2=\"0\" />\n    <line class:hide={!$negative} x1=\"0\" y1=\"0\" x2={grid.width} y2={grid.height} />\n</g>\n\n<style lang=\"scss\">\n    line {\n        stroke: rgba(0, 0, 0, 0.2);\n        stroke-width: 0.02;\n    }\n</style>\n","<script lang=\"ts\">\n    import { arrayObj2array, cornerIdx2cornerCoord } from \"@sudoku-studio/board-utils\";\n    import type { Idx, Geometry, schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const radius = 0.2125;\n    const strokeWidth = 0.02;\n\n    const splitter = /.{1,2}/g;\n\n    function each(value: schema.QuadrupleElement['value']): { idx: Idx<Geometry.CORNER>, x: number, y: number, lines: string[] }[] {\n        const out: { idx: number, x: number, y: number, lines: string[] }[] = [];\n        for (const [ cornerIdx, digits ] of Object.entries(value)) {\n            const [ x, y ] = cornerIdx2cornerCoord(+cornerIdx, grid);\n            const digitStr = arrayObj2array(digits as any).join('');\n            const lines = digitStr.match(splitter) || [];\n            out.push({\n                idx: +cornerIdx,\n                x, y, lines,\n            });\n        }\n        return out;\n    }\n    const fontSize = 0.20;\n</script>\n\n<g {id}>\n    {#each each($ref || {}) as { idx, x, y, lines } (idx)}\n        <circle cx={x} cy={y} r={radius} fill=\"#fff\" stroke=\"#000\" stroke-width={strokeWidth} />\n        {#each lines as line, i}\n            <text {x} y={y + 0.9 * fontSize * (i - 0.5 * (lines.length - 1))} text-anchor=\"middle\" dominant-baseline=\"central\" font-size={fontSize} font-weight=\"600\">{line}</text>\n        {/each}\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { idxMapToKeysArray, getEdges, cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import type { Geometry, schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const inset = 0.075;\n    const fontSize = 0.2;\n    const strokeWidth = 0.015;\n\n    type Item = { cageId: string, text: string, labelPos: { x: number, y: number }, d: string };\n    function each(value: schema.KillerElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const [ cageId, { sum, cells } ] of Object.entries(value)) {\n            const cellsArr = idxMapToKeysArray<Geometry.CELL>(cells);\n            if (0 >= cellsArr.length) continue;\n            const firstIdx = cellsArr[0];\n            const d = getEdges(cellsArr, grid, inset);\n            if (null == d) continue;\n            const firstCoord = cellIdx2cellCoord(firstIdx, grid);\n            const labelPos = {\n                x: firstCoord[0] + inset - strokeWidth,\n                y: firstCoord[1] + inset - strokeWidth,\n            };\n            const text = null != sum ? `${sum}` : '';\n            out.push({ cageId, text, labelPos, d });\n        }\n        return out;\n    }\n</script>\n\n\n<mask id=\"killer-{id}-mask\" maskUnits=\"userSpaceOnUse\" maskContentUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width={grid.width} height={grid.height}>\n    <rect x=\"0\" y=\"0\" width={grid.width} height={grid.height} fill=\"#fff\" />\n    {#each each($ref || {}) as { cageId, text, labelPos } (cageId)}\n        <!-- Mask-out each sum label. -->\n        <rect x={labelPos.x} y={labelPos.y} width={0.7 * `${text}`.length * fontSize} height={1.1 * fontSize} fill=\"#000\" />\n    {/each}\n</mask>\n<g {id}>\n    {#each each($ref || {}) as { cageId, text, labelPos, d } (cageId)}\n        <text x={labelPos.x} y={labelPos.y} text-anchor=\"start\" dominant-baseline=\"hanging\" font-size={fontSize} font-weight=\"600\">{text}</text>\n        <path {d} fill=\"none\" stroke=\"#000\" stroke-width={strokeWidth} stroke-dasharray=\"0.075 0.04\" mask=\"url(#killer-{id}-mask)\" />\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { idxMapToKeysArray } from \"@sudoku-studio/board-utils\";\n    import { cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n\n    import type { Idx, Geometry, schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const margin = 0.125;\n    const size = 1 - 2 * margin;\n\n    type Item = { idx: Idx<Geometry.CELL>, x: number, y: number };\n    function each(value: schema.RegionElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const cellIdx of idxMapToKeysArray(value)) {\n            const [ x, y ] = cellIdx2cellCoord(cellIdx, grid);\n            out.push({\n                idx: +cellIdx,\n                x: x + margin,\n                y: y + margin,\n            });\n        }\n        return out;\n    }\n</script>\n\n<g {id}>\n    {#each each($ref || {}) as { idx, x, y } (idx)}\n        <rect {x} {y} width={size} height={size} fill=\"#666\" fill-opacity=\"0.267\" />\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { idxMapToKeysArray } from \"@sudoku-studio/board-utils\";\n    import { cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n\n    import type { Idx, Geometry, schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    type Item = { idx: Idx<Geometry.CELL>, cx: number, cy: number };\n    function each(value: schema.RegionElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const cellIdx of idxMapToKeysArray(value)) {\n            const [ x, y ] = cellIdx2cellCoord(cellIdx, grid);\n            out.push({\n                idx: +cellIdx,\n                cx: x + 0.5,\n                cy: y + 0.5,\n            });\n        }\n        return out;\n    }\n</script>\n\n<g {id}>\n    {#each each($ref || {}) as { idx, cx, cy } (idx)}\n        <circle {cx} {cy} r=\"0.425\" fill=\"#666\" fill-opacity=\"0.267\" />\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n</script>\n\n<!-- Path for <>. -->\n<path id=\"max-{id}\" d=\"M 0.12,0.38 L 0.08,0.50 L 0.12,0.62 M 0.38,0.12 L 0.50,0.08 L 0.62,0.12 M 0.88,0.62 L 0.92,0.50 L 0.88,0.38 M 0.62,0.88 L 0.50,0.92 L 0.38,0.88\"\n    fill=\"none\" stroke=\"#000\" stroke-width=\"0.025\" stroke-miterlimit=\"1.5\" />\n<!-- Mask out four neighbors. -->\n<path id=\"max-{id}-maskitem\" d=\"M -0.5,0.5 L 0.5,-0.5 L 1.5,0.5 L 0.5,1.5 M 0,0 L 0,1 L 1,1 L 1,0\" fill=\"#000\" />\n<!-- Mask. -->\n<mask id=\"max-{id}-mask\" maskUnits=\"userSpaceOnUse\" maskContentUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width={grid.width} height={grid.height}>\n    <!-- Mask out board edges. -->\n    <rect x=\"0.25\" y=\"0.25\" width={grid.width - 0.5} height={grid.height - 0.5} fill=\"#fff\" />\n    {#each Object.entries($ref || {}) as [ idx, _true ] (idx)}\n        <!-- Mask for each cell. -->\n        <use href=\"#max-{id}-maskitem\" transform=\"translate({cellIdx2cellCoord(+idx, grid)[0]},{cellIdx2cellCoord(+idx, grid)[1]})\" fill=\"#000\" />\n    {/each}\n</mask>\n<rect width={grid.width} height={grid.height} fill=\"#fff\" />\n<g {id}>\n    {#each Object.entries($ref || {}) as [ idx, _true ] (idx)}\n        <!-- Background color. -->\n        <rect x={cellIdx2cellCoord(+idx, grid)[0]} y={cellIdx2cellCoord(+idx, grid)[1]} width=\"1\" height=\"1\" fill=\"#7d3737\" fill-opacity=\"0.1\" />\n    {/each}\n    <g mask=\"url(#max-{id}-mask)\">\n        {#each Object.entries($ref || {}) as [ idx, _true ] (idx)}\n            <!-- Each <> cell -->\n            <use href=\"#max-{id}\" transform=\"translate({cellIdx2cellCoord(+idx, grid)[0]},{cellIdx2cellCoord(+idx, grid)[1]})\" />\n        {/each}\n    </g>\n</g>\n","<script lang=\"ts\">\n    import { cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n</script>\n\n<!-- Path for ><. -->\n<path id=\"min-{id}\" d=\"M 0.08,0.38 L 0.12,0.50 L 0.08,0.62 M 0.38,0.08 L 0.50,0.12 L 0.62,0.08 M 0.92,0.62 L 0.88,0.50 L 0.92,0.38 M 0.62,0.92 L 0.50,0.88 L 0.38,0.92\"\n    fill=\"none\" stroke=\"#000\" stroke-width=\"0.025\" stroke-miterlimit=\"1.5\" />\n<!-- Mask out four neighbors. -->\n<path id=\"min-{id}-maskitem\" d=\"M -0.5,0.5 L 0.5,-0.5 L 1.5,0.5 L 0.5,1.5 M 0,0 L 0,1 L 1,1 L 1,0\" fill=\"#000\" />\n<!-- Mask. -->\n<mask id=\"min-{id}-mask\" maskUnits=\"userSpaceOnUse\" maskContentUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width={grid.width} height={grid.height}>\n    <!-- Mask out board edges. -->\n    <rect x=\"0.25\" y=\"0.25\" width={grid.width - 0.5} height={grid.height - 0.5} fill=\"#fff\" />\n    {#each Object.entries($ref || {}) as [ idx, _true ] (idx)}\n        <!-- Mask for each cell. -->\n        <use href=\"#min-{id}-maskitem\" transform=\"translate({cellIdx2cellCoord(+idx, grid)[0]},{cellIdx2cellCoord(+idx, grid)[1]})\" fill=\"#000\" />\n    {/each}\n</mask>\n<rect width={grid.width} height={grid.height} fill=\"#fff\" />\n<g {id}>\n    {#each Object.entries($ref || {}) as [ idx, _true ] (idx)}\n        <!-- Background color. -->\n        <rect x={cellIdx2cellCoord(+idx, grid)[0]} y={cellIdx2cellCoord(+idx, grid)[1]} width=\"1\" height=\"1\" fill=\"#694b7d\" fill-opacity=\"0.1\" />\n    {/each}\n    <g mask=\"url(#min-{id}-mask)\">\n        {#each Object.entries($ref || {}) as [ idx, _true ] (idx)}\n            <!-- Each >< cell. -->\n            <use href=\"#min-{id}\" transform=\"translate({cellIdx2cellCoord(+idx, grid)[0]},{cellIdx2cellCoord(+idx, grid)[1]})\" />\n        {/each}\n    </g>\n</g>\n","<script lang=\"ts\">\n    import type { ArrayObj, Geometry, Idx } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n    import type { MakePathOptions } from \"@sudoku-studio/board-utils\";\n    import { makePath, arrayObj2array } from \"@sudoku-studio/board-utils\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    export let stroke = '#c7855c';\n    export let strokeWidth = 0.125;\n\n    export let pathOptions: MakePathOptions = {\n        shortenHead: 0.2,\n        shortenTail: 0.2,\n        bezierRounding: 0.2,\n    };\n\n    type Item = { itemId: string, d: string };\n    function each(items: null | Record<string, ArrayObj<Idx<Geometry.CELL>>>): Item[] {\n        if (null == items) return [];\n        const out: Item[] = [];\n        for (const [ itemId, idxArrObj ] of Object.entries(items)) {\n            const idxArr = arrayObj2array(idxArrObj);\n            out.push({\n                itemId,\n                d: makePath(idxArr, grid, pathOptions),\n            });\n        }\n        return out;\n    }\n</script>\n\n<g {id}>\n    {#each each($ref) as { itemId, d } (itemId)}\n        <path {d} fill=\"none\" stroke-linejoin=\"round\" stroke-linecap=\"round\"\n            {stroke} stroke-width={strokeWidth} stroke-opacity=\"0.9\" />\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { makePath, arrayObj2array } from \"@sudoku-studio/board-utils\";\n    import type { schema } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const bulbRadius = 0.375;\n    const outlineWidth = 0.025;\n    const strokeWidth = 0.025;\n\n    const color = \"#222\";\n\n    type Item = { arrowId: string, dBulb: string, dBody: string };\n    function each(value: schema.ArrowElement['value']): Item[] {\n        const out: Item[] = [];\n        for (const [ arrowId, { bulb, body } ] of Object.entries(value)) {\n            const dBulb = makePath(arrayObj2array(bulb || {}), grid);\n            const dBody = makePath(arrayObj2array(body || {}), grid, { shortenHead: bulbRadius, shortenTail: 0.2 });\n            out.push({ arrowId, dBulb, dBody });\n        }\n        return out;\n    }\n</script>\n\n\n<marker id=\"arrow-point-{id}\"\n    viewBox=\"0 0 1 1\" refX=\"0.5\" refY=\"0.5\"\n    markerUnits=\"userSpaceOnUse\"\n    markerWidth=\"1\" markerHeight=\"1\"\n    orient=\"auto\"\n>\n    <path d=\"M 0.4,0.425 L 0.5,0.5 L 0.4,0.575\" fill=\"none\" stroke={color} stroke-width={strokeWidth} />\n</marker>\n<g {id}>\n    {#each each($ref || {}) as { arrowId, dBulb, dBody } (arrowId)}\n        <mask id=\"arrow-{id}-mask-{arrowId}\" maskUnits=\"userSpaceOnUse\">\n            <rect width={grid.width} height={grid.height} fill=\"#fff\" />\n            <path d={dBulb} fill=\"none\" stroke=\"#000\" stroke-width={2 * bulbRadius - outlineWidth} stroke-linejoin=\"round\" stroke-linecap=\"round\" />\n        </mask>\n        <path d={dBulb} fill=\"none\" stroke={color} stroke-width={2 * bulbRadius + outlineWidth}\n            mask=\"url(#arrow-{id}-mask-{arrowId})\" stroke-linejoin=\"round\" stroke-linecap=\"round\" />\n        <path d={dBody} fill=\"none\" stroke={color} stroke-width={strokeWidth}\n            stroke-miterlimit=\"1.5\" marker-end=\"url(#arrow-point-{id})\" />\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { ArrayObj, Coord, Geometry, Idx } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n    import { makePath, arrayObj2array, cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import { derived } from \"svelte/store\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const bulbRadius = 0.375;\n    const outlineWidth = 0.025;\n    const strokeWidth = 0.15;\n\n    type Item = { itemId: string, d: string, head: Coord<Geometry.CELL>, tail: Coord<Geometry.CELL> };\n    function getItems(items: null | Record<string, ArrayObj<Idx<Geometry.CELL>>>): Item[] {\n        if (null == items) return [];\n        const out: Item[] = [];\n        for (const [ itemId, idxArrObj ] of Object.entries(items)) {\n            const idxArr = arrayObj2array(idxArrObj);\n            out.push({\n                head: cellIdx2cellCoord(idxArr[0], grid),\n                tail: cellIdx2cellCoord(idxArr[idxArr.length - 1], grid),\n                itemId,\n                d: makePath(idxArr, grid),\n            });\n        }\n        return out;\n    }\n    const items = derived(ref, getItems);\n</script>\n\n\n<marker id=\"between-bulb-{id}\"\n    viewBox=\"0 0 1 1\" refX=\"0.5\" refY=\"0.5\"\n    markerUnits=\"userSpaceOnUse\"\n    markerWidth=\"1\" markerHeight=\"1\"\n    orient=\"auto\"\n>\n    <circle cx=\"0.5\" cy=\"0.5\" r={bulbRadius + 0.5 * outlineWidth} fill=\"#000\" />\n</marker>\n<mask id=\"between-{id}-mask\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width={grid.width} height={grid.height}>\n    <rect width={grid.width} height={grid.height} fill=\"#fff\" />\n    {#each $items as { itemId, head, tail } (itemId)}\n        <circle cx={head[0] + 0.5} cy={head[1] + 0.5} r={bulbRadius - 0.5 * outlineWidth} fill=\"#000\" stroke=\"none\" />\n        <circle cx={tail[0] + 0.5} cy={tail[1] + 0.5} r={bulbRadius - 0.5 * outlineWidth} fill=\"#000\" stroke=\"none\" />\n    {/each}\n</mask>\n<g {id}>\n    {#each $items as { itemId, d } (itemId)}\n        <path {d} fill=\"none\" stroke=\"#c18bb7\" stroke-opacity=\"0.95\" stroke-linejoin=\"round\" stroke-linecap=\"round\"\n            stroke-width={strokeWidth} mask=\"url(#between-{id}-mask)\"\n            marker-start=\"url(#between-bulb-{id})\" marker-end=\"url(#between-bulb-{id})\" />\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import type { ArrayObj, Geometry, Idx } from \"@sudoku-studio/schema\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n    import { makePath, arrayObj2array } from \"@sudoku-studio/board-utils\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    const bulbRadius = 0.375;\n\n    export function getThermos(thermos: Record<string, ArrayObj<Idx<Geometry.CELL>>>): { thermoId: string, d: string, invalid: boolean }[] {\n        const out: { thermoId: string, d: string, invalid: boolean }[] = [];\n        for (const [ thermoId, idxArrObj ] of Object.entries(thermos)) {\n            const idxArr = arrayObj2array(idxArrObj);\n            out.push({\n                thermoId,\n                d: makePath(idxArr, grid, { shortenTail: 0.25, bezierRounding: 0.2 }),\n                invalid: idxArr.length > grid.width,\n            });\n        }\n        return out;\n    }\n</script>\n\n\n<marker id=\"thermo-bulb-{id}\"\n    viewBox=\"0 0 1 1\" refX=\"0.5\" refY=\"0.5\"\n    markerUnits=\"userSpaceOnUse\"\n    markerWidth=\"1\" markerHeight=\"1\"\n    orient=\"auto\"\n>\n    <circle cx=\"0.5\" cy=\"0.5\" r={bulbRadius} fill=\"#444\" />\n</marker>\n<mask id=\"thermo-{id}-mask\" maskUnits=\"userSpaceOnUse\" x=\"0\" y=\"0\" width={grid.width} height={grid.height}>\n    {#each getThermos($ref || {}) as { thermoId, d, invalid } (thermoId)}\n        <path {d} fill=\"none\" stroke={invalid ? '#fff' : '#444'} stroke-width=\"0.2\"\n            marker-start=\"url(#thermo-bulb-{id})\" stroke-linejoin=\"round\" stroke-linecap=\"round\" />\n    {/each}\n</mask>\n<g {id}>\n    <rect x=\"0\" y=\"0\" width={grid.width} height={grid.height} fill=\"#888\" stroke=\"none\" mask=\"url(#thermo-{id}-mask)\" />\n</g>\n","<script lang=\"ts\">\n    import { cellIdx2cellCoord } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    export let color: string = '#000';\n    export let mask: string | undefined = undefined;\n</script>\n\n<g {id} {mask}>\n    {#each Object.entries($ref || {}) as [ idx, num ] (idx)}\n        <text x={cellIdx2cellCoord(+idx, grid)[0] + 0.5} y={cellIdx2cellCoord(+idx, grid)[1] + 0.5}\n            fill={color} text-anchor=\"middle\" dominant-baseline=\"central\" font-size=\"0.775\" font-weight=\"600\">{num}</text>\n    {/each}\n</g>\n","<script lang=\"ts\">\n    import { BOX_THICKNESS, BOX_THICKNESS_HALF } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n</script>\n\n<pattern id=\"box-{id}\" width={$ref.width} height={$ref.height} patternUnits=\"userSpaceOnUse\">\n    <rect width={$ref.width} height={$ref.height} stroke=\"#000\" fill=\"none\" stroke-width={BOX_THICKNESS} />\n</pattern>\n<rect {id}\n    x={-BOX_THICKNESS_HALF}\n    y={-BOX_THICKNESS_HALF}\n    width={grid.width + BOX_THICKNESS}\n    height={grid.height + BOX_THICKNESS}\n    fill=\"url(#box-{id})\" stroke=\"none\" />\n","<script lang=\"ts\">\n    import { GRID_THICKNESS, GRID_THICKNESS_HALF } from \"@sudoku-studio/board-utils\";\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n\n    export let id: string;\n    export let ref: StateRef;\n    export let grid: { width: number, height: number };\n\n    // @ts-ignore\n    const _ = ref; // Unused.\n</script>\n\n\n<pattern id=\"grid-{id}\" width=\"1\" height=\"1\" patternUnits=\"userSpaceOnUse\">\n    <rect width=\"1\" height=\"1\" stroke=\"#000\" fill=\"none\" stroke-width={GRID_THICKNESS} />\n</pattern>\n<rect {id} x={-GRID_THICKNESS_HALF} y={-GRID_THICKNESS_HALF} width={grid.width + GRID_THICKNESS_HALF} height={grid.height + GRID_THICKNESS_HALF} fill=\"url(#grid-{id})\" stroke=\"none\" />\n","<script lang=\"ts\" context=\"module\">\n    import type { Geometry, Grid, Idx, schema } from \"@sudoku-studio/schema\";\n    import type { StateManager, StateRef } from \"@sudoku-studio/state-manager\";\n\n    import { idxMapToKeysArray, BOX_THICKNESS_HALF, edgeIdx2svgCoord, getDigits, getEdges, GRID_THICKNESS_HALF, num2roman, seriesIdx2seriesCoord } from \"@sudoku-studio/board-utils\";\n    import { derived, readable } from \"svelte/store\";\n\n    import GridRender from './svelte/GridRender.svelte';\n    import BoxRender from './svelte/BoxRender.svelte';\n    import DigitRender from './svelte/DigitRender.svelte';\n\n    import ThermoRender from './svelte/ThermoRender.svelte';\n    import BetweenRender from './svelte/BetweenRender.svelte';\n    import ArrowRender from './svelte/ArrowRender.svelte';\n    import LineRender from \"./svelte/LineRender.svelte\";\n\n    import MinRender from './svelte/MinRender.svelte';\n    import MaxRender from './svelte/MaxRender.svelte';\n    import OddRender from \"./svelte/OddRender.svelte\";\n    import EvenRender from \"./svelte/EvenRender.svelte\";\n\n    import KillerRender from './svelte/KillerRender.svelte';\n    import QuadrupleRender from './svelte/QuadrupleRender.svelte';\n    import DiagonalRender from './svelte/DiagonalRender.svelte';\n    import UserRender from './svelte/UserRender.svelte';\n    import CornerRender from './svelte/CornerRender.svelte';\n    import CenterRender from './svelte/CenterRender.svelte';\n    import ColorsRender from './svelte/ColorsRender.svelte';\n    import PositionNumberRender from './svelte/PositionNumberRender.svelte';\n    import LittleKillerRender from \"./svelte/LittleKillerRender.svelte\";\n    import NullRender from './svelte/NullRender.svelte';\nimport CloneRender from \"./svelte/CloneRender.svelte\";\n\n    function FilledRender(args: any) {\n        args.props.color = '#4e72b0';\n        args.props.mask = 'url(#SUDOKU_MASK_GIVENS)';\n        return new DigitRender(args);\n    }\n\n    function DifferenceRender(args: any) {\n        Object.assign(args.props, {\n            idx2coord: edgeIdx2svgCoord,\n            stroke: '#242424',\n            fill: '#fff',\n            textColor: '#000',\n            strokeWidth: 0.02,\n        });\n        return new PositionNumberRender(args);\n    }\n\n    function RatioRender(args: any) {\n        Object.assign(args.props, {\n            idx2coord: edgeIdx2svgCoord,\n            stroke: 'none',\n            fill: '#000',\n            textColor: '#fff',\n        });\n        return new PositionNumberRender(args);\n    }\n\n    function XVRender(args: any) {\n        Object.assign(args.props, {\n            idx2coord: edgeIdx2svgCoord,\n            stroke: 'none',\n            fill: '#fff',\n            textColor: '#000',\n            radius: 0.17,\n            fontSize: 0.3,\n            fontWeight: 800,\n            mapDigits: (num: true | number) => true !== num ? num2roman(num) : '_',\n        });\n        return new PositionNumberRender(args);\n    }\n\n    function SeriesRender(args: any) {\n        Object.assign(args.props, {\n            idx2coord: (idx: Idx<Geometry.SERIES>, grid: Grid) => {\n                const [ x, y ] = seriesIdx2seriesCoord(idx, grid);\n                return [ x + 0.5, y + 0.5 ];\n            },\n            radius: 0,\n            textColor: '#000',\n            fontSize: 0.5,\n            mapDigits: (num: true | number) => true !== num ? num : '_',\n        });\n        return new PositionNumberRender(args);\n    }\n\n    function PalindromeRender(args: any) {\n        Object.assign(args.props, {\n            stroke: '#c7855c',\n            strokeWidth: 0.125,\n        });\n        return new LineRender(args);\n    }\n\n    function WhisperRender(args: any) {\n        Object.assign(args.props, {\n            stroke: '#8fcbcf',\n            strokeWidth: 0.1,\n            pathOptions: {\n                shortenHead: 0,\n                shortenTail: 0,\n                bezierRounding: 0.1,\n            },\n        });\n        return new LineRender(args);\n    }\n\n    function RenbanRender(args: any) {\n        Object.assign(args.props, {\n            stroke: '#cfd184',\n            strokeWidth: 0.075,\n            pathOptions: {\n                shortenHead: 0.15,\n                shortenTail: 0.15,\n                bezierRounding: 0.15,\n            },\n        });\n        return new LineRender(args);\n    }\n\n    export type ElementRenderer = NonNullable<typeof ELEMENT_RENDERERS[keyof typeof ELEMENT_RENDERERS]>;\n    export const ELEMENT_RENDERERS = {\n        ['select']: UserRender,\n\n        ['grid']: GridRender,\n        ['box']: BoxRender,\n\n        ['givens']: DigitRender,\n        ['filled']: FilledRender,\n        ['corner']: CornerRender,\n        ['center']: CenterRender,\n        ['colors']: ColorsRender,\n\n        ['thermo']: ThermoRender,\n        ['between']: BetweenRender,\n        ['palindrome']: PalindromeRender,\n        ['whisper']: WhisperRender,\n        ['renban']: RenbanRender,\n        ['arrow']: ArrowRender,\n\n        ['min']: MinRender,\n        ['max']: MaxRender,\n        ['odd']: OddRender,\n        ['even']: EvenRender,\n\n        ['killer']: KillerRender,\n        ['clone']: CloneRender,\n\n        ['quadruple']: QuadrupleRender,\n        ['difference']: DifferenceRender,\n        ['ratio']: RatioRender,\n        ['xv']: XVRender,\n\n        ['littleKiller']: LittleKillerRender,\n        ['sandwich']: SeriesRender,\n        ['xsums']: SeriesRender,\n        ['skyscraper']: SeriesRender,\n\n        ['diagonal']: DiagonalRender,\n\n        ['knight']: NullRender,\n        ['king']: NullRender,\n        ['disjointGroups']: NullRender,\n        ['consecutive']: NullRender,\n        ['selfTaxicab']: NullRender,\n    } as const;\n\n    // TODO denormalize this.\n    const MARGINS = {\n        ['grid']: GRID_THICKNESS_HALF,\n        ['box']: BOX_THICKNESS_HALF,\n\n        ['quadruple']: 0.2225,\n        ['sandwich']: 1,\n        ['xsums']: 1,\n        ['skyscraper']: 1,\n        ['littleKiller']: 0.5,\n    } as { [K in keyof typeof ELEMENT_RENDERERS]?: number };\n\n</script>\n<script lang=\"ts\">\n    export let userState: StateManager;\n    export let boardState: StateManager;\n    export let svg: SVGSVGElement = null!;\n\n\n    const grid = boardState.ref('grid');\n\n    const elementsRef = boardState.ref('elements');\n    const givensMaskPath = derived([ elementsRef, grid ], ([ elements, grid ]) =>\n        getEdges(idxMapToKeysArray(getDigits(elements || {}, true, false)), grid, 0) || undefined);\n    const givensFilledMaskPath = derived([ elementsRef, grid ], ([ elements, grid ]) =>\n        getEdges(idxMapToKeysArray(getDigits(elements || {}, true, true)), grid, 0) || undefined);\n\n    type ElementList = {\n        id: string,\n        type: keyof typeof ELEMENT_RENDERERS,\n        order: number,\n        ref: StateRef,\n        element: ElementRenderer\n    }[];\n\n    const list = readable<ElementList>([], set => {\n        const list: ElementList = [\n            {\n                id: 'select_192839012', // TODO\n                type: 'select',\n                order: 95, // TODO\n                ref: userState as any, // TODO\n                element: UserRender,\n            },\n        ];\n\n        boardState.ref('elements/*').watch<schema.Element>(([ _elements, elementId ], oldVal, newVal) => {\n            let i = -1;\n            if (null != oldVal) {\n                if (null == ELEMENT_RENDERERS[oldVal.type]) return;\n\n                i = list.findIndex(({ id }) => elementId === id);\n                if (0 > i) {\n                    console.error(`Failed to find renderer for constraint with id ${elementId}.`);\n                    return;\n                }\n            }\n\n            if (null == newVal) {\n                // Deleted.\n                list.splice(i, 1);\n            }\n            else {\n                const element = ELEMENT_RENDERERS[newVal.type];\n                if (null == element) {\n                    console.warn(`Cannot render unknown constraint type: ${newVal.type}.`);\n                    return;\n                }\n\n                const item = {\n                    id: elementId,\n                    type: newVal.type,\n                    order: newVal.order,\n                    ref: boardState.ref(_elements, elementId, 'value'),\n                    element,\n                };\n\n                if (null == oldVal) {\n                    list.push(item);\n                }\n                else {\n                    if (oldVal.type !== newVal.type)\n                        console.error('Cannot change type of constraint!');\n                    list[i] = item;\n                }\n            }\n            list.sort((a, b) => a.order - b.order);\n            set(list);\n        }, true);\n    });\n\n    // TODO somehow update this based on elements.\n    const viewBox = derived([ grid, list ], ([ $grid, $list ]) => {\n        const margin = $list\n            .map(({ type }) => MARGINS[type])\n            .filter<number>((margin): margin is number => null != margin)\n                .reduce((a, b) => a > b ? a : b, 0);\n        return {\n            x: -margin,\n            y: -margin,\n            width: $grid.width + 2 * margin,\n            height: $grid.height + 2 * margin,\n        };\n    });\n</script>\n\n<svg bind:this={svg} viewBox=\"{$viewBox.x} {$viewBox.y} {$viewBox.width} {$viewBox.height}\" xmlns=\"http://www.w3.org/2000/svg\">\n    <style>\n        svg {\n            -webkit-tap-highlight-color: transparent;\n            touch-action: none;\n        }\n        text {\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n        }\n        text::selection {\n            background: none;\n        }\n        svg * {\n            pointer-events: none;\n        }\n        .hide {\n            display: none;\n        }\n    </style>\n    <defs>\n        <mask id=\"SUDOKU_MASK_GIVENS\" maskUnits=\"userSpaceOnUse\">\n            <rect x=\"0\" y=\"0\" width={$grid.width} height={$grid.height} fill=\"#fff\" />\n            <path d={$givensMaskPath} fill=\"#000\" stroke=\"none\" />\n        </mask>\n        <mask id=\"SUDOKU_MASK_GIVENS_FILLED\" maskUnits=\"userSpaceOnUse\">\n            <rect x=\"0\" y=\"0\" width={$grid.width} height={$grid.height} fill=\"#fff\" />\n            <path d={$givensFilledMaskPath} fill=\"#000\" stroke=\"none\" />\n        </mask>\n        {#each $list as { id, ref, element } (id)}\n            <svelte:component this={element} {id} {ref} grid={$grid} />\n        {/each}\n    </defs>\n    {#each $list as { id } (id)}\n        <use href=\"#{id}\" />\n    {/each}\n</svg>\n","import { derived, readable } from \"svelte/store\";\nimport type { StateRef } from \"@sudoku-studio/state-manager\";\nimport type { ElementInfo } from \"./element/element\";\nimport { boardGridRef, boardState, boardSvg } from \"./board\";\nimport type { Grid, schema } from \"@sudoku-studio/schema\";\nimport { createElement, ELEMENT_HANDLERS } from \"./elements\";\nimport { userPrevToolState, userToolState } from \"./user\";\nimport type { InputHandler } from \"./input/inputHandler\";\nimport { pushHistory } from \"./history\";\nimport { makeUid } from \"./util\";\n\nexport type ElementHandlerItem = { id: string, elementRef: StateRef, info: ElementInfo };\nexport type ElementHandlerList = ElementHandlerItem[];\n\nexport function addElement<E extends schema.Element>(type: E['type'], value?: E['value']): string {\n    const element = createElement(type, value);\n    if (!(type in ELEMENT_HANDLERS)) throw Error(`Cannot add unknown element type: ${type}.`);\n    const handler = ELEMENT_HANDLERS[type];\n    if (null == handler) throw Error(`Cannot add unimplmeneted element type: ${type}.`);\n\n    const id = makeUid();\n    const diff = boardState.update({\n        [`elements/${id}`]: element,\n    });\n    pushHistory(diff);\n\n    if ('select' === handler.menu?.type) {\n        userToolState.replace(id);\n        userPrevToolState.replace(id);\n    }\n\n    return id;\n}\n\nexport const elementHandlers = readable<ElementHandlerList>([], set => {\n    const list: ElementHandlerList = [];\n\n    boardState.ref('elements/*').watch<schema.Element>(([ _elements, elementId ], oldVal, newVal) => {\n        const type = oldVal?.type || newVal!.type;\n\n        const elementInfo = ELEMENT_HANDLERS[type];\n        if (null == elementInfo) {\n            console.warn(`Unknown constraint type: ${type}.`);\n            return;\n        }\n\n        let i = -1;\n        if (null != oldVal) {\n            i = list.findIndex(({ id }) => elementId === id);\n            if (0 > i) {\n                console.error(`Failed to find constraint with id ${elementId}.`);\n                return;\n            }\n        }\n\n        if (null == newVal) {\n            // Deleted.\n            list.splice(i, 1);\n        }\n        else {\n            // Add or change.\n            if (null == oldVal) {\n                const elementRef = boardState.ref(_elements, elementId)\n\n                // Add.\n                list.push({\n                    id: elementId,\n                    elementRef,\n                    info: elementInfo,\n                });\n            }\n            else {\n                // Change.\n                if (oldVal.type !== newVal.type)\n                    console.error(`Cannot change type of constraint! ${oldVal.type} -> ${newVal.type}`);\n                // Do nothing.\n            }\n        }\n        list.sort((a, b) =>\n            (+(b.info.permanent || 0) - +(a.info.permanent || 0))\n            || a.info.order - b.info.order);\n\n        set(list);\n    }, true);\n});\n\nexport const currentElement = readable<null | ElementHandlerItem>(null, set => {\n    let list: ElementHandlerList = [];\n    elementHandlers.subscribe(value => list = value);\n\n    userToolState.watch((_path, _oldVal, newVal) => {\n        const toolId = newVal;\n        const out = list.find(({ id }) => toolId === id) || null;\n        // console.log(list, toolId, out);\n        set(out);\n    }, true);\n});\n\nexport const currentInputHandler = derived<[ typeof currentElement, typeof boardSvg ], null | InputHandler>(\n    [ currentElement, boardSvg ],\n    ([ $currentElement, $boardSvg ]) => {\n        if (null == $currentElement) return null;\n        const { info, elementRef } = $currentElement;\n        const valueRef = elementRef.ref('value');\n        if (null == info || null == info.getInputHandler) return null;\n\n        const inputHandler = info.getInputHandler(valueRef, boardGridRef.get<Grid>(), $boardSvg);\n        inputHandler.load();\n        return inputHandler;\n    });\n","<script lang=\"ts\">\n    import { Board } from \"@sudoku-studio/board\";\n    import { boardDiv, boardState, boardSvg } from \"../../js/board\";\n    import { currentInputHandler } from \"../../js/elementStores\";\n    import type { InputHandler } from \"../../js/input/inputHandler\";\n    import { userState } from \"../../js/user\";\n\n    function wrapListener(inputHandler: null | InputHandler, key: keyof InputHandler): (event: any) => void {\n        return event => {\n            if (null != inputHandler && (document.activeElement === $boardDiv || document.activeElement === document.body))\n                inputHandler[key](event);\n        };\n    }\n\n</script>\n\n<svelte:window\n    on:blur={wrapListener($currentInputHandler, 'blur')}\n    on:mouseup={wrapListener($currentInputHandler, 'up')}\n    on:keydown={wrapListener($currentInputHandler, 'keydown')}\n    on:keyup={wrapListener($currentInputHandler, 'keyup')} />\n\n<div bind:this={$boardDiv} class=\"overlay\" tabindex=\"0\"\n    on:mousedown|capture|stopPropagation|preventDefault={event => {\n        event.currentTarget.focus();\n        return $currentInputHandler && $currentInputHandler.down(event);\n    }}\n    on:mousemove|capture|stopPropagation|preventDefault={wrapListener($currentInputHandler, 'move')}\n\n    on:click|capture|stopPropagation|preventDefault={wrapListener($currentInputHandler, 'click')}\n    on:contextmenu|capture|stopPropagation|preventDefault={wrapListener($currentInputHandler, 'click')}\n\n    on:mouseleave|capture|stopPropagation|preventDefault={wrapListener($currentInputHandler, 'leave')}>\n</div>\n<Board bind:svg={$boardSvg} {boardState} {userState} />\n\n<style lang=\"scss\">\n    .overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n\n        cursor: pointer;\n    }\n</style>\n","<script lang=\"ts\">\n    export let icon: string;\n    export let title: string;\n    export let closed: boolean = false;\n    export let onAdd: undefined | svelte.JSX.MouseEventHandler<HTMLButtonElement> = undefined;\n\n    function onClick() {\n        closed = !closed;\n    }\n</script>\n\n<div class=\"container\" class:closed>\n    <div role=\"button\" tabindex=\"0\" class=\"section-title\" on:click={onClick}>\n        <button class=\"delete-button nobutton hoverable\" on:click|stopPropagation={onAdd}>\n            <span class=\"icon hoverable-icon icon-inline icon-c-clickable icon-add\" />\n        </button>\n        <span>\n            <span class=\"icon hoverable-icon icon-inline icon-c-text icon-{icon}\" />\n            {title}\n        </span>\n        <span class=\"tree-menu icon icon-inline icon-c-clickable icon-tree-menu\" />\n    </div>\n    <div class=\"panel-wrapper\">\n        <div class=\"panel\">\n            <slot />\n        </div>\n    </div>\n</div>\n\n<style lang=\"scss\">\n    @use 'src/css/vars';\n\n    .section-title {\n        padding: 0.5em 0.5em;\n        font-weight: vars.$font-weight-heavy;\n\n        display: inline-block;\n        font-size: 1em;\n        font-family: inherit;\n        border: 0;\n        margin: 0;\n        background: none;\n        cursor: pointer;\n        width: 100%;\n        box-sizing: border-box;\n        text-align: left;\n\n        white-space: nowrap;\n\n        @include vars.hoverborder();\n        &:hover, &:focus-visible {\n            @include vars.hoverborder-hover();\n        }\n\n        .delete-button {\n            margin-right: 0.5em;\n        }\n    }\n\n    .tree-menu {\n        transition: transform vars.$transition-time ease-in-out;\n        transform: rotate(180deg);\n        transform-origin: 50% 66%;\n        float: right;\n    }\n    .closed .tree-menu {\n        transform: rotate(0deg);\n    }\n\n    .panel-wrapper {\n        display: flex;\n        overflow: hidden;\n    }\n    .panel-wrapper:after {\n        content: \"\";\n        height: 10px;\n        transition: height vars.$transition-time linear,\n            max-height 0s vars.$transition-time linear;\n        max-height: 0px;\n    }\n    .panel {\n        width: 100%;\n        transition: margin-bottom vars.$transition-time cubic-bezier(0, 0, 0, 1);\n        margin-bottom: 0;\n        max-height: 1000000px;\n    }\n    .closed .panel-wrapper > .panel {\n        margin-bottom: -2000px;\n        transition: margin-bottom vars.$transition-time cubic-bezier(1, 0, 1, 1),\n            visibility 0s vars.$transition-time,\n            max-height 0s vars.$transition-time;\n        visibility: hidden;\n        max-height: 0;\n    }\n    .closed .panel-wrapper:after {\n        height: 0;\n        transition: height vars.$transition-time linear;\n        max-height: 10px;\n    }\n\n    .container {\n        margin-bottom: 0.5em;\n    }\n</style>\n","<script lang=\"ts\" context=\"module\">\n    let counter = 0;\n</script>\n<script type=\"ts\">\n    import { boardDiv } from \"../../../js/board\";\n    import { userToolState, TOOL_INPUT_NAME, userPrevToolState } from \"../../../js/user\";\n\n    export let id: string;\n    export let name: string;\n    export let unused: boolean;\n    export let deletable: boolean;\n\n    export let isLocal: boolean = false;\n    export let onClick: svelte.JSX.MouseEventHandler<HTMLDivElement> | undefined =\n        isLocal ? (() => $userToolState = id) : undefined;\n\n    export let onTrash: svelte.JSX.MouseEventHandler<HTMLButtonElement> | undefined = undefined;\n</script>\n\n<div class=\"constraint-row-container\">\n    {#if isLocal}\n        <input class=\"radio-select-button\" type=\"radio\" id=\"local-radio-{++counter}\" value={id} name={TOOL_INPUT_NAME}\n            bind:group={$userToolState} on:change={() => userPrevToolState.set(userToolState.get())} />\n        <button class=\"nobutton focus-skip\" on:click={() => $boardDiv && $boardDiv.focus()}>Jump To Board</button>\n    {/if}\n    <div class=\"constraint-row\" role=\"button\" on:click|stopPropagation={onClick}>\n        <div class=\"constraint-row-left\">\n            {#if deletable}\n                <button class=\"delete-button nobutton hoverable\" on:click|stopPropagation={onTrash}>\n                    <span class=\"icon hoverable-icon icon-inline icon-c-clickable icon-trash\" />\n                </button><!-- no whitespace\n         -->{/if}{#if isLocal}\n                <label class:unused={unused} class=\"name clickable\" for=\"local-radio-{counter}\">{name}</label>\n            {:else}\n                <span class:unused={unused} class=\"name\">{name}</span>\n            {/if}\n        </div>\n        <div class=\"constraint-row-right\">\n            <slot></slot>\n        </div>\n    </div>\n</div>\n\n<style lang=\"scss\">\n    @use \"@material/ripple\";\n    @use 'src/css/vars';\n    @use 'src/css/clearfix';\n\n    .unused {\n        opacity: 0.5;\n    }\n\n    .constraint-row-container {\n        margin: 0.25em 0 0.5em 0em;\n        position: relative;\n    }\n\n    .constraint-row {\n        @include clearfix.clearfix;\n\n        $padding: 0.25em;\n        padding: $padding;\n\n        cursor: pointer;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        user-select: none;\n\n        @include vars.hoverborder();\n\n        .constraint-row-left {\n            float: left;\n\n            padding-left: 1.5em;\n            .delete-button {\n                margin-left: -1.5em;\n                width: 1.5em;\n            }\n        }\n        .constraint-row-right {\n            margin-left: 0.5em;\n            float: right;\n        }\n\n        z-index: 0;\n    }\n    .radio-select-button:focus-visible {\n        // TODO: pick our own color for keyboard accessibility.\n        outline-offset: -0.1em;\n    }\n    .constraint-row:hover, .radio-select-button:focus-visible ~ .constraint-row  {\n        @include vars.hoverborder-hover();\n    }\n    .radio-select-button:checked ~ .constraint-row {\n        background-color: vars.$color-selected;\n        @include vars.hoverborder-hover();\n    }\n\n    .radio-select-button {\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        appearance: none;\n\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n\n        pointer-events: none;\n        border-radius: vars.$hoverborder-radius;\n    }\n</style>","<script lang=\"ts\">\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n    import type { SelectMenuComponent } from \"../../../js/element/element\";\n\n    import ConstraintRow from \"./ConstraintRow.svelte\";\n\n    export let id: string;\n    export let elementRef: StateRef;\n    export let info: SelectMenuComponent;\n    export let deletable: boolean;\n</script>\n\n<ConstraintRow {id} {deletable} name={info.name} unused={false} isLocal={true} onTrash={() => elementRef.replace(null)}>\n    <span class=\"icon icon-inline icon-c-clickable icon-{info.icon}\" />\n</ConstraintRow>\n","<script lang=\"ts\" context=\"module\">\n    let counter = 0;\n</script>\n<script lang=\"ts\">\n    import type { StateRef } from '@sudoku-studio/state-manager';\n\n    export let name: string;\n    export let icon: string;\n    export let checked: StateRef;\n</script>\n\n<div class=\"constraint-checkbox\" on:click|stopPropagation>\n    <label for=\"checkbox-{++counter}\" title={name} class=\"clickable\">\n        <span class=\"icon icon-inline icon-c-text icon-{icon}\" />\n        <span class=\"sr-only\">{name}</span>\n    </label>\n    <input id=\"checkbox-{counter}\" type=\"checkbox\" bind:checked={$checked} />\n</div>\n\n<style lang=\"scss\">\n    .constraint-checkbox {\n        margin-left: 0.5em;\n        display: inline-block;\n    }\n</style>","<script lang=\"ts\">\n    import type { StateRef } from \"@sudoku-studio/state-manager\";\n    import type { CheckboxMenuComponent } from \"../../../js/element/element\";\n    import ConstraintRow from \"./ConstraintRow.svelte\";\n    import Checkbox from \"./Checkbox.svelte\";\n    import { pushHistory } from \"../../../js/history\";\n\n    export let id: string;\n    export let elementRef: StateRef;\n    export let info: CheckboxMenuComponent;\n    export let deletable: boolean;\n\n    const valueRef = elementRef.ref('value');\n\n    function onClick() {\n        if (!Array.isArray(info.checkbox)) {\n            const diff = valueRef.replace(!valueRef.get<boolean>());\n            pushHistory(diff);\n        }\n        else {\n            const val = info.checkbox.some(({ refPath }) => !valueRef.ref(refPath).get<boolean>());\n            const dict: Record<string, boolean> = {};\n            for (const { refPath } of info.checkbox) {\n                dict[refPath] = val;\n            }\n            const diff = valueRef.replace(dict);\n            pushHistory(diff);\n        }\n    }\n\n    function unused(data: any): boolean { // TODO? Do this somewhere else?\n        if (!Array.isArray(info.checkbox)) {\n            return !data;\n        }\n        else {\n            return info.checkbox.every(({ refPath }) => !valueRef.ref(refPath).get<boolean>());\n        }\n    }\n</script>\n\n<ConstraintRow {id} {deletable} name={info.name} unused={unused($valueRef)} onClick={onClick} onTrash={() => elementRef.replace(null)}>\n    {#each (Array.isArray(info.checkbox) ? info.checkbox : [ info.checkbox ]) as { name, icon, refPath }}\n        <Checkbox {name} {icon} checked={refPath ? valueRef.ref(refPath) : valueRef} />\n    {/each}\n</ConstraintRow>\n","<script lang=\"ts\">\n    import type { ElementHandlerList } from \"../../js/elementStores\";\n    import { addElement } from \"../../js/elementStores\";\n    import type { ElementInfo } from \"../../js/element/element\";\n\n    import EditSection from \"./EditSection.svelte\";\n    import { elementHandlers } from \"../../js/elementStores\";\n    import { derived } from \"svelte/store\";\n    import SelectMenuComponent from \"./constraint/SelectMenuComponent.svelte\";\n    import CheckboxMenuComponent from \"./constraint/CheckboxMenuComponent.svelte\";\n    import { ELEMENT_HANDLERS } from \"../../js/elements\";\n\n    const constraintsGlobal = derived<typeof elementHandlers, ElementHandlerList>(elementHandlers, $elementHandlers => {\n        return $elementHandlers.filter(({ info }) => info.menu && info.inGlobalMenu);\n    });\n    const constraintsLocal = derived<typeof elementHandlers, ElementHandlerList>(elementHandlers, $elementHandlers => {\n        return $elementHandlers.filter(({ info }) => info.menu && !info.inGlobalMenu);\n    });\n\n    function componentFor(element: ElementInfo) {\n        const menuInfo = element.menu;\n        if (null == menuInfo) return null;\n        return function(args: any) {\n            if ('select' === menuInfo.type) {\n                args.props.info = menuInfo;\n                return new SelectMenuComponent(args);\n            }\n            if ('checkbox' === menuInfo.type) {\n                args.props.info = menuInfo;\n                return new CheckboxMenuComponent(args);\n            }\n            throw Error(`Unknown menu type \"${(menuInfo as any).type}\".`);\n        };\n    }\n\n    function showAddModal(_global: boolean): void {\n        const type = window.prompt('TEMPORARY. Enter element type string:\\n'\n            + Object.keys(ELEMENT_HANDLERS).join(', '));\n        if (null == type) return;\n        try {\n            addElement(type as any);\n        }\n        catch (e) {\n            alert(`Unknown or unimplemented element type string: ${JSON.stringify(type)}`)\n        }\n    }\n</script>\n\n<ul class=\"nolist\">\n    <li>\n        <EditSection icon=\"computer\" title=\"Solver Panel\">\n            <div class=\"empty-placeholder\">Nothing here!</div>\n        </EditSection>\n    </li>\n    <li>\n        <EditSection icon=\"globe\" title=\"Global Constraints\" onAdd={() => showAddModal(true)}>\n            <ul class=\"nolist\">\n                {#each $constraintsGlobal as { id, elementRef, info } (id)}\n                    <li>\n                        <svelte:component this={componentFor(info)} {id} {elementRef} deletable={!info.permanent}  />\n                    </li>\n                {:else}\n                    <li><div class=\"empty-placeholder\">Nothing here!</div></li>\n                {/each}\n            </ul>\n        </EditSection>\n    </li>\n    <li>\n        <EditSection icon=\"location\" title=\"Local Constraints\" onAdd={() => showAddModal(false)}>\n            <ul class=\"nolist\">\n                {#each $constraintsLocal as { id, elementRef, info } (id)}\n                    <li>\n                        <svelte:component this={componentFor(info)} {id} {elementRef} deletable={!info.permanent}  />\n                    </li>\n                {:else}\n                    <li><div class=\"empty-placeholder\">Nothing here!</div></li>\n                {/each}\n            </ul>\n        </EditSection>\n    </li>\n    <li>\n        <EditSection icon=\"pencil\" title=\"Cosmetic Tools\">\n            <div class=\"empty-placeholder\">Nothing here!</div>\n        </EditSection>\n    </li>\n</ul>\n\n<style lang=\"scss\">\n    .empty-placeholder {\n        padding: 0.25em 0 0.25em 1.75em;\n    }\n</style>","/**\n * Stores result from supportsCssVariables to avoid redundant processing to\n * detect CSS custom variable support.\n */\nvar supportsCssVariables_;\nexport function supportsCssVariables(windowObj, forceRefresh) {\n    if (forceRefresh === void 0) { forceRefresh = false; }\n    var CSS = windowObj.CSS;\n    var supportsCssVars = supportsCssVariables_;\n    if (typeof supportsCssVariables_ === 'boolean' && !forceRefresh) {\n        return supportsCssVariables_;\n    }\n    var supportsFunctionPresent = CSS && typeof CSS.supports === 'function';\n    if (!supportsFunctionPresent) {\n        return false;\n    }\n    var explicitlySupportsCssVars = CSS.supports('--css-vars', 'yes');\n    // See: https://bugs.webkit.org/show_bug.cgi?id=154669\n    // See: README section on Safari\n    var weAreFeatureDetectingSafari10plus = (CSS.supports('(--css-vars: yes)') &&\n        CSS.supports('color', '#00000000'));\n    supportsCssVars =\n        explicitlySupportsCssVars || weAreFeatureDetectingSafari10plus;\n    if (!forceRefresh) {\n        supportsCssVariables_ = supportsCssVars;\n    }\n    return supportsCssVars;\n}\nexport function getNormalizedEventCoords(evt, pageOffset, clientRect) {\n    if (!evt) {\n        return { x: 0, y: 0 };\n    }\n    var x = pageOffset.x, y = pageOffset.y;\n    var documentX = x + clientRect.left;\n    var documentY = y + clientRect.top;\n    var normalizedX;\n    var normalizedY;\n    // Determine touch point relative to the ripple container.\n    if (evt.type === 'touchstart') {\n        var touchEvent = evt;\n        normalizedX = touchEvent.changedTouches[0].pageX - documentX;\n        normalizedY = touchEvent.changedTouches[0].pageY - documentY;\n    }\n    else {\n        var mouseEvent = evt;\n        normalizedX = mouseEvent.pageX - documentX;\n        normalizedY = mouseEvent.pageY - documentY;\n    }\n    return { x: normalizedX, y: normalizedY };\n}\n//# sourceMappingURL=util.js.map","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || from);\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/**\n * @license\n * Copyright 2016 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nvar MDCFoundation = /** @class */ (function () {\n    function MDCFoundation(adapter) {\n        if (adapter === void 0) { adapter = {}; }\n        this.adapter = adapter;\n    }\n    Object.defineProperty(MDCFoundation, \"cssClasses\", {\n        get: function () {\n            // Classes extending MDCFoundation should implement this method to return an object which exports every\n            // CSS class the foundation class needs as a property. e.g. {ACTIVE: 'mdc-component--active'}\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MDCFoundation, \"strings\", {\n        get: function () {\n            // Classes extending MDCFoundation should implement this method to return an object which exports all\n            // semantic strings as constants. e.g. {ARIA_ROLE: 'tablist'}\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MDCFoundation, \"numbers\", {\n        get: function () {\n            // Classes extending MDCFoundation should implement this method to return an object which exports all\n            // of its semantic numbers as constants. e.g. {ANIMATION_DELAY_MS: 350}\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MDCFoundation, \"defaultAdapter\", {\n        get: function () {\n            // Classes extending MDCFoundation may choose to implement this getter in order to provide a convenient\n            // way of viewing the necessary methods of an adapter. In the future, this could also be used for adapter\n            // validation.\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    MDCFoundation.prototype.init = function () {\n        // Subclasses should override this method to perform initialization routines (registering events, etc.)\n    };\n    MDCFoundation.prototype.destroy = function () {\n        // Subclasses should override this method to perform de-initialization routines (de-registering events, etc.)\n    };\n    return MDCFoundation;\n}());\nexport { MDCFoundation };\n// tslint:disable-next-line:no-default-export Needed for backward compatibility with MDC Web v0.44.0 and earlier.\nexport default MDCFoundation;\n//# sourceMappingURL=foundation.js.map","/**\n * @license\n * Copyright 2016 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nimport { __read, __spreadArray } from \"tslib\";\nimport { MDCFoundation } from './foundation';\nvar MDCComponent = /** @class */ (function () {\n    function MDCComponent(root, foundation) {\n        var args = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            args[_i - 2] = arguments[_i];\n        }\n        this.root = root;\n        this.initialize.apply(this, __spreadArray([], __read(args)));\n        // Note that we initialize foundation here and not within the constructor's default param so that\n        // this.root_ is defined and can be used within the foundation class.\n        this.foundation =\n            foundation === undefined ? this.getDefaultFoundation() : foundation;\n        this.foundation.init();\n        this.initialSyncWithDOM();\n    }\n    MDCComponent.attachTo = function (root) {\n        // Subclasses which extend MDCBase should provide an attachTo() method that takes a root element and\n        // returns an instantiated component with its root set to that element. Also note that in the cases of\n        // subclasses, an explicit foundation class will not have to be passed in; it will simply be initialized\n        // from getDefaultFoundation().\n        return new MDCComponent(root, new MDCFoundation({}));\n    };\n    /* istanbul ignore next: method param only exists for typing purposes; it does not need to be unit tested */\n    MDCComponent.prototype.initialize = function () {\n        var _args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _args[_i] = arguments[_i];\n        }\n        // Subclasses can override this to do any additional setup work that would be considered part of a\n        // \"constructor\". Essentially, it is a hook into the parent constructor before the foundation is\n        // initialized. Any additional arguments besides root and foundation will be passed in here.\n    };\n    MDCComponent.prototype.getDefaultFoundation = function () {\n        // Subclasses must override this method to return a properly configured foundation class for the\n        // component.\n        throw new Error('Subclasses must override getDefaultFoundation to return a properly configured ' +\n            'foundation class');\n    };\n    MDCComponent.prototype.initialSyncWithDOM = function () {\n        // Subclasses should override this method if they need to perform work to synchronize with a host DOM\n        // object. An example of this would be a form control wrapper that needs to synchronize its internal state\n        // to some property or attribute of the host DOM. Please note: this is *not* the place to perform DOM\n        // reads/writes that would cause layout / paint, as this is called synchronously from within the constructor.\n    };\n    MDCComponent.prototype.destroy = function () {\n        // Subclasses may implement this method to release any resources / deregister any listeners they have\n        // attached. An example of this might be deregistering a resize event from the window object.\n        this.foundation.destroy();\n    };\n    MDCComponent.prototype.listen = function (evtType, handler, options) {\n        this.root.addEventListener(evtType, handler, options);\n    };\n    MDCComponent.prototype.unlisten = function (evtType, handler, options) {\n        this.root.removeEventListener(evtType, handler, options);\n    };\n    /**\n     * Fires a cross-browser-compatible custom event from the component root of the given type, with the given data.\n     */\n    MDCComponent.prototype.emit = function (evtType, evtData, shouldBubble) {\n        if (shouldBubble === void 0) { shouldBubble = false; }\n        var evt;\n        if (typeof CustomEvent === 'function') {\n            evt = new CustomEvent(evtType, {\n                bubbles: shouldBubble,\n                detail: evtData,\n            });\n        }\n        else {\n            evt = document.createEvent('CustomEvent');\n            evt.initCustomEvent(evtType, shouldBubble, false, evtData);\n        }\n        this.root.dispatchEvent(evt);\n    };\n    return MDCComponent;\n}());\nexport { MDCComponent };\n// tslint:disable-next-line:no-default-export Needed for backward compatibility with MDC Web v0.44.0 and earlier.\nexport default MDCComponent;\n//# sourceMappingURL=component.js.map","/**\n * @license\n * Copyright 2019 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n/**\n * Determine whether the current browser supports passive event listeners, and\n * if so, use them.\n */\nexport function applyPassive(globalObj) {\n    if (globalObj === void 0) { globalObj = window; }\n    return supportsPassiveOption(globalObj) ?\n        { passive: true } :\n        false;\n}\nfunction supportsPassiveOption(globalObj) {\n    if (globalObj === void 0) { globalObj = window; }\n    // See\n    // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n    var passiveSupported = false;\n    try {\n        var options = {\n            // This function will be called when the browser\n            // attempts to access the passive property.\n            get passive() {\n                passiveSupported = true;\n                return false;\n            }\n        };\n        var handler = function () { };\n        globalObj.document.addEventListener('test', handler, options);\n        globalObj.document.removeEventListener('test', handler, options);\n    }\n    catch (err) {\n        passiveSupported = false;\n    }\n    return passiveSupported;\n}\n//# sourceMappingURL=events.js.map","/**\n * @license\n * Copyright 2016 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nexport var cssClasses = {\n    // Ripple is a special case where the \"root\" component is really a \"mixin\" of sorts,\n    // given that it's an 'upgrade' to an existing component. That being said it is the root\n    // CSS class that all other CSS classes derive from.\n    BG_FOCUSED: 'mdc-ripple-upgraded--background-focused',\n    FG_ACTIVATION: 'mdc-ripple-upgraded--foreground-activation',\n    FG_DEACTIVATION: 'mdc-ripple-upgraded--foreground-deactivation',\n    ROOT: 'mdc-ripple-upgraded',\n    UNBOUNDED: 'mdc-ripple-upgraded--unbounded',\n};\nexport var strings = {\n    VAR_FG_SCALE: '--mdc-ripple-fg-scale',\n    VAR_FG_SIZE: '--mdc-ripple-fg-size',\n    VAR_FG_TRANSLATE_END: '--mdc-ripple-fg-translate-end',\n    VAR_FG_TRANSLATE_START: '--mdc-ripple-fg-translate-start',\n    VAR_LEFT: '--mdc-ripple-left',\n    VAR_TOP: '--mdc-ripple-top',\n};\nexport var numbers = {\n    DEACTIVATION_TIMEOUT_MS: 225,\n    FG_DEACTIVATION_MS: 150,\n    INITIAL_ORIGIN_SCALE: 0.6,\n    PADDING: 10,\n    TAP_DELAY_MS: 300, // Delay between touch and simulated mouse events on touch devices\n};\n//# sourceMappingURL=constants.js.map","/**\n * @license\n * Copyright 2016 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nimport { __assign, __extends } from \"tslib\";\nimport { MDCFoundation } from '@material/base/foundation';\nimport { cssClasses, numbers, strings } from './constants';\nimport { getNormalizedEventCoords } from './util';\n// Activation events registered on the root element of each instance for activation\nvar ACTIVATION_EVENT_TYPES = [\n    'touchstart', 'pointerdown', 'mousedown', 'keydown',\n];\n// Deactivation events registered on documentElement when a pointer-related down event occurs\nvar POINTER_DEACTIVATION_EVENT_TYPES = [\n    'touchend', 'pointerup', 'mouseup', 'contextmenu',\n];\n// simultaneous nested activations\nvar activatedTargets = [];\nvar MDCRippleFoundation = /** @class */ (function (_super) {\n    __extends(MDCRippleFoundation, _super);\n    function MDCRippleFoundation(adapter) {\n        var _this = _super.call(this, __assign(__assign({}, MDCRippleFoundation.defaultAdapter), adapter)) || this;\n        _this.activationAnimationHasEnded_ = false;\n        _this.activationTimer_ = 0;\n        _this.fgDeactivationRemovalTimer_ = 0;\n        _this.fgScale_ = '0';\n        _this.frame_ = { width: 0, height: 0 };\n        _this.initialSize_ = 0;\n        _this.layoutFrame_ = 0;\n        _this.maxRadius_ = 0;\n        _this.unboundedCoords_ = { left: 0, top: 0 };\n        _this.activationState_ = _this.defaultActivationState_();\n        _this.activationTimerCallback_ = function () {\n            _this.activationAnimationHasEnded_ = true;\n            _this.runDeactivationUXLogicIfReady_();\n        };\n        _this.activateHandler_ = function (e) { return _this.activate_(e); };\n        _this.deactivateHandler_ = function () { return _this.deactivate_(); };\n        _this.focusHandler_ = function () { return _this.handleFocus(); };\n        _this.blurHandler_ = function () { return _this.handleBlur(); };\n        _this.resizeHandler_ = function () { return _this.layout(); };\n        return _this;\n    }\n    Object.defineProperty(MDCRippleFoundation, \"cssClasses\", {\n        get: function () {\n            return cssClasses;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MDCRippleFoundation, \"strings\", {\n        get: function () {\n            return strings;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MDCRippleFoundation, \"numbers\", {\n        get: function () {\n            return numbers;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MDCRippleFoundation, \"defaultAdapter\", {\n        get: function () {\n            return {\n                addClass: function () { return undefined; },\n                browserSupportsCssVars: function () { return true; },\n                computeBoundingRect: function () { return ({ top: 0, right: 0, bottom: 0, left: 0, width: 0, height: 0 }); },\n                containsEventTarget: function () { return true; },\n                deregisterDocumentInteractionHandler: function () { return undefined; },\n                deregisterInteractionHandler: function () { return undefined; },\n                deregisterResizeHandler: function () { return undefined; },\n                getWindowPageOffset: function () { return ({ x: 0, y: 0 }); },\n                isSurfaceActive: function () { return true; },\n                isSurfaceDisabled: function () { return true; },\n                isUnbounded: function () { return true; },\n                registerDocumentInteractionHandler: function () { return undefined; },\n                registerInteractionHandler: function () { return undefined; },\n                registerResizeHandler: function () { return undefined; },\n                removeClass: function () { return undefined; },\n                updateCssVariable: function () { return undefined; },\n            };\n        },\n        enumerable: false,\n        configurable: true\n    });\n    MDCRippleFoundation.prototype.init = function () {\n        var _this = this;\n        var supportsPressRipple = this.supportsPressRipple_();\n        this.registerRootHandlers_(supportsPressRipple);\n        if (supportsPressRipple) {\n            var _a = MDCRippleFoundation.cssClasses, ROOT_1 = _a.ROOT, UNBOUNDED_1 = _a.UNBOUNDED;\n            requestAnimationFrame(function () {\n                _this.adapter.addClass(ROOT_1);\n                if (_this.adapter.isUnbounded()) {\n                    _this.adapter.addClass(UNBOUNDED_1);\n                    // Unbounded ripples need layout logic applied immediately to set coordinates for both shade and ripple\n                    _this.layoutInternal_();\n                }\n            });\n        }\n    };\n    MDCRippleFoundation.prototype.destroy = function () {\n        var _this = this;\n        if (this.supportsPressRipple_()) {\n            if (this.activationTimer_) {\n                clearTimeout(this.activationTimer_);\n                this.activationTimer_ = 0;\n                this.adapter.removeClass(MDCRippleFoundation.cssClasses.FG_ACTIVATION);\n            }\n            if (this.fgDeactivationRemovalTimer_) {\n                clearTimeout(this.fgDeactivationRemovalTimer_);\n                this.fgDeactivationRemovalTimer_ = 0;\n                this.adapter.removeClass(MDCRippleFoundation.cssClasses.FG_DEACTIVATION);\n            }\n            var _a = MDCRippleFoundation.cssClasses, ROOT_2 = _a.ROOT, UNBOUNDED_2 = _a.UNBOUNDED;\n            requestAnimationFrame(function () {\n                _this.adapter.removeClass(ROOT_2);\n                _this.adapter.removeClass(UNBOUNDED_2);\n                _this.removeCssVars_();\n            });\n        }\n        this.deregisterRootHandlers_();\n        this.deregisterDeactivationHandlers_();\n    };\n    /**\n     * @param evt Optional event containing position information.\n     */\n    MDCRippleFoundation.prototype.activate = function (evt) {\n        this.activate_(evt);\n    };\n    MDCRippleFoundation.prototype.deactivate = function () {\n        this.deactivate_();\n    };\n    MDCRippleFoundation.prototype.layout = function () {\n        var _this = this;\n        if (this.layoutFrame_) {\n            cancelAnimationFrame(this.layoutFrame_);\n        }\n        this.layoutFrame_ = requestAnimationFrame(function () {\n            _this.layoutInternal_();\n            _this.layoutFrame_ = 0;\n        });\n    };\n    MDCRippleFoundation.prototype.setUnbounded = function (unbounded) {\n        var UNBOUNDED = MDCRippleFoundation.cssClasses.UNBOUNDED;\n        if (unbounded) {\n            this.adapter.addClass(UNBOUNDED);\n        }\n        else {\n            this.adapter.removeClass(UNBOUNDED);\n        }\n    };\n    MDCRippleFoundation.prototype.handleFocus = function () {\n        var _this = this;\n        requestAnimationFrame(function () { return _this.adapter.addClass(MDCRippleFoundation.cssClasses.BG_FOCUSED); });\n    };\n    MDCRippleFoundation.prototype.handleBlur = function () {\n        var _this = this;\n        requestAnimationFrame(function () { return _this.adapter.removeClass(MDCRippleFoundation.cssClasses.BG_FOCUSED); });\n    };\n    /**\n     * We compute this property so that we are not querying information about the client\n     * until the point in time where the foundation requests it. This prevents scenarios where\n     * client-side feature-detection may happen too early, such as when components are rendered on the server\n     * and then initialized at mount time on the client.\n     */\n    MDCRippleFoundation.prototype.supportsPressRipple_ = function () {\n        return this.adapter.browserSupportsCssVars();\n    };\n    MDCRippleFoundation.prototype.defaultActivationState_ = function () {\n        return {\n            activationEvent: undefined,\n            hasDeactivationUXRun: false,\n            isActivated: false,\n            isProgrammatic: false,\n            wasActivatedByPointer: false,\n            wasElementMadeActive: false,\n        };\n    };\n    /**\n     * supportsPressRipple Passed from init to save a redundant function call\n     */\n    MDCRippleFoundation.prototype.registerRootHandlers_ = function (supportsPressRipple) {\n        var _this = this;\n        if (supportsPressRipple) {\n            ACTIVATION_EVENT_TYPES.forEach(function (evtType) {\n                _this.adapter.registerInteractionHandler(evtType, _this.activateHandler_);\n            });\n            if (this.adapter.isUnbounded()) {\n                this.adapter.registerResizeHandler(this.resizeHandler_);\n            }\n        }\n        this.adapter.registerInteractionHandler('focus', this.focusHandler_);\n        this.adapter.registerInteractionHandler('blur', this.blurHandler_);\n    };\n    MDCRippleFoundation.prototype.registerDeactivationHandlers_ = function (evt) {\n        var _this = this;\n        if (evt.type === 'keydown') {\n            this.adapter.registerInteractionHandler('keyup', this.deactivateHandler_);\n        }\n        else {\n            POINTER_DEACTIVATION_EVENT_TYPES.forEach(function (evtType) {\n                _this.adapter.registerDocumentInteractionHandler(evtType, _this.deactivateHandler_);\n            });\n        }\n    };\n    MDCRippleFoundation.prototype.deregisterRootHandlers_ = function () {\n        var _this = this;\n        ACTIVATION_EVENT_TYPES.forEach(function (evtType) {\n            _this.adapter.deregisterInteractionHandler(evtType, _this.activateHandler_);\n        });\n        this.adapter.deregisterInteractionHandler('focus', this.focusHandler_);\n        this.adapter.deregisterInteractionHandler('blur', this.blurHandler_);\n        if (this.adapter.isUnbounded()) {\n            this.adapter.deregisterResizeHandler(this.resizeHandler_);\n        }\n    };\n    MDCRippleFoundation.prototype.deregisterDeactivationHandlers_ = function () {\n        var _this = this;\n        this.adapter.deregisterInteractionHandler('keyup', this.deactivateHandler_);\n        POINTER_DEACTIVATION_EVENT_TYPES.forEach(function (evtType) {\n            _this.adapter.deregisterDocumentInteractionHandler(evtType, _this.deactivateHandler_);\n        });\n    };\n    MDCRippleFoundation.prototype.removeCssVars_ = function () {\n        var _this = this;\n        var rippleStrings = MDCRippleFoundation.strings;\n        var keys = Object.keys(rippleStrings);\n        keys.forEach(function (key) {\n            if (key.indexOf('VAR_') === 0) {\n                _this.adapter.updateCssVariable(rippleStrings[key], null);\n            }\n        });\n    };\n    MDCRippleFoundation.prototype.activate_ = function (evt) {\n        var _this = this;\n        if (this.adapter.isSurfaceDisabled()) {\n            return;\n        }\n        var activationState = this.activationState_;\n        if (activationState.isActivated) {\n            return;\n        }\n        // Avoid reacting to follow-on events fired by touch device after an already-processed user interaction\n        var previousActivationEvent = this.previousActivationEvent_;\n        var isSameInteraction = previousActivationEvent && evt !== undefined && previousActivationEvent.type !== evt.type;\n        if (isSameInteraction) {\n            return;\n        }\n        activationState.isActivated = true;\n        activationState.isProgrammatic = evt === undefined;\n        activationState.activationEvent = evt;\n        activationState.wasActivatedByPointer = activationState.isProgrammatic ? false : evt !== undefined && (evt.type === 'mousedown' || evt.type === 'touchstart' || evt.type === 'pointerdown');\n        var hasActivatedChild = evt !== undefined &&\n            activatedTargets.length > 0 &&\n            activatedTargets.some(function (target) { return _this.adapter.containsEventTarget(target); });\n        if (hasActivatedChild) {\n            // Immediately reset activation state, while preserving logic that prevents touch follow-on events\n            this.resetActivationState_();\n            return;\n        }\n        if (evt !== undefined) {\n            activatedTargets.push(evt.target);\n            this.registerDeactivationHandlers_(evt);\n        }\n        activationState.wasElementMadeActive = this.checkElementMadeActive_(evt);\n        if (activationState.wasElementMadeActive) {\n            this.animateActivation_();\n        }\n        requestAnimationFrame(function () {\n            // Reset array on next frame after the current event has had a chance to bubble to prevent ancestor ripples\n            activatedTargets = [];\n            if (!activationState.wasElementMadeActive\n                && evt !== undefined\n                && (evt.key === ' ' || evt.keyCode === 32)) {\n                // If space was pressed, try again within an rAF call to detect :active, because different UAs report\n                // active states inconsistently when they're called within event handling code:\n                // - https://bugs.chromium.org/p/chromium/issues/detail?id=635971\n                // - https://bugzilla.mozilla.org/show_bug.cgi?id=1293741\n                // We try first outside rAF to support Edge, which does not exhibit this problem, but will crash if a CSS\n                // variable is set within a rAF callback for a submit button interaction (#2241).\n                activationState.wasElementMadeActive = _this.checkElementMadeActive_(evt);\n                if (activationState.wasElementMadeActive) {\n                    _this.animateActivation_();\n                }\n            }\n            if (!activationState.wasElementMadeActive) {\n                // Reset activation state immediately if element was not made active.\n                _this.activationState_ = _this.defaultActivationState_();\n            }\n        });\n    };\n    MDCRippleFoundation.prototype.checkElementMadeActive_ = function (evt) {\n        return (evt !== undefined && evt.type === 'keydown') ?\n            this.adapter.isSurfaceActive() :\n            true;\n    };\n    MDCRippleFoundation.prototype.animateActivation_ = function () {\n        var _this = this;\n        var _a = MDCRippleFoundation.strings, VAR_FG_TRANSLATE_START = _a.VAR_FG_TRANSLATE_START, VAR_FG_TRANSLATE_END = _a.VAR_FG_TRANSLATE_END;\n        var _b = MDCRippleFoundation.cssClasses, FG_DEACTIVATION = _b.FG_DEACTIVATION, FG_ACTIVATION = _b.FG_ACTIVATION;\n        var DEACTIVATION_TIMEOUT_MS = MDCRippleFoundation.numbers.DEACTIVATION_TIMEOUT_MS;\n        this.layoutInternal_();\n        var translateStart = '';\n        var translateEnd = '';\n        if (!this.adapter.isUnbounded()) {\n            var _c = this.getFgTranslationCoordinates_(), startPoint = _c.startPoint, endPoint = _c.endPoint;\n            translateStart = startPoint.x + \"px, \" + startPoint.y + \"px\";\n            translateEnd = endPoint.x + \"px, \" + endPoint.y + \"px\";\n        }\n        this.adapter.updateCssVariable(VAR_FG_TRANSLATE_START, translateStart);\n        this.adapter.updateCssVariable(VAR_FG_TRANSLATE_END, translateEnd);\n        // Cancel any ongoing activation/deactivation animations\n        clearTimeout(this.activationTimer_);\n        clearTimeout(this.fgDeactivationRemovalTimer_);\n        this.rmBoundedActivationClasses_();\n        this.adapter.removeClass(FG_DEACTIVATION);\n        // Force layout in order to re-trigger the animation.\n        this.adapter.computeBoundingRect();\n        this.adapter.addClass(FG_ACTIVATION);\n        this.activationTimer_ = setTimeout(function () { return _this.activationTimerCallback_(); }, DEACTIVATION_TIMEOUT_MS);\n    };\n    MDCRippleFoundation.prototype.getFgTranslationCoordinates_ = function () {\n        var _a = this.activationState_, activationEvent = _a.activationEvent, wasActivatedByPointer = _a.wasActivatedByPointer;\n        var startPoint;\n        if (wasActivatedByPointer) {\n            startPoint = getNormalizedEventCoords(activationEvent, this.adapter.getWindowPageOffset(), this.adapter.computeBoundingRect());\n        }\n        else {\n            startPoint = {\n                x: this.frame_.width / 2,\n                y: this.frame_.height / 2,\n            };\n        }\n        // Center the element around the start point.\n        startPoint = {\n            x: startPoint.x - (this.initialSize_ / 2),\n            y: startPoint.y - (this.initialSize_ / 2),\n        };\n        var endPoint = {\n            x: (this.frame_.width / 2) - (this.initialSize_ / 2),\n            y: (this.frame_.height / 2) - (this.initialSize_ / 2),\n        };\n        return { startPoint: startPoint, endPoint: endPoint };\n    };\n    MDCRippleFoundation.prototype.runDeactivationUXLogicIfReady_ = function () {\n        var _this = this;\n        // This method is called both when a pointing device is released, and when the activation animation ends.\n        // The deactivation animation should only run after both of those occur.\n        var FG_DEACTIVATION = MDCRippleFoundation.cssClasses.FG_DEACTIVATION;\n        var _a = this.activationState_, hasDeactivationUXRun = _a.hasDeactivationUXRun, isActivated = _a.isActivated;\n        var activationHasEnded = hasDeactivationUXRun || !isActivated;\n        if (activationHasEnded && this.activationAnimationHasEnded_) {\n            this.rmBoundedActivationClasses_();\n            this.adapter.addClass(FG_DEACTIVATION);\n            this.fgDeactivationRemovalTimer_ = setTimeout(function () {\n                _this.adapter.removeClass(FG_DEACTIVATION);\n            }, numbers.FG_DEACTIVATION_MS);\n        }\n    };\n    MDCRippleFoundation.prototype.rmBoundedActivationClasses_ = function () {\n        var FG_ACTIVATION = MDCRippleFoundation.cssClasses.FG_ACTIVATION;\n        this.adapter.removeClass(FG_ACTIVATION);\n        this.activationAnimationHasEnded_ = false;\n        this.adapter.computeBoundingRect();\n    };\n    MDCRippleFoundation.prototype.resetActivationState_ = function () {\n        var _this = this;\n        this.previousActivationEvent_ = this.activationState_.activationEvent;\n        this.activationState_ = this.defaultActivationState_();\n        // Touch devices may fire additional events for the same interaction within a short time.\n        // Store the previous event until it's safe to assume that subsequent events are for new interactions.\n        setTimeout(function () { return _this.previousActivationEvent_ = undefined; }, MDCRippleFoundation.numbers.TAP_DELAY_MS);\n    };\n    MDCRippleFoundation.prototype.deactivate_ = function () {\n        var _this = this;\n        var activationState = this.activationState_;\n        // This can happen in scenarios such as when you have a keyup event that blurs the element.\n        if (!activationState.isActivated) {\n            return;\n        }\n        var state = __assign({}, activationState);\n        if (activationState.isProgrammatic) {\n            requestAnimationFrame(function () { return _this.animateDeactivation_(state); });\n            this.resetActivationState_();\n        }\n        else {\n            this.deregisterDeactivationHandlers_();\n            requestAnimationFrame(function () {\n                _this.activationState_.hasDeactivationUXRun = true;\n                _this.animateDeactivation_(state);\n                _this.resetActivationState_();\n            });\n        }\n    };\n    MDCRippleFoundation.prototype.animateDeactivation_ = function (_a) {\n        var wasActivatedByPointer = _a.wasActivatedByPointer, wasElementMadeActive = _a.wasElementMadeActive;\n        if (wasActivatedByPointer || wasElementMadeActive) {\n            this.runDeactivationUXLogicIfReady_();\n        }\n    };\n    MDCRippleFoundation.prototype.layoutInternal_ = function () {\n        var _this = this;\n        this.frame_ = this.adapter.computeBoundingRect();\n        var maxDim = Math.max(this.frame_.height, this.frame_.width);\n        // Surface diameter is treated differently for unbounded vs. bounded ripples.\n        // Unbounded ripple diameter is calculated smaller since the surface is expected to already be padded appropriately\n        // to extend the hitbox, and the ripple is expected to meet the edges of the padded hitbox (which is typically\n        // square). Bounded ripples, on the other hand, are fully expected to expand beyond the surface's longest diameter\n        // (calculated based on the diagonal plus a constant padding), and are clipped at the surface's border via\n        // `overflow: hidden`.\n        var getBoundedRadius = function () {\n            var hypotenuse = Math.sqrt(Math.pow(_this.frame_.width, 2) + Math.pow(_this.frame_.height, 2));\n            return hypotenuse + MDCRippleFoundation.numbers.PADDING;\n        };\n        this.maxRadius_ = this.adapter.isUnbounded() ? maxDim : getBoundedRadius();\n        // Ripple is sized as a fraction of the largest dimension of the surface, then scales up using a CSS scale transform\n        var initialSize = Math.floor(maxDim * MDCRippleFoundation.numbers.INITIAL_ORIGIN_SCALE);\n        // Unbounded ripple size should always be even number to equally center align.\n        if (this.adapter.isUnbounded() && initialSize % 2 !== 0) {\n            this.initialSize_ = initialSize - 1;\n        }\n        else {\n            this.initialSize_ = initialSize;\n        }\n        this.fgScale_ = \"\" + this.maxRadius_ / this.initialSize_;\n        this.updateLayoutCssVars_();\n    };\n    MDCRippleFoundation.prototype.updateLayoutCssVars_ = function () {\n        var _a = MDCRippleFoundation.strings, VAR_FG_SIZE = _a.VAR_FG_SIZE, VAR_LEFT = _a.VAR_LEFT, VAR_TOP = _a.VAR_TOP, VAR_FG_SCALE = _a.VAR_FG_SCALE;\n        this.adapter.updateCssVariable(VAR_FG_SIZE, this.initialSize_ + \"px\");\n        this.adapter.updateCssVariable(VAR_FG_SCALE, this.fgScale_);\n        if (this.adapter.isUnbounded()) {\n            this.unboundedCoords_ = {\n                left: Math.round((this.frame_.width / 2) - (this.initialSize_ / 2)),\n                top: Math.round((this.frame_.height / 2) - (this.initialSize_ / 2)),\n            };\n            this.adapter.updateCssVariable(VAR_LEFT, this.unboundedCoords_.left + \"px\");\n            this.adapter.updateCssVariable(VAR_TOP, this.unboundedCoords_.top + \"px\");\n        }\n    };\n    return MDCRippleFoundation;\n}(MDCFoundation));\nexport { MDCRippleFoundation };\n// tslint:disable-next-line:no-default-export Needed for backward compatibility with MDC Web v0.44.0 and earlier.\nexport default MDCRippleFoundation;\n//# sourceMappingURL=foundation.js.map","/**\n * @license\n * Copyright 2016 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nimport { __extends } from \"tslib\";\nimport { MDCComponent } from '@material/base/component';\nimport { applyPassive } from '@material/dom/events';\nimport { matches } from '@material/dom/ponyfill';\nimport { MDCRippleFoundation } from './foundation';\nimport * as util from './util';\nvar MDCRipple = /** @class */ (function (_super) {\n    __extends(MDCRipple, _super);\n    function MDCRipple() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.disabled = false;\n        return _this;\n    }\n    MDCRipple.attachTo = function (root, opts) {\n        if (opts === void 0) { opts = { isUnbounded: undefined }; }\n        var ripple = new MDCRipple(root);\n        // Only override unbounded behavior if option is explicitly specified\n        if (opts.isUnbounded !== undefined) {\n            ripple.unbounded = opts.isUnbounded;\n        }\n        return ripple;\n    };\n    MDCRipple.createAdapter = function (instance) {\n        return {\n            addClass: function (className) { return instance.root.classList.add(className); },\n            browserSupportsCssVars: function () { return util.supportsCssVariables(window); },\n            computeBoundingRect: function () { return instance.root.getBoundingClientRect(); },\n            containsEventTarget: function (target) { return instance.root.contains(target); },\n            deregisterDocumentInteractionHandler: function (evtType, handler) {\n                return document.documentElement.removeEventListener(evtType, handler, applyPassive());\n            },\n            deregisterInteractionHandler: function (evtType, handler) {\n                return instance.root\n                    .removeEventListener(evtType, handler, applyPassive());\n            },\n            deregisterResizeHandler: function (handler) {\n                return window.removeEventListener('resize', handler);\n            },\n            getWindowPageOffset: function () {\n                return ({ x: window.pageXOffset, y: window.pageYOffset });\n            },\n            isSurfaceActive: function () { return matches(instance.root, ':active'); },\n            isSurfaceDisabled: function () { return Boolean(instance.disabled); },\n            isUnbounded: function () { return Boolean(instance.unbounded); },\n            registerDocumentInteractionHandler: function (evtType, handler) {\n                return document.documentElement.addEventListener(evtType, handler, applyPassive());\n            },\n            registerInteractionHandler: function (evtType, handler) {\n                return instance.root\n                    .addEventListener(evtType, handler, applyPassive());\n            },\n            registerResizeHandler: function (handler) {\n                return window.addEventListener('resize', handler);\n            },\n            removeClass: function (className) { return instance.root.classList.remove(className); },\n            updateCssVariable: function (varName, value) {\n                return instance.root.style.setProperty(varName, value);\n            },\n        };\n    };\n    Object.defineProperty(MDCRipple.prototype, \"unbounded\", {\n        get: function () {\n            return Boolean(this.unbounded_);\n        },\n        set: function (unbounded) {\n            this.unbounded_ = Boolean(unbounded);\n            this.setUnbounded_();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    MDCRipple.prototype.activate = function () {\n        this.foundation.activate();\n    };\n    MDCRipple.prototype.deactivate = function () {\n        this.foundation.deactivate();\n    };\n    MDCRipple.prototype.layout = function () {\n        this.foundation.layout();\n    };\n    MDCRipple.prototype.getDefaultFoundation = function () {\n        return new MDCRippleFoundation(MDCRipple.createAdapter(this));\n    };\n    MDCRipple.prototype.initialSyncWithDOM = function () {\n        var root = this.root;\n        this.unbounded = 'mdcRippleIsUnbounded' in root.dataset;\n    };\n    /**\n     * Closure Compiler throws an access control error when directly accessing a\n     * protected or private property inside a getter/setter, like unbounded above.\n     * By accessing the protected property inside a method, we solve that problem.\n     * That's why this function exists.\n     */\n    MDCRipple.prototype.setUnbounded_ = function () {\n        this.foundation.setUnbounded(Boolean(this.unbounded_));\n    };\n    return MDCRipple;\n}(MDCComponent));\nexport { MDCRipple };\n//# sourceMappingURL=component.js.map","/**\n * @license\n * Copyright 2018 Google Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n/**\n * @fileoverview A \"ponyfill\" is a polyfill that doesn't modify the global prototype chain.\n * This makes ponyfills safer than traditional polyfills, especially for libraries like MDC.\n */\nexport function closest(element, selector) {\n    if (element.closest) {\n        return element.closest(selector);\n    }\n    var el = element;\n    while (el) {\n        if (matches(el, selector)) {\n            return el;\n        }\n        el = el.parentElement;\n    }\n    return null;\n}\nexport function matches(element, selector) {\n    var nativeMatches = element.matches\n        || element.webkitMatchesSelector\n        || element.msMatchesSelector;\n    return nativeMatches.call(element, selector);\n}\n/**\n * Used to compute the estimated scroll width of elements. When an element is\n * hidden due to display: none; being applied to a parent element, the width is\n * returned as 0. However, the element will have a true width once no longer\n * inside a display: none context. This method computes an estimated width when\n * the element is hidden or returns the true width when the element is visble.\n * @param {Element} element the element whose width to estimate\n */\nexport function estimateScrollWidth(element) {\n    // Check the offsetParent. If the element inherits display: none from any\n    // parent, the offsetParent property will be null (see\n    // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetParent).\n    // This check ensures we only clone the node when necessary.\n    var htmlEl = element;\n    if (htmlEl.offsetParent !== null) {\n        return htmlEl.scrollWidth;\n    }\n    var clone = htmlEl.cloneNode(true);\n    clone.style.setProperty('position', 'absolute');\n    clone.style.setProperty('transform', 'translate(-9999px, -9999px)');\n    document.documentElement.appendChild(clone);\n    var scrollWidth = clone.scrollWidth;\n    document.documentElement.removeChild(clone);\n    return scrollWidth;\n}\n//# sourceMappingURL=ponyfill.js.map","<script lang=\"ts\">\n    import { TOOL_INPUT_NAME, userToolState, userState, userPrevToolState } from \"../../js/user\";\n    import { currentInputHandler } from \"../../js/elementStores\";\n\n    // Button ripples.\n    import { MDCRipple } from \"@material/ripple\";\n    import { onMount } from \"svelte\";\n    import { changeHistory } from \"../../js/history\";\n    import { boardDiv } from \"../../js/board\";\n\n    onMount(() => Array.prototype.forEach.call(document.getElementsByClassName('mdc-ripple-surface'), el => MDCRipple.attachTo(el)));\n\n    function setPreviousMode() {\n        userPrevToolState.set(userToolState.get());\n    }\n\n    const filled = userState.ref('marks', 'filled');\n    const corner = userState.ref('marks', 'corner');\n    const center = userState.ref('marks', 'center');\n    const colors = userState.ref('marks', 'colors');\n\n    // Keep focus on board if user *clicks* on button pad.\n    function onBubblingClick(event: MouseEvent): void {\n        const isKeyboardClick = 0 === event.screenX && 0 === event.screenY;\n        if (!isKeyboardClick) {\n            $boardDiv.focus();\n        }\n    }\n</script>\n\n<div class=\"container\" on:click={onBubblingClick}>\n    <div class=\"mode-pad-container\">\n        <div class=\"mode-pad\">\n            <!-- TOOD switch to INPUT RADIOs. -->\n            <div>\n                <input class=\"radio-mode-button\" type=\"radio\" name={TOOL_INPUT_NAME} id=\"mode-radio-digits\"\n                    value={$filled} bind:group={$userToolState} on:change={setPreviousMode} />\n                <label class=\"mdc-ripple-surface padbutton padbutton-mode\" role=\"button\" for=\"mode-radio-digits\">\n                    <span aria-hidden=\"true\">1</span>\n                    <span class=\"sr-only\">Digits</span>\n                </label>\n            </div>\n            <div>\n                <input class=\"radio-mode-button\" type=\"radio\" name={TOOL_INPUT_NAME} id=\"mode-radio-corner\"\n                    value={$corner} bind:group={$userToolState} on:change={setPreviousMode} />\n                <label class=\"mdc-ripple-surface padbutton padbutton-mode\" role=\"button\" for=\"mode-radio-corner\">\n                    <span aria-hidden=\"true\" style=\"font-size: 50%;\">\n                        <span style=\"position: absolute; top:    12%; left:  20%;\">1</span>\n                        <span style=\"position: absolute; top:    12%; right: 20%;\">2</span>\n                        <span style=\"position: absolute; bottom: 12%; left:  20%;\">3</span>\n                    </span>\n                    <span class=\"sr-only\">Corner Marks</span>\n                </label>\n            </div>\n            <div>\n                <input class=\"radio-mode-button\" type=\"radio\" name={TOOL_INPUT_NAME} id=\"mode-radio-center\"\n                    value={$center} bind:group={$userToolState} on:change={setPreviousMode} />\n                <label class=\"mdc-ripple-surface padbutton padbutton-mode\" role=\"button\" for=\"mode-radio-center\">\n                    <span aria-hidden=\"true\" style=\"font-size: 50%;\">123</span>\n                    <span class=\"sr-only\">Center Marks</span>\n                </label>\n            </div>\n            <div>\n                <input class=\"radio-mode-button\" type=\"radio\" name={TOOL_INPUT_NAME} id=\"mode-radio-colors\"\n                    value={$colors} bind:group={$userToolState} on:change={setPreviousMode} />\n                <label class=\"mdc-ripple-surface padbutton padbutton-mode\" role=\"button\" for=\"mode-radio-colors\">\n                    <span class=\"icon icon-inline icon-c-textinv icon-colors\" />\n                    <span class=\"sr-only\">Colors</span>\n                </label>\n            </div>\n        </div>\n    </div>\n    <div class=\"right-container\">\n        <div class=\"right\">\n            <div class=\"num-pad\">\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 1 / 1 / 2 / 2\" value=\"1\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>1</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 1 / 2 / 2 / 3\" value=\"2\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>2</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 1 / 3 / 2 / 4\" value=\"3\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>3</button>\n\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 2 / 1 / 3 / 2\" value=\"4\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>4</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 2 / 2 / 3 / 3\" value=\"5\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>5</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 2 / 3 / 3 / 4\" value=\"6\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>6</button>\n\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 3 / 1 / 4 / 2\" value=\"7\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>7</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 3 / 2 / 4 / 3\" value=\"8\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>8</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 3 / 3 / 4 / 4\" value=\"9\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>9</button>\n\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 4 / 1 / 5 / 2\" value=\"0\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined}>0</button>\n                <button class=\"mdc-ripple-surface padbutton\" style=\"grid-area: 4 / 2 / 5 / 4\" value=\"Delete\"\n                    on:click={$currentInputHandler && $currentInputHandler.padClick || undefined} title=\"Delete\" aria-label=\"Delete\">\n                    <span class=\"icon icon-inline icon-c-textinv icon-delete\" />\n                </button>\n            </div>\n            <div class=\"ctrl-pad\">\n                <button class=\"mdc-ripple-surface padbutton\" title=\"Undo\" aria-label=\"Undo\" on:click={() => changeHistory(false)}>\n                    <span class=\"icon icon-inline icon-c-textinv icon-undo\" />\n                </button>\n                <button class=\"mdc-ripple-surface padbutton\" title=\"Redo\" aria-label=\"Redo\" on:click={() => changeHistory(true)}>\n                    <span class=\"icon icon-inline icon-c-textinv icon-undo redo\" />\n                </button>\n                <button class=\"mdc-ripple-surface padbutton\" title=\"Take Screenshot\" aria-label=\"Take Screenshot\">\n                    <span class=\"icon icon-inline icon-c-textinv icon-screenshot\" />\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n\n<style lang=\"scss\">\n    @use \"sass:math\";\n    @use \"@material/ripple\";\n    @use '../../css/vars' as vars;\n\n    @mixin aspect-ratio-container($aspect-ratio-inv, $width) {\n        width: $width;\n        height: 0;\n        padding-bottom: $width * $aspect-ratio-inv;\n        position: relative;\n    }\n    @mixin aspect-ratio-child {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n    }\n\n    $padbutton-border-radius: 0.2em;\n\n    .padbutton {\n        @include ripple.states-base-color(#fff);\n\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        appearance: none;\n\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        user-select: none;\n\n        display: block;\n        box-sizing: border-box;\n\n        display: block;\n        font-family: inherit;\n        margin: 0;\n        padding: 0;\n        border: 0;\n        text-align: center;\n        background: none;\n        cursor: pointer;\n\n        font-size: 1em;\n        font-weight: vars.$font-weight-heavy;\n        color: #fff;\n\n        border-radius: $padbutton-border-radius;\n        border: 0.06em solid vars.$color-clickable;\n        background-color: vars.$color-clickable;\n\n        @include vars.breakpoint-mobile {\n            font-size: 5vw;\n        }\n    }\n\n    .mode-pad > * {\n        position: relative;\n        height: 0;\n        padding-bottom: 100%;\n\n        .radio-mode-button {\n            -webkit-appearance: none;\n            -moz-appearance: none;\n            appearance: none;\n\n            border-radius: $padbutton-border-radius;\n        }\n        .radio-mode-button, .padbutton.padbutton-mode {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n    }\n    .padbutton-mode:not(.radio-mode-button:checked ~ *) {\n        @include ripple.states-base-color(#000);\n\n        color: vars.$color-clickable;\n        background-color: #fff;\n        .icon {\n            background-color: vars.$color-clickable;\n        }\n    }\n\n    .container {\n        display: flex;\n        justify-content: space-between;\n        .mode-pad-container {\n            @include aspect-ratio-container(math.div(42, 9), math.div(2 * 100%, 9));\n\n            .mode-pad {\n                @include aspect-ratio-child();\n\n                font-size: 108%;\n\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n            }\n        }\n\n        .right-container {\n            @include aspect-ratio-container(1.6, math.div(6 * 100%, 9));\n\n            .right {\n                @include aspect-ratio-child();\n\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n\n                .num-pad {\n                    width: 100%;\n                    height: 82%;\n\n                    display: grid;\n                    grid-template-columns: 1fr 1fr 1fr;\n                    column-gap: 5%;\n                    grid-template-rows: 1fr 1fr 1fr 1fr;\n                    row-gap: 3.703703703%;\n\n                    > * {\n                        line-height: 100%;\n                    }\n                }\n\n                .ctrl-pad {\n                    height: 15.2%;\n\n                    font-size: 80%;\n\n                    display: flex;\n                    @include vars.gap(3.5%);\n\n                    > * {\n                        width: 24.444%;\n                    }\n                }\n            }\n        }\n    }\n</style>\n","<script lang=\"ts\">\n    import { onDestroy } from \"svelte\";\n    import { boardState } from \"../../js/board\";\n    import ButtonPad from \"./ButtonPad.svelte\";\n\n    // Hide spellcheck squiggles when the user is not editing the rules.\n    function setSpellcheck(event: FocusEvent & { currentTarget: EventTarget & HTMLTextAreaElement}): void {\n        event.currentTarget.setAttribute('spellcheck', `${document.activeElement === event.currentTarget}`);\n    }\n\n    // Unfortunately there is no way to size the text to based on the parent (in this case button) size in native CSS.\n    // So we have to use a bit of javascript to set the font size when the page resizes.\n    let entryPadEl: HTMLDivElement;\n    function onResize() {\n        entryPadEl.style.fontSize = `${0.12 * entryPadEl.clientWidth}px`;\n    }\n    window.addEventListener('resize', onResize);\n    onDestroy(() => window.removeEventListener('resize', onResize));\n    requestAnimationFrame(onResize); // Run on load.\n\n    const title = boardState.ref('meta', 'title');\n    const author = boardState.ref('meta', 'author');\n    const description = boardState.ref('meta', 'description');\n</script>\n\n<div class=\"entry-column\">\n\t<div class=\"entry-pad\" bind:this={entryPadEl}>\n        <ButtonPad />\n    </div>\n    <div class=\"entry-info\">\n        <input class=\"info-input title\" type=\"text\" placeholder=\"Untitled\" bind:value={$title} />\n        <input class=\"info-input setter\" type=\"text\" placeholder=\"Anonymous\" bind:value={$author} />\n        <textarea class=\"rules-text\" spellcheck=\"false\" bind:value={$description} on:focus={setSpellcheck} on:blur={setSpellcheck}></textarea>\n    </div>\n</div>\n\n<style lang=\"scss\">\n    @use \"sass:math\";\n    @use '../../css/vars' as vars;\n\n    .info-input {\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        appearance: none;\n\n        margin: 0;\n        padding: 0;\n        border: 0;\n        outline: none;\n\n        display: block;\n        box-sizing: border-box;\n        width: 100%;\n\n        text-align: center;\n\n        @include vars.hoverborder();\n        &:hover, &:focus {\n            outline: none;\n            @include vars.hoverborder-hover();\n        }\n    }\n\n    .title {\n        font-size: 1.4rem;\n        font-weight: vars.$font-weight-heavy;\n        margin-bottom: 0.25rem;\n    }\n\n    .setter {\n        font-size: 0.7rem;\n    }\n\n    textarea.rules-text {\n        resize: none;\n        padding: 0.5em;\n    }\n\n    .entry-column {\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        height: vars.$sudoku-size-big; // To stick numpad to bottom of sudoku grid.\n\n        .entry-pad {\n            width: 100%;\n\n            @include vars.breakpoint-mobile {\n                width: 50%;\n                margin: 0 auto;\n            }\n        }\n\n        .entry-info {\n            flex: 1 1 20vh;\n            min-height: 8em;\n            margin: 0 0 1em 0;\n\n            display: flex;\n            flex-direction: column;\n\n            textarea.rules-text {\n                flex: 1 1 20vh;\n                font-size: 0.7rem;\n\n                margin-top: 1em;\n                min-height: 5em;\n\n                outline: none;\n                @include vars.hoverborder();\n                &:hover, &:focus {\n                    outline: none;\n                    @include vars.hoverborder-hover();\n                }\n\n            }\n\n            // Reorder so entry-pad is before rules.\n            order: -1;\n            @include vars.breakpoint-mobile {\n                // Except when collapsing breakpoint is hit.\n                order: 0;\n                margin: 1em 0 0 0;\n            }\n        }\n    }\n</style>\n","<script lang=\"ts\">\nimport { debounce } from \"debounce\";\n\n    import { boardDiv } from \"./js/board\";\n    import { SUDOKU_STUDIO_VERSION, URL_REQUEST_FEATURE, URL_REPORT_BUG } from \"./js/github\";\n    import BoardContainer from \"./svelte/board/BoardContainer.svelte\";\n    import EditPanel from \"./svelte/edit/EditPanel.svelte\";\n    import EntryPanel from \"./svelte/entry/EntryPanel.svelte\";\n    import Header from \"./svelte/Header.svelte\";\n\n    function updateBugReportUrl(event: MouseEvent & { currentTarget: EventTarget & HTMLAnchorElement}): void {\n        const url = new URL(URL_REPORT_BUG);\n        url.searchParams.append('version', SUDOKU_STUDIO_VERSION);\n        url.searchParams.append('browser', window.navigator.userAgent);\n        url.searchParams.append('os', window.navigator.platform);\n        url.searchParams.append('url', window.location.href);\n        event.currentTarget.href = url.href;\n    }\n</script>\n\n<header>\n    <button class=\"nobutton focus-skip\" on:click={() => $boardDiv && $boardDiv.focus()}>Jump To Board</button>\n    <div class=\"content\">\n        <div class=\"content-row\">\n            <Header />\n        </div>\n    </div>\n</header>\n<main>\n    <div class=\"content\">\n        <div class=\"content-row\">\n            <div class=\"left-panel\">\n                <EditPanel />\n            </div>\n            <div class=\"center-panel\">\n                <BoardContainer />\n            </div>\n            <div class=\"right-panel\">\n                <EntryPanel />\n            </div>\n        </div>\n    </div>\n</main>\n<footer>\n    <div class=\"footer-text\">\n        <a target=\"_blank\" href=\"https://github.com/SudokuStudio/SudokuStudio\">\n            Sudoku Studio v.{SUDOKU_STUDIO_VERSION}\n        </a>\n        <a target=\"_blank\" href={URL_REPORT_BUG} on:mouseover={debounce(updateBugReportUrl, 500, true)}>\n            Bug Report\n        </a>\n        <a target=\"_blank\" href={URL_REQUEST_FEATURE}>\n            Feature Request\n        </a>\n    </div>\n</footer>\n\n<style lang=\"scss\">\n    @use './css/vars' as vars;\n\n    header {\n        font-size: 0.8rem;\n        flex: 0 0 auto;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        height: vars.$header-height;\n    }\n\n    main {\n        flex: 1 1 auto;\n\n        display: flex;\n        > .content {\n            flex: 1;\n        }\n\n        .left-panel, .right-panel {\n            flex: 1 1 100%;\n            overflow: visible auto;\n            height: calc(100vh - #{vars.$header-height + vars.$footer-height});\n        }\n\n        .center-panel {\n            flex: 0 0 auto;\n\n            /* maintain square aspect ratio */\n            width: vars.$sudoku-size-big;\n            height: vars.$sudoku-size-big;\n\n            position: relative;\n        }\n    }\n\n    @include vars.breakpoint-mobile {\n        main {\n            .content-row {\n                flex-direction: column;\n            }\n            .center-panel {\n                width: vars.$sudoku-size-small; height: vars.$sudoku-size-small;\n\n                align-self: center;\n            }\n            .left-panel {\n                display: none;\n            }\n        }\n    }\n\n    footer {\n        flex: 0 0 auto;\n        height: vars.$footer-height;\n        line-height: vars.$footer-height;\n\n        font-size: 0.8rem;\n        text-align: center;\n\n        .footer-text {\n            margin: 0 auto;\n            width: 100%;\n            max-width: 35em;\n\n            display: flex;\n            justify-content: space-evenly;\n            @include vars.gap(2em);\n        }\n    }\n</style>\n","import './css/index.scss';\nimport 'normalize.css';\nimport '../../../node_modules/@material/ripple/dist/mdc.ripple.min.css';\n\nimport { initUserAndBoard } from './js/init';\ninitUserAndBoard();\n\nimport App from './App.svelte';\nconst app = new App({\n    target: document.body,\n});\n\nexport default app;\n"],"names":["debounce","func","wait","immediate","timeout","args","context","timestamp","result","later","last","Date","now","setTimeout","apply","debounced","this","arguments","callNow","clear","clearTimeout","flush","LZString","f","String","fromCharCode","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","i","length","charAt","compressToBase64","input","res","_compress","a","decompressFromBase64","_decompress","index","compressToUTF16","decompressFromUTF16","compressed","charCodeAt","compressToUint8Array","uncompressed","compress","buf","Uint8Array","TotalLen","current_value","decompressFromUint8Array","decompress","Array","forEach","c","push","join","compressToEncodedURIComponent","decompressFromEncodedURIComponent","replace","bitsPerChar","getCharFromInt","value","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","Object","prototype","hasOwnProperty","call","Math","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","data","val","position","module","defineProperty","exports","objectFromEntries","fromEntries","entries","obj","create","key","WatchersKey","Symbol","isEq","b","is","undefToNull","StateRef","constructor","stateManager","path","_path","_stateManager","seg","pop","ref","get","watch","watcher","triggerNow","unwatch","newData","update","rootUpdate","map","k","v","subscribe","subscription","_oldData","set","StateManager","_data","_watchers","Map","_watcherTreeRoot","target","includes","Error","patterns","patternSet","Set","pattern","_watchPattern","has","delete","_unwatchPattern","split","changed","redo","undo","segs","newRedo","newUndo","_updateInternal","watcherTree","add","_triggerNow","watchers","size","restSegs","keys","e","console","error","watcherTrees","atUpdateDepth","dataObj","updateObj","allKeys","dataUpdated","dataObjNew","innerData","innerUpdate","nextWatcherTrees","_nextWatcherTrees","newInnerData","innerRedo","innerUndo","assign","segsRest","values","every","nextTrees","GRID_THICKNESS","GRID_THICKNESS_HALF","BOX_THICKNESS","BOX_THICKNESS_HALF","arrayObj2array","arrayObj","arr","cellIdx2cellCoord","idx","width","floor","cellCoord2CellIdx","x","y","svgCoord2cellCoord","xf","yf","height","conservative","xr","yr","abs","cornerCoord2cornerIdx","cornerIdx2cornerCoord","vertId","svgCoord2cornerCoord","round","svgCoord2edgeIdx","d","h","r","edgeIdx2svgCoord","grid","idx0","idx1","cellIdx","edgeIdx2cellCoords","x0","y0","x1","y1","svgCoord2seriesIdx","isCol","isRow","svgCoord2diagonalIdx","left","top","bot","max","min","positive","dir","diagonalIdx2svgCoord","offset","z","diagonalIdx2startingCellCoord","idxMapToKeysArray","filter","Number","sort","makePath","idxArr","shortenHead","shortenTail","bezierRounding","points","vec","normalize2d","len","out","ba","bc","xy","dist","sqrt","click2svgCoord","offsetX","offsetY","board","elWidth","elHeight","getBoundingClientRect","originX","originY","viewBox","baseVal","getEdges","cellIdxs","inset","adjList","A","B","adjBack","adj","C","D","loops","firstVertId","firstAdj","from","find","_vertId","secondVertId","crossProd","NEGATIVE_INFINITY","nextVertId","aVertId","aC","aCrossProd","isOnGrid","coord","cornerMarkPos","dx","dy","half","TWO_PI","PI","makeConicalCellSlice","slices","offsetFrac","cx","cy","headFrac","tailFrac","fracs","s","selectedFracs","frac","cos","sin","getDigits","elements","includeGivens","includeFilled","element","type","num2roman","ROMAN_VALUES","num","str","q","repeat","roman2num","validator","token","M","CM","CD","XC","L","XL","X","IX","V","IV","I","m","toUpperCase","test","exec","noop","run","fn","blank_object","run_all","fns","is_function","thing","safe_not_equal","store","callbacks","unsub","unsubscribe","component_subscribe","component","callback","$$","on_destroy","create_slot","definition","ctx","$$scope","slot_ctx","get_slot_context","tar","src","slice","update_slot","slot","slot_definition","dirty","get_slot_changes_fn","get_slot_context_fn","slot_changes","lets","undefined","merged","get_slot_changes","slot_context","p","set_store_value","ret","current_component","is_hydrating","upper_bound","low","high","mid","append","node","hydrate_init","children","childNodes","Int32Array","longest","seqLen","claim_order","newLen","lis","toMove","cur","reverse","j","anchor","insertBefore","init_hydrate","actual_end_child","parentElement","firstChild","nextSibling","parentNode","appendChild","insert","detach","removeChild","destroy_each","iterations","detaching","name","document","createElement","svg_element","createElementNS","text","createTextNode","space","empty","listen","event","handler","options","addEventListener","removeEventListener","prevent_default","preventDefault","stop_propagation","stopPropagation","attr","attribute","removeAttribute","getAttribute","setAttribute","set_data","wholeText","set_input_value","set_style","important","style","setProperty","toggle_class","toggle","classList","set_current_component","get_current_component","bubble","dirty_components","binding_callbacks","render_callbacks","flush_callbacks","resolved_promise","Promise","resolve","update_scheduled","add_render_callback","flushing","seen_callbacks","fragment","before_update","after_update","outroing","outros","group_outros","check_outros","transition_in","block","local","transition_out","o","destroy_block","lookup","outro_and_destroy_block","update_keyed_each","old_blocks","get_key","dynamic","list","destroy","create_each_block","next","get_context","n","old_indexes","new_blocks","new_lookup","deltas","child_ctx","will_move","did_move","first","new_block","old_block","new_key","old_key","create_component","mount_component","customElement","on_mount","new_on_destroy","destroy_component","make_dirty","then","fill","init","instance","create_fragment","not_equal","props","parent_component","bound","on_disconnect","skip_bound","ready","rest","hydrate","nodes","l","intro","SvelteComponent","$destroy","$on","indexOf","splice","$set","$$props","$$set","subscriber_queue","readable","start","writable","stop","subscribers","new_value","run_queue","invalidate","subscriber","derived","stores","initial_value","single","isArray","stores_array","auto","inited","pending","cleanup","sync","unsubscribers","boardSvg","boardDiv","boardState","window","boardGridRef","MARK_TYPES","userState","select","cursor","tool","prevTool","marks","filled","corner","center","colors","history","historyUndone","userSelectState","userCursorState","userPrevToolState","userToolState","TOOL_INPUT_NAME","makeUid","random","makeA1Column","mod","unshift","pushHistory","JSON","stringify","changeHistory","historyObject","historyTimestampKeys","histKey","reduce","histVal","warn","diffData","parse","code","ctrlKey","shiftKey","stopImmediatePropagation","AdjacentCellPointerHandler","interpolateOnReenter","_interpolateOnReender","down","onDragStart","_isDown","_isTap","move","svg","_handle","up","onDragEnd","_prevPos","_prevCell","leave","click","onTap","pos","distSq","rx","ry","range","lerp","cellLine","onDrag","DIGIT_REGEX","NULL_KEYCODES","Delete","Backspace","NumpadDecimal","parseDigit","match","selectPointerHandler","getSelectDigitInputHandler","stateRef","multipleDigits","blockedByGivens","blockedByFilled","digitMapping","nextMode","DELETE_ORDER","onDigitInput","digit","onDigitInputHelper","elementId","blockingDigits","getDigitsHelper","allAlreadySet","MODE_KEYS","onQuickshift","oldTool","metaKey","altKey","ARROW_KEYS","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","load","unload","blur","_event","keydown","onArrowKey","keyup","padClick","currentTarget","Mode","mode","RESETTING","handle","isClick","SELECTING","DYNAMIC","DESELCTING","mouseEvent","hsluv","Geometry","intersectLineLine","intercept","slope","distanceFromOrigin","point","distanceLineFromOrigin","line","perpendicularThroughPoint","angleFromOrigin","atan2","normalizeAngle","angle","lengthOfRayUntilIntersect","theta","Hsluv","getBounds","sub1","sub2","epsilon","kappa","_g","m1","m2","m3","_g1","t","top1","top2","bottom","maxSafeChromaForL","bounds","Infinity","maxChromaForLH","H","hrad","dotProduct","sum","fromLinear","toLinear","xyzToRgb","tuple","rgbToXyz","rgbl","minv","yToL","Y","refY","lToY","xyzToLuv","divider","varU","varV","NaN","refU","refV","luvToXyz","U","luvToLch","lchToLuv","Hrad","hsluvToLch","S","lchToHsluv","hpluvToLch","lchToHpluv","rgbToHex","chan","digit2","digit1","hexChars","hexToRgb","hex","toLowerCase","lchToRgb","rgbToLch","hsluvToRgb","rgbToHsluv","hpluvToRgb","rgbToHpluv","hsluvToHex","hpluvToHex","hexToHsluv","hexToHpluv","getLineInputHandler","deletePrioritizeHead","deletePrioritizeTail","allowSelfIntersection","pointerHandler","lineRef","lineCells","selfHit","diff","lineIdToDelete","lineId","lineValArrObj","lineValCells","getInputHandler","getMode","fullDiff","keymap","svgCoord2idx","idxRef","oldVal","multiDigit","clickedIdxRef","ELEMENT_HANDLERS","givens","order","permanent","inGlobalMenu","menu","icon","box","thermo","between","palindrome","whisper","renban","arrow","arrowRef","bulbCells","bodyCells","existingArrows","arrowId","bulb","body","bulbArr","bodyEmpty","BODY","BULB","handleDragStart","lastIndexOf","cells","prevX","prevY","POSITIVE_INFINITY","addedRowCells","betweenX","reorderArrowBulb","minLength","arrowIdToDelete","odd","even","quadruple","digits","cornerRef","clickedCornerRef","killer","cageRef","getExistingCageAtIdx","cageId","_","startDrag","clone","cloneRef","moveStart","cloneEntry","label","color","getExistingCloneAtIdx","cloneId","existingClone","clickedAB","unclickedAB","MOVING","clickedI","existingLabels","makeNewClone","newB","offsetIdx","bIdx","difference","ratio","xv","KeyX","KeyV","littleKiller","sandwich","skyscraper","xsums","diagonal","checkbox","refPath","knight","king","disjointGroups","consecutive","selfTaxicab","createNewBoard","boxWidth","boxHeight","meta","title","author","description","fpuzzlesSizes","RC_REGEX","parseRCNotation","rc","row","setupUserState","id","SUDOKU_STUDIO_VERSION","URL_NEW_ISSUE","URL_REPORT_BUG","strokeWidth","fontSize","cellsArr","lastIdx","lastCoord","labelPos","cloneAbId","fontWeight","diagIdx","digitOrTrue","idx2coord","stroke","textColor","radius","mapDigits","colorsBitset","hsluvA","hsluvB","nums","numsBitset","innerRadius","outlineOpacity","innerOpacity","dCursor","cursorIdx","selectRef","dMask","dFill","negative","splitter","cornerIdx","lines","firstIdx","firstCoord","margin","pathOptions","items","itemId","idxArrObj","bulbRadius","outlineWidth","dBulb","dBody","head","tail","thermos","thermoId","invalid","mask","SeriesRender","seriesIdx2seriesCoord","PositionNumberRender","ELEMENT_RENDERERS","UserRender","DigitRender","LineRender","NullRender","MARGINS","elementsRef","givensMaskPath","givensFilledMaskPath","_elements","newVal","findIndex","item","$grid","$list","elementHandlers","elementInfo","elementRef","info","currentInputHandler","_oldVal","toolId","$currentElement","$boardSvg","valueRef","inputHandler","activeElement","$boardDiv","focus","$currentInputHandler","closed","onAdd","counter","unused","deletable","isLocal","onClick","$userToolState","onTrash","checked","$checked","some","dict","constraintsGlobal","$elementHandlers","constraintsLocal","showAddModal","_global","prompt","addElement","alert","menuInfo","SelectMenuComponent","CheckboxMenuComponent","supportsCssVariables_","extendStatics","setPrototypeOf","__proto__","__extends","TypeError","__","__assign","__read","iterator","ar","done","__spreadArray","to","pack","concat","MDCFoundation","adapter","enumerable","configurable","MDCComponent","root","foundation","_i","initialize","getDefaultFoundation","initialSyncWithDOM","attachTo","_args","evtType","unlisten","emit","evtData","shouldBubble","evt","CustomEvent","bubbles","detail","createEvent","initCustomEvent","dispatchEvent","applyPassive","globalObj","passiveSupported","passive","err","supportsPassiveOption","cssClasses","BG_FOCUSED","FG_ACTIVATION","FG_DEACTIVATION","ROOT","UNBOUNDED","strings","VAR_FG_SCALE","VAR_FG_SIZE","VAR_FG_TRANSLATE_END","VAR_FG_TRANSLATE_START","VAR_LEFT","VAR_TOP","numbers","DEACTIVATION_TIMEOUT_MS","FG_DEACTIVATION_MS","INITIAL_ORIGIN_SCALE","PADDING","TAP_DELAY_MS","ACTIVATION_EVENT_TYPES","POINTER_DEACTIVATION_EVENT_TYPES","activatedTargets","MDCRippleFoundation","_super","_this","defaultAdapter","activationAnimationHasEnded_","activationTimer_","fgDeactivationRemovalTimer_","fgScale_","frame_","initialSize_","layoutFrame_","maxRadius_","unboundedCoords_","activationState_","defaultActivationState_","activationTimerCallback_","runDeactivationUXLogicIfReady_","activateHandler_","activate_","deactivateHandler_","deactivate_","focusHandler_","handleFocus","blurHandler_","handleBlur","resizeHandler_","layout","addClass","browserSupportsCssVars","computeBoundingRect","right","containsEventTarget","deregisterDocumentInteractionHandler","deregisterInteractionHandler","deregisterResizeHandler","getWindowPageOffset","isSurfaceActive","isSurfaceDisabled","isUnbounded","registerDocumentInteractionHandler","registerInteractionHandler","registerResizeHandler","removeClass","updateCssVariable","supportsPressRipple","supportsPressRipple_","registerRootHandlers_","_a","ROOT_1","UNBOUNDED_1","requestAnimationFrame","layoutInternal_","ROOT_2","UNBOUNDED_2","removeCssVars_","deregisterRootHandlers_","deregisterDeactivationHandlers_","activate","deactivate","cancelAnimationFrame","setUnbounded","unbounded","activationEvent","hasDeactivationUXRun","isActivated","isProgrammatic","wasActivatedByPointer","wasElementMadeActive","registerDeactivationHandlers_","rippleStrings","activationState","previousActivationEvent","previousActivationEvent_","resetActivationState_","checkElementMadeActive_","animateActivation_","keyCode","_b","translateStart","translateEnd","_c","getFgTranslationCoordinates_","startPoint","endPoint","rmBoundedActivationClasses_","pageOffset","clientRect","normalizedX","normalizedY","documentX","documentY","touchEvent","changedTouches","pageX","pageY","getNormalizedEventCoords","state","animateDeactivation_","maxDim","initialSize","updateLayoutCssVars_","MDCRipple","disabled","opts","ripple","createAdapter","className","windowObj","forceRefresh","supportsCssVars","CSS","supports","explicitlySupportsCssVars","weAreFeatureDetectingSafari10plus","util.supportsCssVariables","contains","documentElement","pageXOffset","pageYOffset","selector","matches","webkitMatchesSelector","msMatchesSelector","Boolean","remove","varName","unbounded_","setUnbounded_","dataset","getElementsByClassName","el","screenX","screenY","setSpellcheck","entryPadEl","onResize","clientWidth","$title","$author","$description","url","URL","searchParams","navigator","userAgent","platform","location","href","newUrl","replaceState","thisUrl","newBoardState","b64","json","fBoard","findOrAddElement","elem","addRegionElement","fRegionConstraint","fRegionObj","cell","addLineElement","fLinesConstraint","fLinesObj","fLine","cellArr","addEdgeElement","fCellsObj","coordA","coordB","edgeIdx","addKillerElement","fConstraint","fKillerEntry","killerItem","ruleset","gridRow","gridEntry","region","given","log","cornerPencilMarks","cellMarks","centerPencilMarks","highlight","antiknight","antiking","disjointgroups","nonconsecutive","orth","thermometer","betweenline","whispers","fArrowEntry","arrowItem","sandwichsum","fCellValue","seriesIdx","addSeriesElement","killercage","extraregion","littlekillersum","fLkEntry","direction","minimum","maximum","fQuadEntry","cornerCoord","outer","fCloneEntry","cloneItem","cloneCells","startsWith","parseFpuzzles","boardString","initUserAndBoard"],"mappings":"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"}